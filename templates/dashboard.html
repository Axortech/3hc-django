{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Dashboard - BUILDSTATE</title>
  <meta content="" name="description" />
  <meta content="" name="author" />
  <meta content="" name="keywords" />
  <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport" />
  <meta name="csrf-token" content="{{ csrf_token }}" />
  <!-- Security: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.quilljs.com https://code.jquery.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.quilljs.com https://fonts.googleapis.com; img-src 'self' data: https:; font-src 'self' https: https://fonts.gstatic.com; connect-src 'self' http://localhost:8000 http://127.0.0.1:8000 https:;">
  <!-- favicon -->
  <link href="{% static 'img/favicon.png' %}" rel="icon" sizes="32x32" type="image/png" />
  <!-- Bootstrap CSS -->
  <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
  <!-- font themify CSS -->
  <link rel="stylesheet" href="{% static 'css/themify-icons.css' %}" />
  <!-- font awesome CSS -->
  <link href="{% static 'font-awesome/css/font-awesome.css' %}" rel="stylesheet" />
  <!-- on3step CSS -->
  <link href="{% static 'css/animated-on3step.css' %}" rel="stylesheet" />
  <link href="{% static 'css/on3step-style.css' %}" rel="stylesheet" />
  <link href="{% static 'css/queries-on3step.css' %}" media="all" rel="stylesheet" type="text/css" />
  <!-- Quill Rich Text Editor -->
  <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">


  <style>
    /* Dashboard Custom Styling */
    body {
      background: #fff;
    }

    .dashboard-header-section {
      background: #ff6600;
      color: #fff;
      padding: 20px 0;
    }

    .dashboard-header-section h2 {
      color: #fff;
      margin: 0;
      font-size: 24px;
    }

    .dashboard-user-info {
      text-align: right;
      font-size: 12px;
    }

    .dashboard-user-info .user-name {
      font-weight: 600;
      font-size: 13px;
      color: #172434;
    }

    .dashboard-user-info .user-role {
      font-size: 11px;
      opacity: 0.7;
      color: #666;
    }

    .logout-link {
      color: #ff6600;
      text-decoration: none;
      font-weight: 600;
      font-size: 12px;
      margin-top: 5px;
      transition: all 0.3s ease;
    }

    .logout-link:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    /* Stats Row */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
      padding: 30px 0;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 25px;
      border-left: 5px solid #ff6600;
      display: flex;
      align-items: center;
      gap: 20px;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }

    .stat-icon {
      width: 50px;
      height: 50px;
      background: #ff6600;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: #fff;
      flex-shrink: 0;
    }

    .stat-content {
      flex: 1;
    }

    .stat-label {
      font-size: 11px;
      color: #999;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #172434;
    }

    /* Tabs Navigation - Sidebar for Desktop */
    .tabs-container {
      background: #fff;
      display: flex;
      gap: 0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(255, 102, 0, 0.08);
      min-height: 600px;
      margin-bottom: 30px;
    }

    .tabs-header {
      display: flex;
      flex-direction: column;
      width: 220px;
      border-right: 2px solid #e8e8e8;
      background: linear-gradient(180deg, #fafafa 0%, #fff 100%);
      overflow-y: auto;
      flex-shrink: 0;
      scroll-behavior: smooth;
    }

    .tabs-header::-webkit-scrollbar {
      width: 6px;
    }

    .tabs-header::-webkit-scrollbar-track {
      background: #f0f0f0;
    }

    .tabs-header::-webkit-scrollbar-thumb {
      background: #ff6600;
      border-radius: 3px;
    }

    .tabs-header::-webkit-scrollbar-thumb:hover {
      background: #e55a00;
    }

    .tab-button {
      width: 100%;
      padding: 16px 20px;
      background: transparent;
      border: none;
      border-left: 4px solid transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: #666;
      text-transform: none;
      letter-spacing: 0.3px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: flex-start;
      text-align: left;
    }

    .tab-button::after {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 4px;
      height: 0;
      background: linear-gradient(180deg, #ff6600, #ff8533);
      transition: height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tab-button:hover {
      color: #ff6600;
      background: rgba(255, 102, 0, 0.05);
    }

    .tab-button:hover::after {
      height: 60%;
      top: 20%;
    }

    .tab-button.active {
      color: #ff6600;
      background: rgba(255, 102, 0, 0.08);
      border-left-color: #ff6600;
    }

    .tab-button.active::after {
      height: 100%;
      top: 0;
    }

    .tab-button i {
      font-size: 16px;
      transition: transform 0.3s ease;
      width: 20px;
      text-align: center;
    }

    .tab-button:hover i {
      transform: scale(1.15);
    }

    .tab-button.active i {
      color: #ff6600;
    }

    /* Tab Content Wrapper */
    .tabs-content-wrapper {
      flex: 1;
      overflow-y: auto;
      background: #fff;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      padding: 30px;
      animation: fadeInSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeInSlide {
      from {
        opacity: 0;
        transform: translateY(15px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Form Styling - Enhanced */
    .form-group {
      margin-bottom: 22px;
      position: relative;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 700;
      color: #333;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.02);
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 13px 16px;
      border: 2px solid #e8e8e8;
      border-radius: 7px;
      font-size: 13px;
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: #f9f9f9;
      color: #333;
    }

    .form-group input::placeholder,
    .form-group textarea::placeholder {
      color: #999;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #ff6600;
      background: #fff;
      box-shadow: 0 0 0 4px rgba(255, 102, 0, 0.08);
      transform: translateY(-2px);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 110px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    .form-group input[type="file"] {
      padding: 10px;
      cursor: pointer;
    }

    .form-group input[type="url"],
    .form-group input[type="email"],
    .form-group input[type="tel"],
    .form-group input[type="date"] {
      font-family: 'Montserrat', sans-serif;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      margin-top: 35px;
      justify-content: flex-end;
      padding-top: 20px;
      border-top: 2px solid #f0f0f0;
    }

    .btn {
      padding: 13px 28px;
      border: 2px solid transparent;
      border-radius: 7px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-family: 'Montserrat', sans-serif;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff6600 0%, #ff8533 100%);
      color: #fff;
      border-color: #ff6600;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #e55a00 0%, #ff7722 100%);
      box-shadow: 0 10px 25px rgba(255, 102, 0, 0.35);
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #333;
      border-color: #e0e0e0;
    }

    .btn-secondary:hover {
      background: #efefef;
      border-color: #d0d0d0;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .btn-danger {
      background: #dc3545;
      color: #fff;
      border-color: #dc3545;
    }

    .btn-danger:hover {
      background: #bb2d3b;
      border-color: #bb2d3b;
      box-shadow: 0 10px 25px rgba(220, 53, 69, 0.35);
    }

    /* Article Table */
    .articles-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .articles-table thead {
      background: #f8f9fa;
      border-bottom: 2px solid #e0e0e0;
    }

    .articles-table th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #333;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 11px;
    }

    .articles-table td {
      padding: 15px;
      border-bottom: 1px solid #e0e0e0;
      vertical-align: middle;
    }

    .articles-table tbody tr:hover {
      background: #f8f9fa;
    }

    .table-actions {
      display: flex;
      gap: 10px;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 11px;
      border-radius: 3px;
    }

    .btn-edit {
      background: #007bff;
      color: #fff;
    }

    .btn-edit:hover {
      background: #0056b3;
    }

    .btn-delete {
      background: #ff4444;
      color: #fff;
    }

    .btn-delete:hover {
      background: #dd0000;
    }

    .btn-view {
      background: #28a745;
      color: #fff;
    }

    .btn-view:hover {
      background: #1e7e34;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-draft {
      background: #e0e0e0;
      color: #666;
    }

    .status-published {
      background: #d4edda;
      color: #155724;
    }

    .status-archived {
      background: #f8d7da;
      color: #721c24;
    }

    /* No Data Message */
    .no-data {
      text-align: center;
      padding: 50px 20px;
      color: #999;
    }

    .no-data i {
      font-size: 48px;
      color: #ddd;
      margin-bottom: 15px;
      display: block;
    }

    /* Configuration Grid */
    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
    }

    .config-card {
      background: #f8f9fa;
      padding: 25px;
      border-left: 5px solid #ff6600;
      transition: all 0.3s ease;
    }

    .config-card:hover {
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      transform: translateY(-2px);
    }

    .config-card h3 {
      font-size: 15px;
      font-weight: 600;
      color: #172434;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .config-card i {
      color: #ff6600;
      font-size: 18px;
    }

    .config-card p {
      font-size: 12px;
      color: #666;
      margin-bottom: 15px;
      line-height: 1.6;
    }

    /* Modal Styles - Enhanced & Responsive */
    .modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.65);
      animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      align-items: center;
      justify-content: center;
    }

    .modal.active,
    .modal[style*="display: block"],
    .modal[style*="display:flex"] {
      display: flex !important;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background-color: #fff;
      padding: 0;
      border-radius: 12px;
      width: 95%;
      max-width: 750px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.25),
        0 0 1px rgba(0, 0, 0, 0.1);
      animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .modal-content::-webkit-scrollbar {
      width: 8px;
    }

    .modal-content::-webkit-scrollbar-track {
      background: #f5f5f5;
      border-radius: 10px;
    }

    .modal-content::-webkit-scrollbar-thumb {
      background: #ff6600;
      border-radius: 10px;
      transition: background 0.3s ease;
    }

    .modal-content::-webkit-scrollbar-thumb:hover {
      background: #e55a00;
    }

    @keyframes slideDown {
      from {
        transform: scale(0.95) translateY(-30px);
        opacity: 0;
      }

      to {
        transform: scale(1) translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #ff6600 0%, #ff8533 100%);
      color: #fff;
      padding: 25px 30px;
      border-radius: 12px 12px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(255, 102, 0, 0.15);
      flex-shrink: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-header h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
      letter-spacing: 0.3px;
    }

    .modal-header i {
      font-size: 22px;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: #fff;
      font-size: 28px;
      font-weight: 300;
      cursor: pointer;
      line-height: 1;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      padding: 0;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.5);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 30px;
      overflow-y: auto;
      max-height: calc(90vh - 90px);
    }

    .modal-body::-webkit-scrollbar {
      width: 8px;
    }

    .modal-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .modal-body::-webkit-scrollbar-thumb {
      background: #ff6600;
      border-radius: 10px;
    }

    .modal-body::-webkit-scrollbar-thumb:hover {
      background: #e55a00;
    }

    .success-message,
    .error-message {
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none !important;
      animation: slideDown 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-left: 5px solid;
      align-items: center;
      gap: 12px;
      font-weight: 500;
      font-size: 13px;
    }

    .success-message {
      background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
      color: #155724;
      border-left-color: #28a745;
    }

    .success-message i {
      font-size: 18px;
      flex-shrink: 0;
    }

    .error-message {
      background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
      color: #721c24;
      border-left-color: #dc3545;
    }

    .error-message i {
      font-size: 18px;
      flex-shrink: 0;
    }

    .success-message.active,
    .error-message.active {
      display: flex !important;
    }

    .team-members-list {
      margin-top: 30px;
    }

    .team-member-card {
      background: #f8f9fa;
      border-left: 5px solid #ff6600;
      padding: 20px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }

    .team-member-card:hover {
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      transform: translateX(5px);
    }

    .team-member-info {
      flex: 1;
    }

    .team-member-info h4 {
      margin: 0 0 5px 0;
      font-size: 16px;
      color: #172434;
    }

    .team-member-info .position {
      color: #ff6600;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .team-member-info .bio {
      color: #666;
      font-size: 12px;
      line-height: 1.5;
      margin-bottom: 8px;
    }

    .team-member-info .linkedin {
      color: #0077b5;
      font-size: 11px;
      text-decoration: none;
    }

    .team-member-info .linkedin:hover {
      text-decoration: underline;
    }

    .team-member-actions {
      display: flex;
      gap: 8px;
    }

    .status-active {
      color: #28a745;
      font-size: 11px;
      font-weight: 600;
    }

    .status-inactive {
      color: #dc3545;
      font-size: 11px;
      font-weight: 600;
    }

    /* Three Dots Menu */
    .dropdown-menu {
      position: relative;
      display: inline-block;
    }

    .dropdown-toggle {
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 5px 10px;
      font-size: 18px;
      color: #666;
      transition: all 0.3s ease;
    }

    .dropdown-toggle:hover {
      color: #ff6600;
      background: #f8f9fa;
      border-radius: 3px;
    }

    .dropdown-content {
      display: none;
      position: absolute;
      right: 0;
      background-color: #fff;
      min-width: 150px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      border-radius: 5px;
      overflow: hidden;
      animation: slideDown 0.2s ease;
    }

    .dropdown-content.show {
      display: block;
    }

    .dropdown-content button {
      width: 100%;
      padding: 12px 20px;
      border: none;
      background: transparent;
      text-align: left;
      cursor: pointer;
      font-size: 12px;
      color: #333;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dropdown-content button:hover {
      background: #f8f9fa;
    }

    .dropdown-content button.delete-option {
      color: #dc3545;
    }

    .dropdown-content button.delete-option:hover {
      background: #fff5f5;
    }

    .dropdown-content button i {
      width: 16px;
      text-align: center;
    }

    .team-photo {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #f0f0f0;
    }

    .bio-cell {
      max-width: 300px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    @media (max-width: 1024px) {
      .container {
        padding: 0 20px;
      }

      .stats-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .stat-card {
        padding: 15px;
        flex-direction: column;
        text-align: center;
      }

      /* Modal improvements for tablet */
      .modal.active {
        padding: 20px;
      }

      .modal-content {
        width: 95%;
        max-width: 800px;
        max-height: 90vh;
      }

      .modal-header {
        padding: 20px 25px;
      }

      .modal-header h3 {
        font-size: 18px;
      }

      .modal-body {
        padding: 25px;
      }

      /* Switch to horizontal tabs on tablet */
      .tabs-container {
        flex-direction: column;
        min-height: auto;
      }

      .tabs-header {
        flex-direction: row;
        width: 100%;
        border-right: none;
        border-bottom: 3px solid #e8e8e8;
        overflow-x: auto;
        overflow-y: hidden;
        -webkit-overflow-scrolling: touch;
        background: linear-gradient(to right, #fafafa 0%, #fff 100%);
        gap: 4px;
        padding: 0 8px;
        scrollbar-width: thin;
        scrollbar-color: #ff6600 #f0f0f0;
      }

      .tabs-header::-webkit-scrollbar {
        width: auto;
        height: 6px;
      }

      .tabs-header::-webkit-scrollbar-track {
        background: #f0f0f0;
      }

      .tabs-header::-webkit-scrollbar-thumb {
        background: #ff6600;
        border-radius: 3px;
      }

      .tabs-header::-webkit-scrollbar-thumb:hover {
        background: #e55a00;
      }

      .tab-button {
        width: auto;
        min-width: 70px;
        border-left: none;
        border-bottom: 4px solid transparent;
        padding: 12px 12px;
        font-size: 11px;
        font-weight: 600;
        white-space: nowrap;
        flex: 0 0 auto;
        height: auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 4px;
        transition: all 0.3s ease;
      }

      .tab-button i {
        font-size: 18px;
        width: auto;
      }

      .tab-button:hover {
        background: rgba(255, 102, 0, 0.1);
        color: #ff6600;
      }

      .tab-button::after {
        display: none;
      }

      .tab-button.active {
        border-left: none;
        border-bottom: 4px solid #ff6600;
        background: rgba(255, 102, 0, 0.08);
        color: #ff6600;
      }

      .tab-button.active i {
        color: #ff6600;
        transform: scale(1.1);
      }

      .tabs-content-wrapper {
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding: 20px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .tabs-header {
        padding: 0 4px;
        gap: 2px;
      }

      .tab-button {
        min-width: 60px;
        padding: 10px 8px;
        font-size: 10px;
      }

      .tabs-content-wrapper {
        padding: 15px;
      }

      .form-group label {
        font-size: 12px;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        font-size: 14px;
        padding: 8px 10px;
      }

      .btn {
        padding: 8px 10px;
        font-size: 11px;
      }

      h2 {
        font-size: 18px;
      }

      .dashboard-user-info {
        text-align: center;
        margin-top: 10px;
      }

      .stats-row {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .stat-card {
        padding: 12px;
        gap: 10px;
      }

      .stat-icon {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }

      .stat-value {
        font-size: 18px;
      }
    }

    @media (max-width: 480px) {
      .tabs-header {
        padding: 0 2px;
        gap: 1px;
      }

      .tab-button {
        min-width: 50px;
        padding: 8px 6px;
        font-size: 9px;
      }

      .tab-button i {
        font-size: 16px;
      }

      .tabs-content-wrapper {
        padding: 12px;
      }

      .form-row {
        gap: 10px;
      }

      .form-group label {
        font-size: 11px;
        font-weight: 600;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        font-size: 14px;
        padding: 8px;
      }

      .btn {
        padding: 8px 8px;
        font-size: 10px;
      }

      h2 {
        font-size: 16px;
      }

      .articles-table {
        font-size: 11px;
      }

      .articles-table th,
      .articles-table td {
        padding: 8px 4px;
      }

      .articles-table th:nth-child(n+3),
      .articles-table td:nth-child(n+3) {
        font-size: 10px;
        padding: 6px 4px;
      }
      .modal.active {
        padding: 15px;
      }

      .modal-content {
        width: 96%;
        max-width: 100%;
        max-height: 90vh;
        border-radius: 12px;
      }

      .modal-header {
        padding: 18px 22px;
        flex-wrap: wrap;
        gap: 12px;
      }

      .modal-header h3 {
        font-size: 16px;
        flex: 1 1 auto;
        min-width: 0;
        word-break: break-word;
      }

      .modal-header i {
        font-size: 18px;
      }

      .modal-close {
        width: 32px;
        height: 32px;
        font-size: 24px;
      }

      .modal-body {
        padding: 20px;
        max-height: calc(90vh - 80px);
      }

      .form-row {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .form-group {
        margin-bottom: 18px;
      }

      .form-group label {
        font-size: 11px;
        margin-bottom: 8px;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        padding: 11px 14px;
        font-size: 12px;
      }

      .form-actions {
        flex-direction: column;
        gap: 10px;
        margin-top: 25px;
      }

      .btn {
        width: 100%;
        justify-content: center;
        padding: 11px 20px;
        font-size: 11px;
      }

      .articles-table {
        font-size: 12px;
      }

      .articles-table th,
      .articles-table td {
        padding: 8px 6px;
      }

      .btn-sm {
        padding: 4px 8px;
        font-size: 10px;
      }

      .config-grid {
        grid-template-columns: 1fr;
      }

      /* Ensure horizontal tabs on mobile */
      .tabs-container {
        flex-direction: column;
        border-top: 3px solid #ff6600;
        box-shadow: 0 1px 4px rgba(255, 102, 0, 0.06);
      }

      .tabs-header {
        flex-direction: row;
        width: 100%;
        border-right: none;
        border-bottom: 2px solid #e0e0e0;
        overflow-x: auto;
        flex-wrap: nowrap;
        -webkit-overflow-scrolling: touch;
        background: linear-gradient(to right, #f5f5f5 0%, #fff 100%);
      }

      .tabs-header::-webkit-scrollbar {
        width: auto;
        height: 4px;
      }

      .tab-button {
        width: auto;
        border-left: none;
        border-bottom: 3px solid transparent;
        padding: 12px 14px;
        font-size: 10px;
        min-width: fit-content;
        flex: 0 0 auto;
        gap: 6px;
      }

      .tab-button::after {
        display: none;
      }

      .tab-button.active {
        border-left: none;
        border-bottom: 3px solid #ff6600;
      }

      .tab-button i {
        font-size: 12px;
        transition: all 0.3s ease;
      }

      .tab-content {
        padding: 15px 12px;
      }

      .tabs-content-wrapper {
        overflow-y: auto;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 18px;
      }

      h2 {
        font-size: 16px;
      }

      .stats-row {
        grid-template-columns: 1fr;
        gap: 8px;
        margin-bottom: 15px;
      }

      .stat-card {
        padding: 10px;
        gap: 8px;
      }

      .stat-icon {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }

      .stat-label {
        font-size: 9px;
      }

      .stat-value {
        font-size: 16px;
      }

      /* Small screen modal optimizations */
      .modal.active {
        padding: 10px;
        align-items: flex-start;
      }

      .modal-content {
        width: 98%;
        max-height: 95vh;
        margin-top: 20px;
        border-radius: 10px;
      }

      .modal-header {
        padding: 16px 18px;
        border-radius: 10px 10px 0 0;
      }

      .modal-header h3 {
        font-size: 14px;
      }

      .modal-header i {
        font-size: 16px;
      }

      .modal-close {
        width: 30px;
        height: 30px;
        font-size: 22px;
      }

      .modal-body {
        padding: 16px;
        max-height: calc(95vh - 70px);
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        font-size: 10px;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        font-size: 11px;
        padding: 10px 12px;
      }

      .form-actions {
        flex-direction: column;
        gap: 8px;
        margin-top: 20px;
      }

      .btn {
        width: 100%;
        justify-content: center;
        padding: 10px 15px;
        font-size: 10px;
        border-radius: 6px;
      }

      .table-actions {
        flex-direction: column;
        gap: 4px;
      }

      .btn-sm {
        width: 100%;
        padding: 6px 4px;
        font-size: 10px;
      }

      .articles-table {
        font-size: 10px;
      }

      .articles-table th,
      .articles-table td {
        padding: 6px 4px;
      }

      /* Horizontal tabs for small mobile */
      .tabs-container {
        flex-direction: column;
        border-top: 3px solid #ff6600;
        box-shadow: 0 1px 3px rgba(255, 102, 0, 0.05);
        border-radius: 0;
      }

      .tabs-header {
        flex-direction: row;
        width: 100%;
        border-right: none;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        background: linear-gradient(to right, #f0f0f0 0%, #fff 100%);
        border-bottom: 1px solid #e8e8e8;
      }

      .tabs-header::-webkit-scrollbar {
        height: 4px;
      }

      .tab-button {
        width: auto;
        border-left: none;
        border-bottom: 2px solid transparent;
        padding: 12px 12px;
        font-size: 9px;
        min-width: fit-content;
        flex: 0 0 auto;
        gap: 4px;
        letter-spacing: 0.3px;
      }

      .tab-button i {
        font-size: 11px;
      }

      .tab-button::after {
        display: none;
      }

      .tab-button.active {
        border-left: none;
        border-bottom: 2px solid #ff6600;
      }

      .tabs-content-wrapper {
        overflow-y: auto;
      }

      .tab-content {
        padding: 12px 10px;
      }

      /* Responsive Tab Content */
      .tab-content h2 {
        font-size: 18px;
        margin-bottom: 15px;
      }

      .tab-content p {
        font-size: 12px;
        line-height: 1.4;
      }

      .articles-table {
        font-size: 11px !important;
      }

      .articles-table th,
      .articles-table td {
        padding: 8px 4px !important;
      }

      .btn {
        padding: 6px 12px !important;
        font-size: 11px !important;
      }

      .btn-sm {
        padding: 4px 8px !important;
        font-size: 9px !important;
      }

      /* Responsive Forms */
      form {
        width: 100%;
      }

      .form-group {
        margin-bottom: 12px;
      }

      .form-group label {
        font-size: 12px;
        margin-bottom: 4px;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        font-size: 12px;
        padding: 6px !important;
      }

      /* Responsive Flex Layouts */
      [style*="display: flex"] {
        flex-wrap: wrap;
        gap: 10px;
      }

      /* Responsive Grid */
      [style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
      }

      /* Ensure tables are scrollable */
      .articles-table {
        min-width: 100%;
      }
    }
  </style>
</head>

<body data-requires-auth="true">
  <!-- preloader -->
  <div class="bg-preloader"></div>
  <div class="preloader">
    <div class="mainpreloader">
      <span></span>
    </div>
  </div>
  <!-- preloader end -->

  <!-- content wrapper -->
  <div class="content-wrapper">

    <!-- subheader -->
    <section id="subheader">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
              <h1>ADMIN DASHBOARD</h1>
              <div class="dashboard-user-info" style="float: none; margin-top: 0;">
                <button type="button" onclick="logout(); return false;" class="logout-link" style="float: none; margin-top: 5px; display: inline-block; color: black; background: none; border: none; cursor: pointer; font-size: 14px;" title="Logout from Dashboard">
                  <i class="fa fa-sign-out"></i> Logout
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- devider -->
        <div class="row">
          <div class="col-md-12">
            <div class="devider-page">
              <div class="devider-img-right">
              </div>
            </div>
          </div>

          <div class="col-md-12">
            <ul class="subdetail">
              <li>
                <a href="{% url 'home' %}">Home</a>
              </li>
              <li class="sep">/</li>
              <li>Dashboard</li>
            </ul>
          </div>
        </div>
      </div>
    </section>
    <!-- subheader end -->

    <!-- Main Content -->
    <section class="whitepage">
      <div class="container">
        <!-- Stats Row -->
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fa fa-file-text"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Total Articles</div>
              <div class="stat-value" id="totalArticles">0</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fa fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Published</div>
              <div class="stat-value" id="publishedArticles">0</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fa fa-pencil"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Drafts</div>
              <div class="stat-value" id="draftArticles">0</div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fa fa-eye"></i>
            </div>
            <div class="stat-content">
              <div class="stat-label">Total Views</div>
              <div class="stat-value" id="totalViews">0</div>
            </div>
          </div>
        </div>

        <!-- Tabs Container -->
        <div class="tabs-container">
          <div class="tabs-header">
            <button type="button" class="tab-button active" data-tab="add-article" title="Add new article"><i class="fa fa-plus"></i> Add Article</button>
            <button type="button" class="tab-button" data-tab="articles-list" title="View all articles"><i class="fa fa-list"></i> Articles List</button>
            <button type="button" class="tab-button" data-tab="about" title="Manage about page"><i class="fa fa-info-circle"></i> About</button>
            <button type="button" class="tab-button" data-tab="projects" title="Manage projects"><i class="fa fa-building"></i> Projects</button>
            <button type="button" class="tab-button" data-tab="project-categories" title="Manage project categories"><i class="fa fa-folder"></i> Project Categories</button>
            <button type="button" class="tab-button" data-tab="services" title="Manage services"><i class="fa fa-cogs"></i> Services</button>
            <button type="button" class="tab-button" data-tab="service-categories" title="Manage service categories"><i class="fa fa-list-alt"></i> Service Categories</button>
            <button type="button" class="tab-button" data-tab="team-members" title="Manage team members"><i class="fa fa-users"></i> Team Members</button>
            <button type="button" class="tab-button" data-tab="leads" title="View leads"><i class="fa fa-envelope"></i> Leads</button>
            <button type="button" class="tab-button" data-tab="clients" title="Manage clients"><i class="fa fa-briefcase"></i> Clients</button>
            <button type="button" class="tab-button" data-tab="careers" title="Manage careers"><i class="fa fa-graduation-cap"></i> Careers</button>
            <button type="button" class="tab-button" data-tab="notices" title="Manage notices"><i class="fa fa-bullhorn"></i> Notices</button>
            <button type="button" class="tab-button" data-tab="job-applications" title="View job applications"><i class="fa fa-file-text"></i> Applications</button>
            <button type="button" class="tab-button" data-tab="configurations" title="Configure site settings"><i class="fa fa-cog"></i> Configurations</button>
            <button type="button" class="tab-button" data-tab="analytics" title="View analytics"><i class="fa fa-bar-chart"></i> Analytics</button>
          </div>
          <div class="tabs-content-wrapper">
          <!-- Tab: About -->
          <div class="tab-content" id="about">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;">About Page Management</h2>
              <button type="button" class="btn btn-primary" onclick="openAddAboutModal()" title="Add new about content">
                <i class="fa fa-plus"></i> Add About Content
              </button>
            </div>
            
            <!-- About List Table -->
            <div style="overflow-x: auto;">
              <table class="articles-table" id="aboutTable">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Published</th>
                    <th>Last Updated</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="aboutTableBody">
                  <tr><td colspan="4" class="no-data">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Projects -->
          <div class="tab-content" id="projects">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;">Projects</h2>
              <button type="button" class="btn btn-primary" onclick="openAddProjectModal()" title="Add a new project">
                <i class="fa fa-plus"></i> Add Project
              </button>
            </div>
            <div style="overflow-x: auto;">
              <table class="articles-table" id="projectsTable">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Featured</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="projectsTableBody">
                  <tr><td colspan="5" class="no-data">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Project Categories -->
          <div class="tab-content" id="project-categories">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;">Project Categories</h2>
              <button type="button" class="btn btn-primary" onclick="openAddProjectCategoryModal()" title="Add a new project category">
                <i class="fa fa-plus"></i> Add Category
              </button>
            </div>
            <div style="overflow-x: auto;">
              <table class="articles-table" id="projectCategoriesTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Active</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="projectCategoriesTableBody">
                  <tr><td colspan="4" class="no-data">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Services -->
          <div class="tab-content" id="services">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;">Services</h2>
              <button type="button" class="btn btn-primary" onclick="openAddServiceModal()" title="Add a new service">
                <i class="fa fa-plus"></i> Add Service
              </button>
            </div>
            <div style="overflow-x: auto;">
              <table class="articles-table" id="servicesTable">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Featured</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="servicesTableBody">
                  <tr><td colspan="5" class="no-data">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Service Categories -->
          <div class="tab-content" id="service-categories">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;">Service Categories</h2>
              <button type="button" class="btn btn-primary" onclick="openAddServiceCategoryModal()" title="Add a new service category">
                <i class="fa fa-plus"></i> Add Category
              </button>
            </div>
            <div style="overflow-x: auto;">
              <table class="articles-table" id="serviceCategoriesTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Icon</th>
                    <th>Active</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="serviceCategoriesTableBody">
                  <tr><td colspan="5" class="no-data">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab 1: Add Article -->
          <div class="tab-content active" id="add-article">
            <h2>Create New Article</h2>
            <p style="color: #999; margin-bottom: 25px; margin-top: 20px;">Fill in the form below to create a new blog article.</p>

            <form id="addArticleForm" method="POST" action="process_article.php" enctype="multipart/form-data">
              <input type="hidden" name="action" value="add">

              <div class="form-row">
                <div class="form-group">
                  <label for="title">Article Title *</label>
                  <input type="text" id="title" name="title" placeholder="Enter article title" required />
                </div>
                <div class="form-group">
                  <label for="author">Author</label>
                  <input type="text" id="author" name="author" placeholder="Your name" />
                </div>
              </div>

              <div class="form-group">
                <label for="excerpt">Excerpt *</label>
                <input type="text" id="excerpt" name="excerpt" placeholder="Short summary of the article (max 500 characters)" maxlength="500" required />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="category">Category</label>
                  <div style="display: flex; gap: 8px;">
                    <select id="category" name="category" style="flex: 1;">
                      <option value="">-- Select or Create Category --</option>
                    </select>
                    <button type="button" id="addNewBlogCategory" class="btn btn-sm" style="background: #ff6600; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 600;" onclick="openAddBlogCategoryModal()" title="Create new article category"><i class="fa fa-plus"></i> New</button>
                  </div>
                </div>
                <div class="form-group">
                  <label for="tags">Tags</label>
                  <input type="text" id="tags" name="tags" placeholder="Comma-separated tags" />
                </div>
              </div>

              <div class="form-group">
                <label for="content">Article Content *</label>
                <div id="contentEditor" style="height: 300px; background: #fff;"></div>
                <input type="hidden" id="content" name="content">

              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="featuredImage">Featured Image</label>
                  <input type="file" id="featuredImage" name="featured_image" accept="image/*" />
                </div>
                <div class="form-group">
                  <label for="status">Status *</label>
                  <select id="status" name="status" required>
                    <option value="">-- Select Status --</option>
                    <option value="draft">Draft</option>
                    <option value="published">Published</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label for="metaDescription">SEO Meta Description</label>
                <textarea id="metaDescription" name="meta_description" placeholder="Meta description for search engines (max 160 characters)" maxlength="160" style="min-height: 60px;"></textarea>
              </div>

              <div class="form-group">
                <label for="metaKeywords">SEO Keywords</label>
                <input type="text" id="metaKeywords" name="meta_keywords" placeholder="Comma-separated keywords for SEO" />
              </div>

              <div class="form-actions">
                <button type="reset" class="btn btn-secondary" title="Reset form">
                  <i class="fa fa-times"></i> Reset
                </button>
                <button type="submit" class="btn btn-primary" title="Create new article">
                  <i class="fa fa-save"></i> Create Article
                </button>
              </div>
            </form>
          </div>

          <!-- Tab 2: Articles List -->
          <div class="tab-content" id="articles-list">
            <div style="margin-bottom: 30px;">
              <h2 style="margin: 0 0 20px 0; color: #172434;">All Articles</h2>
              
              <!-- Search & Filter Controls -->
              <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 5px solid #ff6600;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                  <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; color: #333; margin-bottom: 8px; text-transform: uppercase;">Search Articles</label>
                    <input type="text" id="searchArticles" placeholder="Search by title or author..." 
                      style="width: 100%; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 13px; transition: all 0.3s;" 
                      onkeyup="filterArticles()" />
                  </div>
                  <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; color: #333; margin-bottom: 8px; text-transform: uppercase;">Filter by Status</label>
                    <select id="filterStatus" style="width: 100%; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 13px; transition: all 0.3s;" onchange="filterArticles()">
                      <option value="">All Status</option>
                      <option value="draft">Draft</option>
                      <option value="published">Published</option>
                      <option value="archived">Archived</option>
                    </select>
                  </div>
                  <div>
                    <label style="display: block; font-size: 11px; font-weight: 600; color: #333; margin-bottom: 8px; text-transform: uppercase;">Sort By</label>
                    <select id="sortArticles" style="width: 100%; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 5px; font-size: 13px; transition: all 0.3s;" onchange="filterArticles()">
                      <option value="newest">Newest First</option>
                      <option value="oldest">Oldest First</option>
                      <option value="title-asc">Title A-Z</option>
                      <option value="title-desc">Title Z-A</option>
                      <option value="views">Most Viewed</option>
                    </select>
                  </div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                  <div style="font-size: 12px; color: #666;">
                    <strong>Results:</strong> <span id="articleCount" style="color: #ff6600; font-weight: 600;">0</span> articles found
                  </div>
                  <button type="button" class="btn btn-primary" onclick="resetFilters()" style="padding: 8px 16px; font-size: 11px;" title="Reset filters and show all articles">
                    <i class="fa fa-refresh"></i> Reset Filters
                  </button>
                </div>
              </div>
            </div>

            <div style="overflow-x: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <table class="articles-table" id="articlesTable" style="border-radius: 8px; overflow: hidden;">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Status</th>
                    <th>Views</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="articlesTableBody">
                  <tr>
                    <td colspan="6" class="no-data">
                      <i class="fa fa-inbox"></i>
                      <p>No articles found. Create your first article!</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab 3: Edit Article -->
          <div class="tab-content" id="configurations">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-cog"></i> Site Configuration</h2>
              <button type="button" class="btn btn-success" onclick="saveConfiguration()" id="saveConfigBtn" title="Save configuration changes">
                <i class="fa fa-save"></i> Save Changes
              </button>
            </div>
            <p style="color: #999; margin-bottom: 25px;">Manage your site's general settings, contact information, and tracking codes.</p>

            <form id="configFormView" style="max-width: 900px;">
              <!-- Basic Information Section -->
              <fieldset style="border: 1px solid #ddd; border-radius: 5px; padding: 20px; margin-bottom: 25px;">
                <legend style="padding: 0 10px; font-weight: 600; font-size: 14px;">Basic Information</legend>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Company Name *</label>
                    <input type="text" id="configCompanyNameView" class="form-control" required placeholder="Your Company Name" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Email *</label>
                    <input type="email" id="configEmailView" class="form-control" required placeholder="contact@company.com" />
                  </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Phone *</label>
                    <input type="text" id="configPhoneView" class="form-control" required placeholder="+1 (555) 000-0000" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Website</label>
                    <input type="url" id="configWebsiteView" class="form-control" placeholder="https://yoursite.com" />
                  </div>
                </div>

                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 500;">Address *</label>
                  <textarea id="configAddressView" class="form-control" rows="3" required placeholder="Full address"></textarea>
                </div>

                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 500;">About Excerpt</label>
                  <textarea id="configAboutExcerptView" class="form-control" rows="3" placeholder="Brief company description"></textarea>
                </div>

                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 500;">Site Logo</label>
                  <div style="display: flex; gap: 15px; align-items: flex-start;">
                    <div id="logoPreviewView" style="width: 100px; height: 100px; border: 1px solid #ddd; border-radius: 5px; display: flex; align-items: center; justify-content: center; background: #f9f9f9; overflow: hidden;">
                      <i class="fa fa-image" style="font-size: 30px; color: #ccc;"></i>
                    </div>
                    <div style="flex: 1;">
                      <input type="file" id="configLogoView" accept="image/*" class="form-control" />
                      <small style="color: #999; display: block; margin-top: 5px;">PNG, JPG, SVG (Max 2MB)</small>
                    </div>
                  </div>
                  <input type="hidden" id="configLogoAltView" />
                </div>
              </fieldset>

              <!-- Social Links Section -->
              <fieldset style="border: 1px solid #ddd; border-radius: 5px; padding: 20px; margin-bottom: 25px;">
                <legend style="padding: 0 10px; font-weight: 600; font-size: 14px;">Social Media Links</legend>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;"><i class="fa fa-facebook"></i> Facebook</label>
                    <input type="url" id="configFacebookView" class="form-control" placeholder="https://facebook.com/yourpage" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;"><i class="fa fa-instagram"></i> Instagram</label>
                    <input type="url" id="configInstagramView" class="form-control" placeholder="https://instagram.com/yourprofile" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;"><i class="fa fa-youtube"></i> YouTube</label>
                    <input type="url" id="configYoutubeView" class="form-control" placeholder="https://youtube.com/@yourchannel" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;"><i class="fa fa-linkedin"></i> LinkedIn</label>
                    <input type="url" id="configLinkedinView" class="form-control" placeholder="https://linkedin.com/company/yourcompany" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;"><i class="fa fa-twitter"></i> X (Twitter)</label>
                    <input type="url" id="configTwitterView" class="form-control" placeholder="https://x.com/yourhandle" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;"><i class="fa fa-link"></i> Custom Link</label>
                    <input type="url" id="configCustomLinkUrlView" class="form-control" placeholder="https://example.com" />
                  </div>
                </div>
                <div style="margin-top: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 500;">Custom Link Text</label>
                  <input type="text" id="configCustomLinkTextView" class="form-control" placeholder="e.g., 'Visit Our Store'" />
                </div>
              </fieldset>

              <!-- Analytics & Tracking Section -->
              <fieldset style="border: 1px solid #ddd; border-radius: 5px; padding: 20px; margin-bottom: 25px;">
                <legend style="padding: 0 10px; font-weight: 600; font-size: 14px;">Analytics & Tracking</legend>
                
                <div style="margin-bottom: 15px;">
                  <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="configEnableAnalyticsView" />
                    <span>Enable Analytics</span>
                  </label>
                </div>

                <div style="margin-bottom: 15px;">
                  <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="configEnableTrackingView" />
                    <span>Enable Tracking</span>
                  </label>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Google Analytics ID</label>
                    <input type="text" id="configGoogleAnalyticsIdView" class="form-control" placeholder="G-XXXXXXXXXX" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Google Tag Manager ID</label>
                    <input type="text" id="configGoogleTagManagerIdView" class="form-control" placeholder="GTM-XXXXXXX" />
                  </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Facebook Pixel ID</label>
                    <input type="text" id="configFacebookPixelId" class="form-control" placeholder="1234567890123456" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Hotjar ID</label>
                    <input type="text" id="configHotjarId" class="form-control" placeholder="1234567" />
                  </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">Microsoft Clarity ID</label>
                    <input type="text" id="configClarityId" class="form-control" placeholder="pxxxxxxxx" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;">reCAPTCHA Site Key</label>
                    <input type="text" id="configRecaptchaSiteKey" class="form-control" placeholder="6Le..." />
                  </div>
                </div>

                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 500;">reCAPTCHA Secret Key</label>
                  <input type="password" id="configRecaptchaSecretKey" class="form-control" placeholder="6Le..." />
                </div>

                <div style="margin-bottom: 15px;">
                  <label style="display: block; margin-bottom: 5px; font-weight: 500;">Custom Tracking Code</label>
                  <textarea id="configCustomTrackingCode" class="form-control" rows="4" placeholder="Paste custom analytics/tracking scripts here"></textarea>
                </div>
              </fieldset>

              <!-- Form Actions -->
              <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="reset" class="btn btn-secondary" onclick="loadConfiguration()" title="Load configuration">
                  <i class="fa fa-undo"></i> Reset
                </button>
                <button type="button" class="btn btn-success" onclick="saveConfiguration()" title="Save configuration changes">
                  <i class="fa fa-save"></i> Save Configuration
                </button>
              </div>
            </form>
          </div>

          <!-- Tab 6: Analytics -->
          <div class="tab-content" id="analytics">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-bar-chart"></i> Analytics Dashboard</h2>
            </div>

            <!-- Analytics Overview Cards -->
            <div class="stats-row" style="margin-bottom: 40px;">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fa fa-file-text"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Total Articles</div>
                  <div class="stat-value" id="analyticsArticles">0</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fa fa-building"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Total Projects</div>
                  <div class="stat-value" id="analyticsProjects">0</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fa fa-cogs"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Total Services</div>
                  <div class="stat-value" id="analyticsServices">0</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fa fa-users"></i>
                </div>
                <div class="stat-content">
                  <div class="stat-label">Team Members</div>
                  <div class="stat-value" id="analyticsTeam">0</div>
                </div>
              </div>
            </div>

            <!-- Charts Section -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px; margin-bottom: 40px;">
              
              <!-- Article Status Chart -->
              <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                  <i class="fa fa-pie-chart"></i> Article Status
                </h3>
                <canvas id="articleStatusChart" style="max-height: 250px;"></canvas>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span><i class="fa fa-circle" style="color: #4CAF50; margin-right: 8px;"></i>Published</span>
                    <span id="publishedCount">0</span>
                  </div>
                  <div style="display: flex; justify-content: space-between;">
                    <span><i class="fa fa-circle" style="color: #FFC107; margin-right: 8px;"></i>Draft</span>
                    <span id="draftCount">0</span>
                  </div>
                </div>
              </div>

              <!-- Content Distribution Chart -->
              <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="margin-top: 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                  <i class="fa fa-bar-chart"></i> Content Distribution
                </h3>
                <canvas id="contentDistributionChart" style="max-height: 250px;"></canvas>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                  <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span><i class="fa fa-file-text" style="color: #2196F3; margin-right: 8px;"></i>Articles</span>
                    <span id="chartArticles">0</span>
                  </div>
                  <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span><i class="fa fa-building" style="color: #FF9800; margin-right: 8px;"></i>Projects</span>
                    <span id="chartProjects">0</span>
                  </div>
                  <div style="display: flex; justify-content: space-between;">
                    <span><i class="fa fa-cogs" style="color: #9C27B0; margin-right: 8px;"></i>Services</span>
                    <span id="chartServices">0</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Recent Activity -->
            <div style="background: #f8f9fa; padding: 25px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <h3 style="margin-top: 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                <i class="fa fa-history"></i> Recent Activity
              </h3>
              <div id="recentActivityList" style="max-height: 400px; overflow-y: auto;">
                <p style="color: #999; text-align: center; padding: 20px;">Loading activity...</p>
              </div>
            </div>
          </div>

          <!-- Tab: Team Members -->
          <div class="tab-content" id="team-members">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-users"></i> Team Members</h2>
              <button type="button" class="btn btn-primary" onclick="openAddTeamModal()" title="Add a new team member">
                <i class="fa fa-user-plus"></i> Add Team Member
              </button>
            </div>
            <p style="color: #999; margin-bottom: 25px;">Manage your team members displayed on the website.</p>

            <div style="overflow-x: auto;">
              <table class="articles-table" id="teamTable">
                <thead>
                  <tr>
                    <th>Photo</th>
                    <th>Name</th>
                    <th>Position</th>
                    <th>Bio</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="teamTableBody">
                  <tr>
                    <td colspan="6" class="no-data">
                      <i class="fa fa-users"></i>
                      <p>No team members found. Add your first team member!</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Leads Management -->
          <div class="tab-content" id="leads">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-envelope"></i> Leads Management</h2>
            </div>
            <p style="color: #999; margin-bottom: 25px;">Manage contact form submissions and lead information.</p>

            <div style="overflow-x: auto;">
              <table class="articles-table" id="leadsTable">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Message</th>
                    <th>Status</th>
                    <th>Source</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="leadsTableBody">
                  <tr>
                    <td colspan="8" class="no-data">
                      <i class="fa fa-envelope-o"></i>
                      <p>No leads found.</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Clients Management -->
          <div class="tab-content" id="clients">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-briefcase"></i> Clients Management</h2>
              <button type="button" class="btn btn-primary" onclick="openAddClientModal()" title="Add a new client">
                <i class="fa fa-plus"></i> Add Client
              </button>
            </div>
            <p style="color: #999; margin-bottom: 25px;">Manage client/testimonial information displayed on your website.</p>

            <div style="overflow-x: auto;">
              <table class="articles-table" id="clientsTable">
                <thead>
                  <tr>
                    <th>Logo</th>
                    <th>Name</th>
                    <th>Contact</th>
                    <th>Website</th>
                    <th>Status</th>
                    <th>Order</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="clientsTableBody">
                  <tr>
                    <td colspan="7" class="no-data">
                      <i class="fa fa-briefcase"></i>
                      <p>No clients found. Add your first client!</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Careers -->
          <div class="tab-content" id="careers">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-graduation-cap"></i> Careers Management</h2>
              <button type="button" class="btn btn-primary" onclick="openAddCareerModal()" title="Add a new career posting">
                <i class="fa fa-plus"></i> Add Career
              </button>
            </div>
            <p style="color: #999; margin-bottom: 25px;">Manage job opportunities and career postings on your website.</p>

            <div style="overflow-x: auto;">
              <table class="articles-table" id="careersTable">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Location</th>
                    <th>Job Type</th>
                    <th>Status</th>
                    <th>Deadline</th>
                    <th>Featured</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="careersTableBody">
                  <tr>
                    <td colspan="7" class="no-data">
                      <i class="fa fa-graduation-cap"></i>
                      <p>No careers found. Add your first job posting!</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Notices -->
          <div class="tab-content" id="notices">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-bullhorn"></i> Notices Management</h2>
              <button type="button" class="btn btn-primary" onclick="openAddNoticeModal()" title="Add a new notice">
                <i class="fa fa-plus"></i> Add Notice
              </button>
            </div>
            <p style="color: #999; margin-bottom: 25px;">Manage announcements and notices displayed on your website.</p>

            <div style="overflow-x: auto;">
              <table class="articles-table" id="noticesTable">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Status</th>
                    <th>Priority</th>
                    <th>Notice Date</th>
                    <th>Expiry Date</th>
                    <th>Sticky</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="noticesTableBody">
                  <tr>
                    <td colspan="7" class="no-data">
                      <i class="fa fa-bullhorn"></i>
                      <p>No notices found. Add your first notice!</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Tab: Job Applications -->
          <div class="tab-content" id="job-applications">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
              <h2 style="margin: 0;"><i class="fa fa-file-text"></i> Job Applications Management</h2>
              <div style="display: flex; gap: 15px;">
                <select id="applicationCareerFilter" onchange="filterApplicationsByCareer()" style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                  <option value="">All Career Posts</option>
                </select>
                <select id="applicationStatusFilter" onchange="filterApplicationsByStatus()" style="padding: 10px 15px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                  <option value="">All Statuses</option>
                  <option value="pending">Pending Review</option>
                  <option value="reviewing">Under Review</option>
                  <option value="shortlisted">Shortlisted</option>
                  <option value="rejected">Rejected</option>
                  <option value="accepted">Accepted</option>
                </select>
              </div>
            </div>
            <p style="color: #999; margin-bottom: 25px;">View and manage job applications submitted through your website.</p>

            <div style="overflow-x: auto;">
              <table class="articles-table" id="applicationsTable">
                <thead>
                  <tr>
                    <th>Applicant Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Career Position</th>
                    <th>Status</th>
                    <th>Applied Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="applicationsTableBody">
                  <tr>
                    <td colspan="7" class="no-data">
                      <i class="fa fa-file-text"></i>
                      <p>No applications found.</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          </div>
        </div>
        </div>
      </div>
    </section>

  </div>
  <!-- content wrapper end -->

  <!-- Project Modal -->
  <div id="projectModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-building"></i> <span id="projectModalTitle">Add Project</span></h3>
        <button type="button" class="modal-close" onclick="closeProjectModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="projectSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="projectSuccessText">Project saved successfully!</span>
        </div>
        <div id="projectErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="projectErrorText">An error occurred.</span>
        </div>
        <form id="projectForm">
          <input type="hidden" id="projectId" name="id">
          <div class="form-row">
            <div class="form-group">
              <label for="projectTitle">Title *</label>
              <input type="text" id="projectTitle" name="title" placeholder="Project title" required />
            </div>
            <div class="form-group">
              <label for="projectCategory">Category</label>
              <div style="display: flex; gap: 8px;">
                <select id="projectCategory" name="category" style="flex: 1;"></select>
                <button type="button" class="btn btn-sm" style="background: #ff6600; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 600;" onclick="openAddProjectCategoryModalFromForm()" title="Create new project category"><i class="fa fa-plus"></i> New</button>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="projectStatus">Status *</label>
              <select id="projectStatus" name="status" required>
                <option value="planned">Planned</option>
                <option value="ongoing">Ongoing</option>
                <option value="completed">Completed</option>
              </select>
            </div>
            <div class="form-group">
              <label for="projectFeatured">Featured</label>
              <select id="projectFeatured" name="is_featured">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="projectShortDesc">Short Description</label>
            <input type="text" id="projectShortDesc" name="short_description" placeholder="Brief description (max 500 chars)" maxlength="500" />
          </div>
          <div class="form-group">
            <label for="projectLongDesc">Long Description</label>
            <div id="projectDescEditor" style="height: 200px; background: #fff;"></div>
            <input type="hidden" id="projectLongDesc" name="long_description">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="projectStartDate">Start Date</label>
              <input type="date" id="projectStartDate" name="start_date" />
            </div>
            <div class="form-group">
              <label for="projectEndDate">End Date</label>
              <input type="date" id="projectEndDate" name="end_date" />
            </div>
          </div>

          <!-- Project Cover Image Upload Section -->
          <div style="background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%); border-left: 4px solid #ff6600; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #ff6600; display: flex; align-items: center;"><i class="fa fa-image" style="margin-right: 10px;"></i>Cover Image</h4>
            
            <!-- Image Upload Section -->
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #ffe6cc;">
              <label style="font-weight: 600; font-size: 13px; display: block; margin-bottom: 12px;"><i class="fa fa-upload" style="margin-right: 6px; color: #ff6600;"></i>Upload Image</label>
              <div id="projectImageDropZone" class="image-drop-zone" style="border: 2px dashed #ff6600; border-radius: 8px; padding: 25px; text-align: center; background: #fffaf5; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#fff0e6'" onmouseout="this.style.background='#fffaf5'">
                <input type="file" id="projectImageFileInput" accept="image/*" style="display: none;" />
                <i class="fa fa-cloud-upload" style="font-size: 32px; color: #ff6600; margin-bottom: 12px; display: block;"></i>
                <p style="margin: 0; font-size: 13px; font-weight: 600; color: #ff6600; margin-bottom: 5px;">Click to upload or drag and drop</p>
                <p style="margin: 0; font-size: 11px; color: #999;">PNG, JPG, GIF up to 5MB</p>
              </div>
              <div id="projectImageUploadProgress" style="display: none; margin-top: 12px;">
                <div style="background: #e0e0e0; border-radius: 4px; height: 6px; overflow: hidden;">
                  <div id="projectImageProgressBar" style="background: linear-gradient(90deg, #ff6600, #ff8533); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <p style="font-size: 11px; color: #666; margin: 8px 0 0 0; text-align: center;" id="projectImageProgressText">Uploading...</p>
              </div>
              <div id="projectImageUploadStatus" style="margin-top: 12px;"></div>
            </div>

            <!-- Image Preview -->
            <div style="margin-bottom: 15px;">
              <label style="font-weight: 600; font-size: 13px; display: block; margin-bottom: 12px;">Preview</label>
              <div style="border: 2px dashed #ff6600; border-radius: 8px; padding: 20px; text-align: center; background: #fff; min-height: 150px; display: flex; align-items: center; justify-content: center;">
                <img id="projectImagePreview" src="" alt="Project Image Preview" style="max-width: 100%; max-height: 150px; display: none;" />
                <span id="projectImagePlaceholder" style="color: #999; font-size: 13px;">Preview will appear here</span>
              </div>
            </div>

            <!-- Hidden Image URL Input -->
            <input type="hidden" id="projectCoverImage" name="cover_image" />
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeProjectModal()" title="Cancel and close form"><i class="fa fa-times"></i> Cancel</button>
            <button type="submit" class="btn btn-primary" title="Save project"><i class="fa fa-save"></i> <span id="projectSubmitText">Save Project</span></button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Project Category Modal -->
  <div id="projectCategoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-folder"></i> <span id="projectCatModalTitle">Add Project Category</span></h3>
        <button type="button" class="modal-close" onclick="closeProjectCategoryModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="projectCatSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="projectCatSuccessText">Category saved successfully!</span>
        </div>
        <div id="projectCatErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="projectCatErrorText">An error occurred.</span>
        </div>
        <form id="projectCategoryForm">
          <input type="hidden" id="projectCatId" name="id">
          <div class="form-group">
            <label for="projectCatName">Category Name *</label>
            <input type="text" id="projectCatName" name="name" placeholder="e.g., Residential, Commercial" required />
          </div>
          <div class="form-group">
            <label for="projectCatDesc">Description</label>
            <textarea id="projectCatDesc" name="description" placeholder="Category description..." style="min-height: 80px;"></textarea>
          </div>
          <div class="form-group">
            <label for="projectCatActive">Status</label>
            <select id="projectCatActive" name="is_active">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeProjectCategoryModal()" title="Cancel and close form"><i class="fa fa-times"></i> Cancel</button>
            <button type="submit" class="btn btn-primary" title="Save project category"><i class="fa fa-save"></i> <span id="projectCatSubmitText">Save Category</span></button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Service Modal -->
  <div id="serviceModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-cogs"></i> <span id="serviceModalTitle">Add Service</span></h3>
        <button type="button" class="modal-close" onclick="closeServiceModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="serviceSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="serviceSuccessText">Service saved successfully!</span>
        </div>
        <div id="serviceErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="serviceErrorText">An error occurred.</span>
        </div>
        <form id="serviceForm">
          <input type="hidden" id="serviceId" name="id">
          <div class="form-row">
            <div class="form-group">
              <label for="serviceTitle">Title *</label>
              <input type="text" id="serviceTitle" name="title" placeholder="Service title" required />
            </div>
            <div class="form-group">
              <label for="serviceCategory">Category</label>
              <div style="display: flex; gap: 8px;">
                <select id="serviceCategory" name="category" style="flex: 1;"></select>
                <button type="button" class="btn btn-sm" style="background: #ff6600; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 600;" onclick="openAddServiceCategoryModalFromForm()" title="Create new service category"><i class="fa fa-plus"></i> New</button>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="serviceStatus">Status *</label>
              <select id="serviceStatus" name="status" required>
                <option value="draft">Draft</option>
                <option value="published">Published</option>
                <option value="archived">Archived</option>
              </select>
            </div>
            <div class="form-group">
              <label for="serviceFeatured">Featured</label>
              <select id="serviceFeatured" name="is_featured">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="serviceExcerpt">Excerpt</label>
            <input type="text" id="serviceExcerpt" name="excerpt" placeholder="Brief description (max 500 chars)" maxlength="500" />
          </div>
          <div class="form-group">
            <label for="serviceContent">Content</label>
            <div id="serviceContentEditor" style="height: 200px; background: #fff;"></div>
            <input type="hidden" id="serviceContent" name="content">
          </div>

          <!-- Service Featured Image Upload Section -->
          <div style="background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%); border-left: 4px solid #ff6600; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #ff6600; display: flex; align-items: center;"><i class="fa fa-image" style="margin-right: 10px;"></i>Featured Image</h4>
            
            <!-- Image Upload Section -->
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #ffe6cc;">
              <label style="font-weight: 600; font-size: 13px; display: block; margin-bottom: 12px;"><i class="fa fa-upload" style="margin-right: 6px; color: #ff6600;"></i>Upload Image</label>
              <div id="serviceImageDropZone" class="image-drop-zone" style="border: 2px dashed #ff6600; border-radius: 8px; padding: 25px; text-align: center; background: #fffaf5; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#fff0e6'" onmouseout="this.style.background='#fffaf5'">
                <input type="file" id="serviceImageFileInput" accept="image/*" style="display: none;" />
                <i class="fa fa-cloud-upload" style="font-size: 32px; color: #ff6600; margin-bottom: 12px; display: block;"></i>
                <p style="margin: 0; font-size: 13px; font-weight: 600; color: #ff6600; margin-bottom: 5px;">Click to upload or drag and drop</p>
                <p style="margin: 0; font-size: 11px; color: #999;">PNG, JPG, GIF up to 5MB</p>
              </div>
              <div id="serviceImageUploadProgress" style="display: none; margin-top: 12px;">
                <div style="background: #e0e0e0; border-radius: 4px; height: 6px; overflow: hidden;">
                  <div id="serviceImageProgressBar" style="background: linear-gradient(90deg, #ff6600, #ff8533); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <p style="font-size: 11px; color: #666; margin: 8px 0 0 0; text-align: center;" id="serviceImageProgressText">Uploading...</p>
              </div>
              <div id="serviceImageUploadStatus" style="margin-top: 12px;"></div>
            </div>

            <!-- Image Preview -->
            <div style="margin-bottom: 0;">
              <label style="font-weight: 600; font-size: 13px; display: block; margin-bottom: 12px;">Preview</label>
              <div style="border: 2px dashed #ff6600; border-radius: 8px; padding: 20px; text-align: center; background: #fff; min-height: 150px; display: flex; align-items: center; justify-content: center;">
                <img id="serviceImagePreview" src="" alt="Service Image Preview" style="max-width: 100%; max-height: 150px; display: none;" />
                <span id="serviceImagePlaceholder" style="color: #999; font-size: 13px;">Preview will appear here</span>
              </div>
            </div>

            <!-- Hidden Image URL Input -->
            <input type="hidden" id="serviceFeaturedImage" name="featured_image" />
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeServiceModal()" title="Cancel and close form"><i class="fa fa-times"></i> Cancel</button>
            <button type="submit" class="btn btn-primary" title="Save service"><i class="fa fa-save"></i> <span id="serviceSubmitText">Save Service</span></button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Service Category Modal -->
  <div id="serviceCategoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-list-alt"></i> <span id="serviceCatModalTitle">Add Service Category</span></h3>
        <button type="button" class="modal-close" onclick="closeServiceCategoryModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="serviceCatSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="serviceCatSuccessText">Category saved successfully!</span>
        </div>
        <div id="serviceCatErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="serviceCatErrorText">An error occurred.</span>
        </div>
        <form id="serviceCategoryForm">
          <input type="hidden" id="serviceCatId" name="id">
          <div class="form-group">
            <label for="serviceCatName">Category Name *</label>
            <input type="text" id="serviceCatName" name="name" placeholder="e.g., Design, Consulting" required />
          </div>
          <div class="form-group">
            <label for="serviceCatDesc">Description</label>
            <textarea id="serviceCatDesc" name="description" placeholder="Category description..." style="min-height: 80px;"></textarea>
          </div>
          <div class="form-group">
            <label for="serviceCatIcon">Icon Class</label>
            <input type="text" id="serviceCatIcon" name="icon" placeholder="e.g., fa-pencil" />
          </div>
          <div class="form-group">
            <label for="serviceCatActive">Status</label>
            <select id="serviceCatActive" name="is_active">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeServiceCategoryModal()" title="Cancel and close form"><i class="fa fa-times"></i> Cancel</button>
            <button type="submit" class="btn btn-primary" title="Save service category"><i class="fa fa-save"></i> <span id="serviceCatSubmitText">Save Category</span></button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Article Edit Modal -->
  <div id="articleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-edit"></i> <span id="articleModalTitle">Edit Article</span></h3>
        <button type="button" class="modal-close" onclick="closeArticleModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="articleSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="articleSuccessText">Article updated successfully!</span>
        </div>
        <div id="articleErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="articleErrorText">An error occurred.</span>
        </div>
        <form id="articleForm">
          <input type="hidden" id="articleId" name="id">
          <div class="form-row">
            <div class="form-group">
              <label for="articleTitle">Title *</label>
              <input type="text" id="articleTitle" name="title" placeholder="Article title" required />
            </div>
            <div class="form-group">
              <label for="articleAuthor">Author</label>
              <input type="text" id="articleAuthor" name="author" placeholder="Author name" />
            </div>
          </div>
          <div class="form-group">
            <label for="articleExcerpt">Excerpt</label>
            <input type="text" id="articleExcerpt" name="excerpt" placeholder="Brief summary (max 500 chars)" maxlength="500" />
          </div>
          
          <!-- Image Fields Section -->
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #e0e0e0;">
            <h4 style="margin-top: 0; margin-bottom: 15px; color: #ff6600; font-size: 16px; font-weight: 600;">
              <i class="fa fa-image" style="margin-right: 8px;"></i>Images
            </h4>
            
            <div class="form-row">
              <div class="form-group">
                <label for="articleFeaturedImage">Featured Image</label>
                <input type="file" id="articleFeaturedImage" name="featured_image" accept="image/*" />
                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">Main image displayed with the article (JPG, PNG, WebP)</small>
              </div>
              <div class="form-group">
                <label for="articleFeaturedImageAlt">Featured Image Alt Text</label>
                <input type="text" id="articleFeaturedImageAlt" name="featured_image_alt" placeholder="Description of the image" maxlength="255" />
                <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">For accessibility and SEO</small>
              </div>
            </div>
            
            <div class="form-group">
              <label for="articleThumbnail">Thumbnail Image</label>
              <input type="file" id="articleThumbnail" name="thumbnail" accept="image/*" />
              <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">Small preview image for lists and cards (JPG, PNG, WebP)</small>
            </div>
            
            <!-- Image Previews -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
              <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #fff;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 8px;">Featured Image Preview</label>
                <img id="articleFeaturedImagePreview" src="" alt="Featured Image Preview" style="max-width: 100%; max-height: 150px; display: none; border-radius: 4px; margin: 0 auto;" />
                <span id="articleFeaturedImagePlaceholder" style="color: #999; font-size: 12px; display: block; margin-top: 10px;">No featured image</span>
              </div>
              <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #fff;">
                <label style="font-size: 12px; color: #666; display: block; margin-bottom: 8px;">Thumbnail Preview</label>
                <img id="articleThumbnailPreview" src="" alt="Thumbnail Preview" style="max-width: 100%; max-height: 150px; display: none; border-radius: 4px; margin: 0 auto;" />
                <span id="articleThumbnailPlaceholder" style="color: #999; font-size: 12px; display: block; margin-top: 10px;">No thumbnail</span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="articleContent">Content *</label>
            <div id="articleContentEditor" style="height: 300px;"></div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="articleCategory">Category</label>
              <div style="display: flex; gap: 8px;">
                <select id="articleCategory" name="category" style="flex: 1;">
                  <option value="">-- Select or Create Category --</option>
                </select>
                <button type="button" id="addNewBlogCategoryModal" class="btn btn-sm" style="background: #ff6600; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: 600;" onclick="openAddBlogCategoryModalFromArticle()" title="Create new article category"><i class="fa fa-plus"></i> New</button>
              </div>
            </div>
            <div class="form-group">
              <label for="articleStatus">Status *</label>
              <select id="articleStatus" name="status" required>
                <option value="draft">Draft</option>
                <option value="published">Published</option>
                <option value="archived">Archived</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeArticleModal()" title="Cancel and close form"><i class="fa fa-times"></i> Cancel</button>
            <button type="submit" class="btn btn-primary" title="Save article changes"><i class="fa fa-save"></i> <span id="articleSubmitText">Update Article</span></button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Site Configuration Modal -->
  <div id="configModal" class="modal">
    <div class="modal-content" style="max-width: 950px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h3><i class="fa fa-cog"></i> <span id="configModalTitle">Site Configuration</span></h3>
        <button type="button" class="modal-close" onclick="closeConfigModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="configSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="configSuccessText">Configuration saved successfully!</span>
        </div>
        <div id="configErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="configErrorText">An error occurred.</span>
        </div>
        <form id="configForm">
          <input type="hidden" id="configId" name="id">
          
          <!-- Logo & Branding Section -->
          <div class="config-section" style="background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%); border-left: 4px solid #ff6600; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #ff6600; display: flex; align-items: center;"><i class="fa fa-image" style="margin-right: 10px;"></i>Logo & Branding</h4>
            
            <!-- Logo Upload Section -->
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #ffe6cc;">
              <label style="font-weight: 600; font-size: 13px; display: block; margin-bottom: 12px;"><i class="fa fa-upload" style="margin-right: 6px; color: #ff6600;"></i>Upload New Logo</label>
              <div id="logoDropZone" style="border: 2px dashed #ff6600; border-radius: 8px; padding: 25px; text-align: center; background: #fffaf5; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='#fff0e6'" onmouseout="this.style.background='#fffaf5'">
                <input type="file" id="logoFileInput" accept="image/*" style="display: none;" />
                <i class="fa fa-cloud-upload" style="font-size: 32px; color: #ff6600; margin-bottom: 12px; display: block;"></i>
                <p style="margin: 0; font-size: 13px; font-weight: 600; color: #ff6600; margin-bottom: 5px;">Click to upload or drag and drop</p>
                <p style="margin: 0; font-size: 11px; color: #999;">PNG, JPG, GIF up to 2MB</p>
              </div>
              <div id="logoUploadProgress" style="display: none; margin-top: 12px;">
                <div style="background: #e0e0e0; border-radius: 4px; height: 6px; overflow: hidden;">
                  <div id="logoProgressBar" style="background: linear-gradient(90deg, #ff6600, #ff8533); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                </div>
                <p style="font-size: 11px; color: #666; margin: 8px 0 0 0; text-align: center;" id="logoProgressText">Uploading...</p>
              </div>
              <div id="logoUploadStatus" style="margin-top: 12px;"></div>
            </div>

            <!-- Logo Selection Section -->
            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e8e8e8;">
              <label style="font-weight: 600; font-size: 13px; display: block; margin-bottom: 12px;"><i class="fa fa-folder-open" style="margin-right: 6px; color: #2196F3;"></i>Browse Existing Logos</label>
              <div id="logoGallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 12px; max-height: 250px; overflow-y: auto; padding: 10px; background: #f9f9f9; border-radius: 6px;">
                <p style="grid-column: 1/-1; text-align: center; color: #999; font-size: 12px; margin: 20px 0;">Loading logos...</p>
              </div>
            </div>

            <!-- Logo URL Section -->
            <div class="form-row">
              <div class="form-group">
                <label for="configLogo">Logo URL *</label>
                <input type="url" id="configLogo" name="logo" placeholder="https://..." />
              </div>
              <div class="form-group">
                <label for="configLogoAlt">Logo Alt Text</label>
                <input type="text" id="configLogoAlt" name="logo_alt" placeholder="Company logo" />
              </div>
            </div>

            <!-- Logo Preview -->
            <div class="form-group" style="margin-bottom: 0;">
              <label style="margin-bottom: 12px;">Logo Preview</label>
              <div style="border: 2px dashed #ff6600; border-radius: 8px; padding: 20px; text-align: center; background: #fff; min-height: 120px; display: flex; align-items: center; justify-content: center;">
                <img id="logoPreview" src="" alt="Logo Preview" style="max-width: 100%; max-height: 120px; display: none;" />
                <span id="logoPlaceholder" style="color: #999; font-size: 13px;">Logo preview will appear here</span>
              </div>
            </div>
          </div>

          <!-- General Information Section -->
          <div class="config-section" style="background: linear-gradient(135deg, #f0f8ff 0%, #e6f4ff 100%); border-left: 4px solid #2196F3; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #2196F3; display: flex; align-items: center;"><i class="fa fa-building" style="margin-right: 10px;"></i>General Information</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="configCompanyName">Company Name *</label>
                <input type="text" id="configCompanyName" name="company_name" placeholder="Your company name" required />
              </div>
              <div class="form-group">
                <label for="configPhoneMain">Phone *</label>
                <input type="tel" id="configPhoneMain" name="phone" placeholder="+1 (555) 123-4567" required />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="configEmailMain">Email *</label>
                <input type="email" id="configEmailMain" name="email" placeholder="contact@example.com" required />
              </div>
              <div class="form-group">
                <label for="configWebsiteMain">Website</label>
                <input type="url" id="configWebsiteMain" name="website" placeholder="https://example.com" />
              </div>
            </div>
            <div class="form-group">
              <label for="configAddressMain">Address *</label>
              <textarea id="configAddressMain" name="address" placeholder="Street address, city, state, zip" required style="min-height: 80px;"></textarea>
            </div>
            <div class="form-group">
              <label for="configAboutMain">About Excerpt</label>
              <textarea id="configAboutMain" name="about_excerpt" placeholder="Brief company description" style="min-height: 80px;"></textarea>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label for="configActiveMain" style="display: flex; align-items: center; gap: 8px;"><i class="fa fa-toggle-on" style="font-size: 16px; color: #28a745;"></i>Site Status</label>
              <select id="configActiveMain" name="is_active" style="margin-top: 8px;">
                <option value="true">Active - Site is Live</option>
                <option value="false">Inactive - Site is Under Maintenance</option>
              </select>
            </div>
          </div>

          <!-- Social Media Links Section -->
          <div class="config-section" style="background: linear-gradient(135deg, #fff8f5 0%, #fff0e6 100%); border-left: 4px solid #FF9800; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #FF9800; display: flex; align-items: center;"><i class="fa fa-share-alt" style="margin-right: 10px;"></i>Social Media Links</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="configFacebook"><i class="fa fa-facebook" style="margin-right: 5px; color: #1877F2;"></i>Facebook</label>
                <input type="url" id="configFacebook" name="facebook_url" placeholder="https://facebook.com/yourpage" />
              </div>
              <div class="form-group">
                <label for="configInstagram"><i class="fa fa-instagram" style="margin-right: 5px; color: #E4405F;"></i>Instagram</label>
                <input type="url" id="configInstagram" name="instagram_url" placeholder="https://instagram.com/yourprofile" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="configYoutube"><i class="fa fa-youtube" style="margin-right: 5px; color: #FF0000;"></i>YouTube</label>
                <input type="url" id="configYoutube" name="youtube_url" placeholder="https://youtube.com/yourchannel" />
              </div>
              <div class="form-group">
                <label for="configLinkedin"><i class="fa fa-linkedin" style="margin-right: 5px; color: #0A66C2;"></i>LinkedIn</label>
                <input type="url" id="configLinkedin" name="linkedin_url" placeholder="https://linkedin.com/company/yourcompany" />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="configX"><i class="fa fa-twitter" style="margin-right: 5px; color: #000000;"></i>X (Twitter)</label>
                <input type="url" id="configX" name="x_url" placeholder="https://twitter.com/yourprofile" />
              </div>
              <div class="form-group">
                <label>Custom Link</label>
                <div style="display: flex; gap: 10px;">
                  <input type="url" id="configCustomLinkUrl" name="custom_link_url" placeholder="https://..." style="flex: 1;" />
                  <input type="text" id="configCustomLinkText" name="custom_link_text" placeholder="Link text" style="flex: 1;" />
                </div>
              </div>
            </div>
          </div>

          <!-- Analytics & Tracking Section -->
          <div class="config-section" style="background: linear-gradient(135deg, #f0f7ff 0%, #e6f4ff 100%); border-left: 4px solid #4CAF50; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #4CAF50; display: flex; align-items: center;"><i class="fa fa-bar-chart" style="margin-right: 10px;"></i>Analytics & Tracking</h4>
            <div class="form-group" style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e8e8e8;">
              <label style="font-weight: bold; display: flex; align-items: center;"><i class="fa fa-google" style="margin-right: 8px;"></i>Google Services</label>
              <div class="form-row">
                <div class="form-group">
                  <label for="configGAId" style="margin-top: 10px;">Google Analytics ID</label>
                  <input type="text" id="configGAId" name="google_analytics_id" placeholder="G-XXXXXXXXXX or UA-XXXXXX-X" />
                </div>
                <div class="form-group">
                  <label for="configGTMId" style="margin-top: 10px;">Google Tag Manager ID</label>
                  <input type="text" id="configGTMId" name="google_tag_manager_id" placeholder="GTM-XXXXXX" />
                </div>
              </div>
            </div>
            <div class="form-group" style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e8e8e8;">
              <label style="font-weight: bold; display: flex; align-items: center;"><i class="fa fa-external-link" style="margin-right: 8px;"></i>Third-Party Analytics</label>
              <div class="form-row">
                <div class="form-group">
                  <label for="configFBPixel" style="margin-top: 10px;">Facebook Pixel ID</label>
                  <input type="text" id="configFBPixel" name="facebook_pixel_id" placeholder="123456789012345" />
                </div>
                <div class="form-group">
                  <label for="configHotjar" style="margin-top: 10px;">Hotjar Site ID</label>
                  <input type="text" id="configHotjar" name="hotjar_id" placeholder="123456" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="configClarity">Microsoft Clarity ID</label>
                  <input type="text" id="configClarity" name="clarity_id" placeholder="xxxxxxxx" />
                </div>
                <div class="form-group">
                  <label for="configCustomTracking">Custom Tracking Code</label>
                  <input type="text" id="configCustomTracking" name="custom_tracking_code" placeholder="Custom tracking ID or code" />
                </div>
              </div>
            </div>
            <div class="form-group" style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 0; border: 2px solid #e8e8e8;">
              <label style="font-weight: bold; display: flex; align-items: center;"><i class="fa fa-shield" style="margin-right: 8px;"></i>Security & Verification</label>
              <div class="form-row">
                <div class="form-group">
                  <label for="configRecaptchaSite" style="margin-top: 10px;">reCAPTCHA Site Key</label>
                  <input type="text" id="configRecaptchaSite" name="recaptcha_site_key" placeholder="Your reCAPTCHA v3 site key" />
                </div>
                <div class="form-group">
                  <label for="configRecaptchaSecret" style="margin-top: 10px;">reCAPTCHA Secret Key</label>
                  <input type="password" id="configRecaptchaSecret" name="recaptcha_secret_key" placeholder="Your reCAPTCHA v3 secret key" />
                </div>
              </div>
            </div>
          </div>

          <!-- Settings Section -->
          <div class="config-section" style="background: linear-gradient(135deg, #f5f5f5 0%, #efefef 100%); border-left: 4px solid #9C27B0; padding: 20px; margin-bottom: 20px; border-radius: 8px;">
            <h4 style="margin-top: 0; color: #9C27B0; display: flex; align-items: center;"><i class="fa fa-sliders" style="margin-right: 10px;"></i>Settings</h4>
            <div class="form-row">
              <div class="form-group">
                <label for="configEnableAnalytics"><i class="fa fa-toggle-on" style="margin-right: 5px; color: #4CAF50;"></i>Enable Analytics</label>
                <select id="configEnableAnalytics" name="enable_analytics" style="margin-top: 8px;">
                  <option value="true">Enabled</option>
                  <option value="false">Disabled</option>
                </select>
              </div>
              <div class="form-group">
                <label for="configEnableTracking"><i class="fa fa-toggle-on" style="margin-right: 5px; color: #4CAF50;"></i>Enable Tracking</label>
                <select id="configEnableTracking" name="enable_tracking" style="margin-top: 8px;">
                  <option value="true">Enabled</option>
                  <option value="false">Disabled</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeConfigModal()" title="Cancel and close form"><i class="fa fa-times"></i> Cancel</button>
            <button type="submit" class="btn btn-primary" title="Save configuration"><i class="fa fa-save"></i> <span id="configSubmitText">Save Configuration</span></button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div id="aboutModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-info-circle"></i> <span id="aboutModalTitle">Add About Content</span></h3>
        <button type="button" class="modal-close" onclick="closeAboutModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="aboutSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="aboutSuccessText">About content saved successfully!</span>
        </div>
        <div id="aboutErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="aboutErrorText">An error occurred.</span>
        </div>
        <form id="aboutForm" enctype="multipart/form-data">
          <input type="hidden" id="aboutId" name="id">
          
          <!-- Main About Section -->
          <div class="form-group">
            <label for="aboutTitle">Title *</label>
            <input type="text" id="aboutTitle" name="title" placeholder="About page title" required />
          </div>
          
          <div class="form-group">
            <label for="aboutContent">Content *</label>
            <textarea id="aboutContent" name="content" placeholder="Main about content" required style="min-height: 100px;"></textarea>
          </div>
          
          <div class="form-group">
            <label for="aboutImage">Main Image</label>
            <input type="file" id="aboutImage" name="image" accept="image/*" />
            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">Main about page image (JPG, PNG, GIF)</small>
          </div>
          
          <div class="form-group" style="margin-bottom: 20px;">
            <label>Main Image Preview</label>
            <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #fff; min-height: 120px; display: flex; align-items: center; justify-content: center;">
              <img id="aboutImagePreview" src="" alt="About Image Preview" style="max-width: 100%; max-height: 200px; display: none; border-radius: 4px;" />
              <span id="aboutImagePlaceholder" style="color: #999; font-size: 12px;">No image selected</span>
            </div>
          </div>

          <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
          
          <!-- Mission Section -->
          <h4 style="margin-bottom: 15px; color: #007bff; font-size: 16px; font-weight: 600;">Mission Section</h4>
          
          <div class="form-group">
            <label for="missionTitle">Mission Title</label>
            <input type="text" id="missionTitle" name="mission_title" placeholder="Our Mission" />
          </div>
          
          <div class="form-group">
            <label for="missionContent">Mission Content</label>
            <textarea id="missionContent" name="mission_content" placeholder="Mission description" style="min-height: 80px;"></textarea>
          </div>
          
          <div class="form-group">
            <label for="missionImage">Mission Image</label>
            <input type="file" id="missionImage" name="mission_image" accept="image/*" />
            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">Mission section image (JPG, PNG, GIF)</small>
          </div>
          
          <div class="form-group" style="margin-bottom: 20px;">
            <label>Mission Image Preview</label>
            <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #fff; min-height: 100px; display: flex; align-items: center; justify-content: center;">
              <img id="missionImagePreview" src="" alt="Mission Image Preview" style="max-width: 100%; max-height: 150px; display: none; border-radius: 4px;" />
              <span id="missionImagePlaceholder" style="color: #999; font-size: 12px;">No image selected</span>
            </div>
          </div>

          <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
          
          <!-- Vision Section -->
          <h4 style="margin-bottom: 15px; color: #6f42c1; font-size: 16px; font-weight: 600;">Vision Section</h4>
          
          <div class="form-group">
            <label for="visionTitle">Vision Title</label>
            <input type="text" id="visionTitle" name="vision_title" placeholder="Our Vision" />
          </div>
          
          <div class="form-group">
            <label for="visionContent">Vision Content</label>
            <textarea id="visionContent" name="vision_content" placeholder="Vision description" style="min-height: 80px;"></textarea>
          </div>
          
          <div class="form-group">
            <label for="visionImage">Vision Image</label>
            <input type="file" id="visionImage" name="vision_image" accept="image/*" />
            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">Vision section image (JPG, PNG, GIF)</small>
          </div>
          
          <div class="form-group" style="margin-bottom: 20px;">
            <label>Vision Image Preview</label>
            <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #fff; min-height: 100px; display: flex; align-items: center; justify-content: center;">
              <img id="visionImagePreview" src="" alt="Vision Image Preview" style="max-width: 100%; max-height: 150px; display: none; border-radius: 4px;" />
              <span id="visionImagePlaceholder" style="color: #999; font-size: 12px;">No image selected</span>
            </div>
          </div>

          <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
          
          <!-- Goals Section -->
          <h4 style="margin-bottom: 15px; color: #ffc107; font-size: 16px; font-weight: 600;">Goals Section</h4>
          
          <div class="form-group">
            <label for="goalsTitle">Goals Title</label>
            <input type="text" id="goalsTitle" name="goals_title" placeholder="Our Goals" />
          </div>
          
          <div class="form-group">
            <label for="goalsContent">Goals Content</label>
            <textarea id="goalsContent" name="goals_content" placeholder="Goals description" style="min-height: 80px;"></textarea>
          </div>
          
          <div class="form-group">
            <label for="goalsImage">Goals Image</label>
            <input type="file" id="goalsImage" name="goals_image" accept="image/*" />
            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">Goals section image (JPG, PNG, GIF)</small>
          </div>
          
          <div class="form-group" style="margin-bottom: 20px;">
            <label>Goals Image Preview</label>
            <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #fff; min-height: 100px; display: flex; align-items: center; justify-content: center;">
              <img id="goalsImagePreview" src="" alt="Goals Image Preview" style="max-width: 100%; max-height: 150px; display: none; border-radius: 4px;" />
              <span id="goalsImagePlaceholder" style="color: #999; font-size: 12px;">No image selected</span>
            </div>
          </div>

          <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
          
          <!-- Achievements Section -->
          <h4 style="margin-bottom: 15px; color: #28a745; font-size: 16px; font-weight: 600;">Achievements Section</h4>
          
          <div class="form-group">
            <label for="achievementsTitle">Achievements Title</label>
            <input type="text" id="achievementsTitle" name="achievements_title" placeholder="Our Achievements" />
          </div>
          
          <div class="form-group">
            <label for="achievementsContent">Achievements Content</label>
            <textarea id="achievementsContent" name="achievements_content" placeholder="Achievements description" style="min-height: 80px;"></textarea>
          </div>
          
          <div class="form-group">
            <label for="achievementsImage">Achievements Image</label>
            <input type="file" id="achievementsImage" name="achievements_image" accept="image/*" />
            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">Achievements section image (JPG, PNG, GIF)</small>
          </div>
          
          <div class="form-group" style="margin-bottom: 20px;">
            <label>Achievements Image Preview</label>
            <div style="border: 2px dashed #ddd; border-radius: 8px; padding: 15px; text-align: center; background: #fff; min-height: 100px; display: flex; align-items: center; justify-content: center;">
              <img id="achievementsImagePreview" src="" alt="Achievements Image Preview" style="max-width: 100%; max-height: 150px; display: none; border-radius: 4px;" />
              <span id="achievementsImagePlaceholder" style="color: #999; font-size: 12px;">No image selected</span>
            </div>
          </div>

          <hr style="margin: 20px 0; border: none; border-top: 2px solid #e0e0e0;">
          
          <div class="form-group">
            <label style="display: flex; align-items: center; cursor: pointer;">
              <input type="checkbox" id="aboutPublished" name="is_published" style="margin-right: 10px; width: 18px; height: 18px;" />
              <span style="font-weight: 600;">Publish this content</span>
            </label>
            <small style="color: #666; display: block; margin-top: 5px;">Make this content visible on the website</small>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeAboutModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">
              <i class="fa fa-save"></i> <span id="aboutSubmitText">Save</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Team Member Modal -->
  <div id="teamMemberModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-user-plus"></i> <span id="modalTitle">Add Team Member</span></h3>
        <button type="button" class="modal-close" onclick="closeTeamModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="successMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="successText">Team member added successfully!</span>
        </div>
        <div id="errorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="errorText">An error occurred. Please try again.</span>
        </div>

        <form id="teamMemberForm">
          <input type="hidden" id="editMemberId" name="member_id">

          <div class="form-group">
            <label for="memberName">Full Name *</label>
            <input type="text" id="memberName" name="name" placeholder="e.g., Sakar Bhandari" required />
          </div>

          <div class="form-group">
            <label for="memberPosition">Position *</label>
            <input type="text" id="memberPosition" name="position" placeholder="e.g., Civil Engineer" required />
          </div>

          <div class="form-group">
            <label for="memberBio">Bio *</label>
            <textarea id="memberBio" name="bio" placeholder="Brief description of experience and expertise..." required style="min-height: 100px;"></textarea>
          </div>

          <div class="form-group">
            <label for="memberLinkedin">LinkedIn URL</label>
            <input type="url" id="memberLinkedin" name="linkedin_url" placeholder="https://linkedin.com/in/username" />
          </div>

          <div class="form-group">
            <label for="memberFacebook">Facebook URL</label>
            <input type="url" id="memberFacebook" name="facebook_url" placeholder="https://facebook.com/username" />
          </div>

          <div class="form-group">
            <label for="memberInstagram">Instagram URL</label>
            <input type="url" id="memberInstagram" name="instagram_url" placeholder="https://instagram.com/username" />
          </div>

          <div class="form-group">
            <label for="memberPhoto">Photo *</label>
            <input type="file" id="memberPhoto" name="photo" accept="image/*" required />
            <small class="form-help">Upload a photo for the team member (JPG, PNG, etc.)</small>
          </div>

          <div class="form-group">
            <label for="memberActive">Status</label>
            <select id="memberActive" name="is_active" required>
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeTeamModal()" title="Cancel and close form">
              <i class="fa fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-primary" title="Save team member">
              <i class="fa fa-save"></i> <span id="submitBtnText">Add Member</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Client Modal -->
  <div id="clientModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-briefcase"></i> <span id="clientModalTitle">Add New Client</span></h3>
        <button type="button" class="modal-close" onclick="closeClientModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="clientSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="clientSuccessText">Client saved successfully!</span>
        </div>
        <div id="clientErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="clientErrorText">An error occurred. Please try again.</span>
        </div>

        <form id="clientForm" onsubmit="event.preventDefault(); saveClient();">
          <input type="hidden" id="editClientId" name="client_id">

          <div class="form-group">
            <label for="clientName">Company Name *</label>
            <input type="text" id="clientName" name="name" placeholder="e.g., ABC Construction Ltd." required />
          </div>

          <div class="form-group">
            <label for="clientPhone">Phone</label>
            <input type="tel" id="clientPhone" name="phone" placeholder="+1 (555) 123-4567" />
          </div>

          <div class="form-group">
            <label for="clientAddress">Address</label>
            <input type="text" id="clientAddress" name="address" placeholder="123 Business Street, City, State 12345" />
          </div>

          <div class="form-group">
            <label for="clientWebsite">Website</label>
            <input type="url" id="clientWebsite" name="website" placeholder="https://www.example.com" />
          </div>

          <div class="form-group">
            <label for="clientAbout">About/Description</label>
            <textarea id="clientAbout" name="about" placeholder="Brief description about the client..." style="min-height: 100px;"></textarea>
          </div>

          <div class="form-group">
            <label for="clientOrder">Display Order</label>
            <input type="number" id="clientOrder" name="order" placeholder="0" value="0" />
          </div>

          <div class="form-group">
            <label for="clientIsActive">
              <input type="checkbox" id="clientIsActive" name="is_active" />
              Active (Show on website)
            </label>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeClientModal()" title="Cancel and close form">
              <i class="fa fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-primary" title="Save client">
              <i class="fa fa-save"></i> <span id="clientSubmitText">Add Client</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Career Modal -->
  <div id="careerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-graduation-cap"></i> <span id="careerModalTitle">Add Career</span></h3>
        <button type="button" class="modal-close" onclick="closeCareerModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="careerSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="careerSuccessText">Career saved successfully!</span>
        </div>
        <div id="careerErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="careerErrorText">An error occurred.</span>
        </div>
        <form id="careerForm" onsubmit="event.preventDefault(); saveCareer();">
          <input type="hidden" id="careerId" name="id">

          <div class="form-row">
            <div class="form-group">
              <label for="careerTitle">Job Title *</label>
              <input type="text" id="careerTitle" name="title" placeholder="e.g., Senior Software Engineer" required />
            </div>
            <div class="form-group">
              <label for="careerLocation">Location *</label>
              <input type="text" id="careerLocation" name="location" placeholder="e.g., New York, NY" required />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="careerJobType">Job Type *</label>
              <select id="careerJobType" name="job_type" required>
                <option value="full_time">Full Time</option>
                <option value="part_time">Part Time</option>
                <option value="contract">Contract</option>
                <option value="internship">Internship</option>
              </select>
            </div>
            <div class="form-group">
              <label for="careerStatus">Status *</label>
              <select id="careerStatus" name="status" required>
                <option value="draft">Draft</option>
                <option value="active">Active</option>
                <option value="closed">Closed</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="careerDepartment">Department</label>
              <input type="text" id="careerDepartment" name="department" placeholder="e.g., Engineering" />
            </div>
            <div class="form-group">
              <label for="careerExperience">Experience Required</label>
              <input type="text" id="careerExperience" name="experience_required" placeholder="e.g., 3-5 years" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="careerSalary">Salary Range</label>
              <input type="text" id="careerSalary" name="salary_range" placeholder="e.g., $80,000 - $120,000" />
            </div>
            <div class="form-group">
              <label for="careerDeadline">Application Deadline</label>
              <input type="date" id="careerDeadline" name="application_deadline" />
            </div>
          </div>

          <div class="form-group">
            <label for="careerShortDesc">Short Description</label>
            <input type="text" id="careerShortDesc" name="short_description" placeholder="Brief job overview (max 500 chars)" maxlength="500" />
          </div>

          <div class="form-group">
            <label for="careerRequirements">Requirements *</label>
            <textarea id="careerRequirements" name="requirements" placeholder="List job requirements (supports markdown)" style="min-height: 100px;" required></textarea>
          </div>

          <div class="form-group">
            <label for="careerResponsibilities">Responsibilities</label>
            <textarea id="careerResponsibilities" name="responsibilities" placeholder="List job responsibilities (supports markdown)" style="min-height: 100px;"></textarea>
          </div>

          <div class="form-group">
            <label for="careerQualifications">Qualifications</label>
            <textarea id="careerQualifications" name="qualifications" placeholder="Required qualifications (supports markdown)" style="min-height: 80px;"></textarea>
          </div>

          <div class="form-group">
            <label for="careerBenefits">Benefits</label>
            <textarea id="careerBenefits" name="benefits" placeholder="Job benefits (supports markdown)" style="min-height: 80px;"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="careerAppEmail">Application Email</label>
              <input type="email" id="careerAppEmail" name="application_email" placeholder="careers@company.com" />
            </div>
            <div class="form-group">
              <label for="careerAppUrl">Application URL</label>
              <input type="url" id="careerAppUrl" name="application_url" placeholder="https://apply.company.com" />
            </div>
          </div>

          <div class="form-group">
            <label for="careerFeatured">
              <input type="checkbox" id="careerFeatured" name="is_featured" />
              Featured (Show prominently on careers page)
            </label>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeCareerModal()" title="Cancel and close form">
              <i class="fa fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-primary" title="Save career posting">
              <i class="fa fa-save"></i> <span id="careerSubmitText">Save Career</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Notice Modal -->
  <div id="noticeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-bullhorn"></i> <span id="noticeModalTitle">Add Notice</span></h3>
        <button type="button" class="modal-close" onclick="closeNoticeModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="noticeSuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="noticeSuccessText">Notice saved successfully!</span>
        </div>
        <div id="noticeErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="noticeErrorText">An error occurred.</span>
        </div>
        <form id="noticeForm" onsubmit="event.preventDefault(); saveNotice();">
          <input type="hidden" id="noticeId" name="id">

          <div class="form-group">
            <label for="noticeTitle">Title *</label>
            <input type="text" id="noticeTitle" name="title" placeholder="Notice title" required />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="noticeStatus">Status *</label>
              <select id="noticeStatus" name="status" required>
                <option value="draft">Draft</option>
                <option value="published">Published</option>
                <option value="archived">Archived</option>
              </select>
            </div>
            <div class="form-group">
              <label for="noticePriority">Priority *</label>
              <select id="noticePriority" name="priority" required>
                <option value="low">Low</option>
                <option value="normal" selected>Normal</option>
                <option value="high">High</option>
                <option value="urgent">Urgent</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="noticeExcerpt">Short Summary</label>
            <input type="text" id="noticeExcerpt" name="excerpt" placeholder="Brief summary (max 500 chars)" maxlength="500" />
          </div>

          <div class="form-group">
            <label for="noticeContent">Content *</label>
            <textarea id="noticeContent" name="content" placeholder="Notice content (supports markdown)" style="min-height: 150px;" required></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="noticeDate">Notice Date *</label>
              <input type="date" id="noticeDate" name="notice_date" required />
            </div>
            <div class="form-group">
              <label for="noticeExpiryDate">Expiry Date</label>
              <input type="date" id="noticeExpiryDate" name="expiry_date" />
            </div>
          </div>

          <div class="form-group">
            <label for="noticeFeatured">
              <input type="checkbox" id="noticeFeatured" name="is_featured" />
              Featured
            </label>
          </div>

          <div class="form-group">
            <label for="noticeSticky">
              <input type="checkbox" id="noticeSticky" name="is_sticky" />
              Sticky (Pin to top)
            </label>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeNoticeModal()" title="Cancel and close form">
              <i class="fa fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-primary" title="Save notice">
              <i class="fa fa-save"></i> <span id="noticeSubmitText">Save Notice</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Category Creation Modal -->
  <div id="createCategoryModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fa fa-plus-circle"></i> <span id="createCategoryTitle">Create New Category</span></h3>
        <button type="button" class="modal-close" onclick="closeCreateCategoryModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="createCategorySuccessMessage" class="success-message">
          <i class="fa fa-check-circle"></i> <span id="createCategorySuccessText">Category created successfully!</span>
        </div>
        <div id="createCategoryErrorMessage" class="error-message">
          <i class="fa fa-exclamation-circle"></i> <span id="createCategoryErrorText">An error occurred.</span>
        </div>
        <form id="createCategoryForm">
          <input type="hidden" id="categoryType" value="blog">
          
          <div class="form-group">
            <label for="categoryName">Category Name *</label>
            <input type="text" id="categoryName" name="name" placeholder="Enter category name" required />
          </div>

          <div class="form-group">
            <label for="categoryDescription">Description</label>
            <textarea id="categoryDescription" name="description" placeholder="Brief description (optional)" style="min-height: 80px;"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="categoryIcon">Icon Class</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" id="categoryIcon" name="icon" placeholder="e.g., fa-bookmark, fa-briefcase" value="fa-bookmark" onchange="updateIconPreview()" oninput="updateIconPreview()" />
                <i id="iconPreview" class="fa fa-bookmark" style="font-size: 24px; color: #ff6600;"></i>
              </div>
            </div>
            <div class="form-group">
              <label for="categoryActive">Status</label>
              <select id="categoryActive" name="is_active">
                <option value="true">Active</option>
                <option value="false">Inactive</option>
              </select>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeCreateCategoryModal()" title="Cancel and close form"><i class="fa fa-times"></i> Cancel</button>
            <button type="submit" class="btn btn-primary" title="Create new category"><i class="fa fa-save"></i> Create Category</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Application Detail Modal -->
  <div id="applicationDetailModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3><i class="fa fa-file-text"></i> Application Details</h3>
        <button type="button" class="modal-close" onclick="closeApplicationDetailModal()" title="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div id="applicationDetailContent" style="max-height: 70vh; overflow-y: auto;">
          <!-- Application details will be loaded here -->
        </div>

        <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
          <h4 style="margin-bottom: 15px;"><i class="fa fa-cog"></i> Update Application Status</h4>
          <div class="form-row">
            <div class="form-group" style="flex: 1;">
              <label for="applicationStatus">Status</label>
              <select id="applicationStatus" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="pending">Pending Review</option>
                <option value="reviewing">Under Review</option>
                <option value="shortlisted">Shortlisted</option>
                <option value="rejected">Rejected</option>
                <option value="accepted">Accepted</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="adminNotes">Admin Notes (Internal)</label>
            <textarea id="adminNotes" placeholder="Add internal notes about this application..." style="min-height: 100px; width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="closeApplicationDetailModal()" title="Close modal"><i class="fa fa-times"></i> Close</button>
            <button type="button" class="btn btn-primary" onclick="updateApplicationStatus()" title="Update application status"><i class="fa fa-save"></i> Update Status</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- External Libraries -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>

  <!-- Refactored Dashboard Module -->
  <script src="{% static 'js/dashboard.js' %}"></script>

  <script>
    /**
     * Enhanced Dashboard Module Integration
     * Uses the refactored DashboardApp module for secure, maintainable code
     */

    'use strict';

    // Configure the dashboard after module loads
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Initialize Quill editors using the refactored Editor module
        // Only initialize editors for elements that exist
        const editors = {};
        const editorIds = ['contentEditor', 'editContentEditor', 'projectDescEditor', 'serviceContentEditor', 'articleContentEditor'];
        
        editorIds.forEach(id => {
          if (document.getElementById(id)) {
            editors[id] = DashboardApp.Editor.init(id);
          }
        });

        // Ensure all editors are available globally if needed
        window.editors = editors;

        console.log('[Dashboard] Editors initialized successfully');

        // Initialize tabs with proper click handlers
        const tabButtons = document.querySelectorAll('.tab-button');
        
        tabButtons.forEach(button => {
          button.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            switchToTab(tabName);
          });
        });

        // Initialize first tab as active (add-article)
        const firstTab = document.getElementById('add-article');
        if (firstTab) {
          firstTab.classList.add('active');
        }
        const firstButton = document.querySelector('[data-tab="add-article"]');
        if (firstButton) {
          firstButton.classList.add('active');
        }

        DashboardApp.Toast.show('Dashboard loaded successfully', 'success', 3000);

      } catch (error) {
        console.error('[Dashboard] Error during initialization:', error);
        DashboardApp.Toast.show('Error initializing dashboard', 'error', 5000);
      }
    });

    // Tab initialization with proper event delegation
    document.addEventListener('DOMContentLoaded', function() {
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.addEventListener('click', function(e) {
          const tabName = this.getAttribute('data-tab');
          if (tabName) {
            switchToTab(tabName);
          }
        });
      });
    });

    // ============================================
    // LOGOUT FUNCTIONALITY WITH CONFIRMATION
    // ============================================
    function logout(event) {
      console.log('[Logout] Logout function called');
      
      // Prevent any default action immediately
      if (event) {
        event.preventDefault();
        event.stopPropagation();
        event.stopImmediatePropagation();
      }
      
      // Show modal immediately
      try {
        console.log('[Logout] Creating confirmation modal');
        DashboardApp.Modal.create('confirmLogout', {
          title: 'Confirm Logout',
          content: 'Are you sure you want to logout?',
          buttons: [
            {
              text: 'Cancel',
              type: 'default',
              onClick: () => {
                console.log('[Logout] Logout cancelled');
              }
            },
            {
              text: 'Logout',
              type: 'danger',
              onClick: () => {
                console.log('[Logout] Logout confirmed, calling Auth.logout()');
                DashboardApp.Auth.logout();
              }
            }
          ]
        });

        DashboardApp.Modal.open('confirmLogout');
        console.log('[Logout] Modal opened');
      } catch (error) {
        console.error('[Logout] Error showing modal:', error);
        // If modal fails, ask for confirmation via browser
        if (confirm('Are you sure you want to logout?')) {
          DashboardApp.Auth.logout();
        }
      }
      
      return false;
    }

    // ============================================
    // EXAMPLE DASHBOARD FUNCTIONS
    // ============================================

    /**
     * Load and display blog posts
     */
    async function loadBlogPosts() {
      try {
        DashboardApp.Toast.show('Loading blog posts...', 'info');
        const response = await DashboardApp.API.get('/api/blog-posts/');
        
        const tbody = document.getElementById('blogTableBody');
        if (!tbody) return;

        tbody.innerHTML = '';

        if (!Array.isArray(response) || response.length === 0) {
          tbody.innerHTML = '<tr><td colspan="10" class="text-center text-muted">No blog posts found</td></tr>';
          return;
        }

        response.forEach(post => {
          const row = DashboardApp.createElement('tr');
          row.innerHTML = `
            <td>${DashboardApp.sanitize(post.title || 'N/A')}</td>
            <td>${DashboardApp.sanitize(post.category || 'N/A')}</td>
            <td>${DashboardApp.formatDate(post.created_at)}</td>
            <td>
              <button type="button" class="btn btn-sm btn-primary" onclick="editBlogPost(${post.id})" title="Edit article">Edit</button>
              <button type="button" class="btn btn-sm btn-danger" onclick="deleteBlogPost(${post.id})" title="Delete article">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });

        DashboardApp.Toast.show(`Loaded ${response.length} blog posts`, 'success', 3000);

      } catch (error) {
        console.error('[Dashboard] Error loading blog posts:', error);
        DashboardApp.Toast.show(`Error loading blog posts: ${error.message}`, 'error');
      }
    }

    /**
     * Delete blog post with confirmation
     */
    function deleteBlogPost(postId) {
      DashboardApp.Modal.create('confirmDelete', {
        title: 'Confirm Delete',
        content: 'Are you sure you want to delete this blog post? This action cannot be undone.',
        buttons: [
          {
            text: 'Cancel',
            type: 'default',
            onClick: () => {}
          },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/blog-posts/${postId}/`);
                DashboardApp.Toast.show('Blog post deleted successfully', 'success');
                loadBlogPosts();
              } catch (error) {
                DashboardApp.Toast.show(`Error deleting post: ${error.message}`, 'error');
              }
            }
          }
        ]
      });

      DashboardApp.Modal.open('confirmDelete');
    }

    /**
     * Save blog post (add or edit)
     */
    async function saveBlogPost(postId = null) {
      try {
        const title = document.getElementById('articleTitle')?.value;
        const category = document.getElementById('articleCategory')?.value;
        const content = DashboardApp.Editor.getContent('articleContentEditor');

        if (!title || !content) {
          DashboardApp.Toast.show('Please fill in all required fields', 'warning');
          return;
        }

        const payload = {
          title: title,
          category: category,
          content: content
        };

        let response;
        if (postId) {
          response = await DashboardApp.API.put(`/api/blog-posts/${postId}/`, payload);
          DashboardApp.Toast.show('Blog post updated successfully', 'success');
        } else {
          response = await DashboardApp.API.post('/api/blog-posts/', payload);
          DashboardApp.Toast.show('Blog post created successfully', 'success');
        }

        // Clear form and reload
        DashboardApp.Editor.clear('articleContentEditor');
        document.getElementById('articleTitle').value = '';
        loadBlogPosts();

      } catch (error) {
        console.error('[Dashboard] Error saving blog post:', error);
        DashboardApp.Toast.show(`Error saving blog post: ${error.message}`, 'error');
      }
    }

    /**
     * Load site configuration
     */
    async function loadSiteConfig() {
      try {
        const response = await DashboardApp.API.get('/api/site-config/');
        
        if (response && typeof response === 'object') {
          // Safely populate form fields
          Object.keys(response).forEach(key => {
            const input = document.getElementById(`config${key.charAt(0).toUpperCase() + key.slice(1)}`);
            if (input) {
              input.value = DashboardApp.sanitize(String(response[key] || ''));
            }
          });

          DashboardApp.Toast.show('Site configuration loaded', 'success', 2000);
        }
      } catch (error) {
        console.error('[Dashboard] Error loading site config:', error);
        DashboardApp.Toast.show(`Error loading configuration: ${error.message}`, 'error');
      }
    }

    /**
     * Save site configuration
     */
    async function saveSiteConfig() {
      try {
        const config = {};
        const inputs = document.querySelectorAll('[id^="config"]');
        
        inputs.forEach(input => {
          const key = input.id.replace('config', '').toLowerCase();
          config[key] = input.value;
        });

        await DashboardApp.API.put('/api/site-config/', config);
        DashboardApp.Toast.show('Configuration saved successfully', 'success');
        loadSiteConfig();

      } catch (error) {
        console.error('[Dashboard] Error saving config:', error);
        DashboardApp.Toast.show(`Error saving configuration: ${error.message}`, 'error');
      }
    }

    // Initialize dashboard on load
    window.addEventListener('load', () => {
      console.log('[Dashboard] Window loaded - ready for user interaction');
    });

    /**
     * Input validation helpers
     */
    const Validators = {
      email: (email) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email),
      phone: (phone) => /^\d{7,}$/.test(phone.replace(/\D/g, '')),
      url: (url) => {
        try {
          new URL(url);
          return true;
        } catch {
          return false;
        }
      },
      required: (value) => value && String(value).trim() !== '',
      minLength: (value, min) => String(value).length >= min,
      maxLength: (value, max) => String(value).length <= max
    };

    /**
     * CSRF Token handler - extract from meta tag or cookie
     */
    function getCsrfToken() {
      // Try to get from meta tag first
      const token = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
      if (token) return token;

      // Try to get from cookie
      const cookies = document.cookie.split(';');
      for (let cookie of cookies) {
        const [name, value] = cookie.trim().split('=');
        if (name === 'csrftoken') {
          return decodeURIComponent(value);
        }
      }

      return null;
    }

    // ===== UI HELPER FUNCTIONS =====
    /**
     * Show loading state for data tables
     */
    function showLoading(tableId) {
      const tbody = document.getElementById(`${tableId}TableBody`);
      if (tbody) {
        tbody.innerHTML = '<tr><td colspan="10" class="no-data"><i class="fa fa-spinner fa-spin"></i><p>Loading...</p></td></tr>';
      }
    }

    /**
     * Hide loading state
     */
    function hideLoading(tableId) {
      // Placeholder - actual data display happens in individual functions
    }

    /**
     * Display error in table
     */
    function showTableError(tableBodyId, entityName, errorMessage) {
      const tbody = document.getElementById(tableBodyId);
      if (tbody) {
        tbody.innerHTML = `<tr><td colspan="10" class="no-data"><i class="fa fa-exclamation-triangle" style="color: #dc3545;"></i><p style="color: #dc3545;">Error loading ${entityName}: ${errorMessage}</p></td></tr>`;
      }
    }

    /**
     * Global error handler and logger
     */
    function handleApiError(errorMessage, context = '') {
      console.error(`[ERROR] ${context}: ${errorMessage}`);
      return {
        message: errorMessage,
        context: context,
        timestamp: new Date().toISOString()
      };
    }

    // Global variable to store team members
    let currentTeamMembers = [];
    let isEditMode = false;

    // ===== ERROR MESSAGE HANDLER =====
    function showErrorAlert(title, message) {
      console.error(`${title}: ${message}`);
      DashboardApp.Toast.show(`${title}: ${message}`, 'error');
    }

    function showSuccessAlert(title, message) {
      console.log(`${title}: ${message}`);
      DashboardApp.Toast.show(`${title}: ${message}`, 'success');
    }

    // ===== LOGO UPLOAD & MANAGEMENT =====
    /**
     * Initialize logo upload handlers
     */
    function initLogoUpload() {
      const dropZone = document.getElementById('logoDropZone');
      const fileInput = document.getElementById('logoFileInput');

      if (!dropZone || !fileInput) return;

      // Click to upload
      dropZone.addEventListener('click', () => fileInput.click());

      // Drag and drop
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.background = '#ffe6cc';
        dropZone.style.borderColor = '#ff8533';
      });

      dropZone.addEventListener('dragleave', () => {
        dropZone.style.background = '#fffaf5';
        dropZone.style.borderColor = '#ff6600';
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.background = '#fffaf5';
        dropZone.style.borderColor = '#ff6600';
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleLogoFileSelect(files[0]);
        }
      });

      // File input change
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleLogoFileSelect(e.target.files[0]);
        }
      });
    }

    /**
     * Handle logo file selection and upload
     */
    async function handleLogoFileSelect(file) {
      const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
      const maxSize = 2 * 1024 * 1024; // 2MB

      // Validation
      if (!validTypes.includes(file.type)) {
        showUploadStatus('error', ' Invalid file type. Please upload an image (PNG, JPG, GIF, WebP).');
        return;
      }

      if (file.size > maxSize) {
        showUploadStatus('error', ' File too large. Maximum size is 2MB.');
        return;
      }

      // Upload
      const progressDiv = document.getElementById('logoUploadProgress');
      const statusDiv = document.getElementById('logoUploadStatus');
      
      progressDiv.style.display = 'block';
      statusDiv.innerHTML = '';

      try {
        const formData = new FormData();
        formData.append('file', file);
        const response = await DashboardApp.API.call('/api/upload/logo/', {
          method: 'POST',
          body: formData,
          isFormData: true
        });

        if (response.url) {
          document.getElementById('configLogo').value = response.url;
          updateLogoPreview();
          showUploadStatus('success', ` Logo uploaded successfully!`);
          
          // Reload logo gallery
          setTimeout(loadLogoGallery, 500);
        } else {
          showUploadStatus('error', ' Upload failed: Invalid response from server');
        }
      } catch (error) {
        console.error('Logo upload error:', error);
        showUploadStatus('error', ` Upload failed: ${error.message}`);
      } finally {
        progressDiv.style.display = 'none';
        // Reset file input
        document.getElementById('logoFileInput').value = '';
      }
    }

    /**
     * Display upload status message
     */
    function showUploadStatus(type, message, statusType = 'error') {
      let statusDiv;
      
      switch(type) {
        case 'logo':
          statusDiv = document.getElementById('logoUploadStatus');
          break;
        case 'projectImage':
          statusDiv = document.getElementById('projectImageUploadStatus');
          break;
        case 'serviceImage':
          statusDiv = document.getElementById('serviceImageUploadStatus');
          break;
        default:
          statusDiv = document.getElementById('logoUploadStatus');
      }

      if (!statusDiv) return;

      statusDiv.innerHTML = `
        <div style="padding: 12px; border-radius: 6px; font-size: 12px; font-weight: 500; ${
          statusType === 'success' 
            ? 'background: #d4edda; color: #155724; border-left: 4px solid #28a745;'
            : 'background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545;'
        }">
          ${message}
        </div>
      `;
    }

    /**
     * Load available logos from server
     */
    async function loadLogoGallery() {
      const gallery = document.getElementById('logoGallery');
      if (!gallery) return;

      try {
        gallery.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; font-size: 12px; margin: 20px 0;">Loading logos...</p>';
        
        const logos = await DashboardApp.API.get('/api/logos/');
        
        if (!logos || logos.length === 0) {
          gallery.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; font-size: 12px; margin: 20px 0;">No logos available yet. Upload one to get started.</p>';
          return;
        }

        gallery.innerHTML = logos.map(logo => `
          <div style="position: relative; cursor: pointer; border: 2px solid transparent; border-radius: 6px; overflow: hidden; background: white; transition: all 0.3s ease;" 
               onclick="selectLogoFromGallery('${logo.url}', '${logo.name}')">
            <img src="${logo.url}" alt="${logo.name}" style="width: 100%; height: 80px; object-fit: cover;" />
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 102, 0, 0.2); opacity: 0; transition: opacity 0.3s ease;" 
                 class="logo-hover"></div>
            <div style="font-size: 11px; padding: 4px; text-align: center; color: #666; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; background: #f9f9f9;">
              ${logo.name}
            </div>
          </div>
        `).join('');

        // Add hover effect
        gallery.querySelectorAll('[class="logo-hover"]').forEach(el => {
          el.parentElement.addEventListener('mouseenter', () => {
            el.style.opacity = '1';
          });
          el.parentElement.addEventListener('mouseleave', () => {
            el.style.opacity = '0';
          });
        });

      } catch (error) {
        console.error('Error loading logo gallery:', error);
        gallery.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #dc3545; font-size: 12px; margin: 20px 0;">Error loading logos. Try uploading a new one.</p>';
      }
    }

    /**
     * Select logo from gallery
     */
    function selectLogoFromGallery(url, name) {
      document.getElementById('configLogo').value = url;
      updateLogoPreview();
      console.log(`Selected logo: ${name}`);
    }

    /**
     * Update logo preview in real-time
     */
    function updateLogoPreview() {
      const logoUrl = document.getElementById('configLogo').value;
      const logoPreview = document.getElementById('logoPreview');
      const logoPlaceholder = document.getElementById('logoPlaceholder');
      
      if (logoUrl && logoUrl.trim() !== '') {
        logoPreview.src = logoUrl;
        logoPreview.style.display = 'block';
        logoPlaceholder.style.display = 'none';
        logoPreview.onerror = function() {
          logoPreview.style.display = 'none';
          logoPlaceholder.style.display = 'block';
          logoPlaceholder.textContent = 'Failed to load logo image';
          logoPlaceholder.style.color = '#dc3545';
        };
      } else {
        logoPreview.style.display = 'none';
        logoPlaceholder.style.display = 'block';
        logoPlaceholder.textContent = 'Logo preview will appear here';
        logoPlaceholder.style.color = '#999';
      }
    }

    // Add logo preview update on input change
    document.addEventListener('DOMContentLoaded', function() {
      const logoInput = document.getElementById('configLogo');
      if (logoInput) {
        logoInput.addEventListener('input', updateLogoPreview);
        logoInput.addEventListener('change', updateLogoPreview);
      }
      initLogoUpload();
      initProjectImageUpload();
      initServiceImageUpload();
      populateBlogCategorySelects();
      populateProjectCategorySelects();
      populateServiceCategorySelects();
    });

    /**
     * ===== PROJECT IMAGE UPLOAD =====
     * Handles project cover image upload with drag-drop, progress, gallery, and preview
     */
    function initProjectImageUpload() {
      const dropZone = document.getElementById('projectImageDropZone');
      const fileInput = document.getElementById('projectImageFileInput');
      const imageInput = document.getElementById('projectCoverImage');

      if (!dropZone || !fileInput) return; // Elements may not exist yet

      // Click to select file
      dropZone.addEventListener('click', () => fileInput.click());

      // Drag and drop
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.background = '#ff6600';
        dropZone.style.color = 'white';
      });

      dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.background = '#fffaf5';
        dropZone.style.color = 'inherit';
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.background = '#fffaf5';
        dropZone.style.color = 'inherit';

        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleProjectImageFileSelect(files[0]);
        }
      });

      // File input change
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleProjectImageFileSelect(e.target.files[0]);
        }
      });

      // Load gallery and update preview on input change
      loadProjectImageGallery();
      imageInput.addEventListener('input', updateProjectImagePreview);
      imageInput.addEventListener('change', updateProjectImagePreview);
    }

    /**
     * Handle project image file selection, validation, and upload
     */
    async function handleProjectImageFileSelect(file) {
      const validTypes = ['image/png', 'image/jpeg', 'image/gif'];
      const maxSize = 5 * 1024 * 1024; // 5MB

      // Validate file type
      if (!validTypes.includes(file.type)) {
        showUploadStatus('projectImage', 'Invalid file type. Please upload PNG, JPG, or GIF.');
        return;
      }

      // Validate file size
      if (file.size > maxSize) {
        showUploadStatus('projectImage', 'File size exceeds 5MB limit.');
        return;
      }

      // Show upload progress
      const progressContainer = document.getElementById('projectImageUploadProgress');
      const progressBar = document.getElementById('projectImageProgressBar');
      const progressText = document.getElementById('projectImageProgressText');
      progressContainer.style.display = 'block';
      progressBar.style.width = '0%';
      progressText.textContent = 'Processing...';

      try {
        // Create object URL for preview
        const objectUrl = URL.createObjectURL(file);
        
        // Store file for later use with form submission
        window.projectImageFile = file;
        
        // Show preview
        const img = document.getElementById('projectImagePreview');
        const placeholder = document.getElementById('projectImagePlaceholder');
        img.src = objectUrl;
        img.style.display = 'block';
        placeholder.style.display = 'none';
        
        // Show success message
        progressContainer.style.display = 'none';
        showUploadStatus('projectImage', 'Image loaded successfully! <i class="fa fa-check"></i>', 'success');
      } catch (error) {
        progressContainer.style.display = 'none';
        showUploadStatus('projectImage', `Error: ${error.message}`);
        handleApiError(error.message, 'handleProjectImageFileSelect');
      }
    }

    /**
     * Load and display project image gallery
     */
    async function loadProjectImageGallery() {
      const gallery = document.getElementById('projectImageGallery');
      if (!gallery) return;

      try {
        // Get all projects and extract their images
        const projectsResponse = await DashboardApp.API.get('/api/projects/');
        const projects = projectsResponse.results || projectsResponse;
        
        // Flatten all images from all projects
        const allImages = [];
        projects.forEach(project => {
          if (project.images && Array.isArray(project.images)) {
            project.images.forEach(img => {
              allImages.push({
                image: img.image,
                caption: img.caption || project.title,
                project_title: project.title
              });
            });
          }
          // Also include cover image if it exists
          if (project.cover_image) {
            allImages.push({
              image: project.cover_image,
              caption: project.title + ' (Cover)',
              project_title: project.title
            });
          }
        });
        
        if (!allImages || allImages.length === 0) {
          gallery.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; font-size: 12px; margin: 20px 0;">No project images available. Add some projects first.</p>';
          return;
        }

        gallery.innerHTML = allImages.map(img => `
          <div style="position: relative; cursor: pointer; border-radius: 6px; overflow: hidden; border: 2px solid transparent; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#ff6600'" onmouseout="this.style.borderColor='transparent'" onclick="selectProjectImageFromGallery('${img.image}', '${DashboardApp.sanitize(img.caption)}')">
            <img src="${img.image}" alt="${DashboardApp.sanitize(img.caption)}" style="width: 100%; height: 80px; object-fit: cover;" />
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 102, 0, 0.6); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
              <i class="fa fa-check" style="color: white; font-size: 20px;"></i>
            </div>
            <div style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.7); color: white; padding: 5px; font-size: 10px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;">${DashboardApp.sanitize(img.caption)}</div>
          </div>
        `).join('');
      } catch (error) {
        gallery.innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: #dc3545; font-size: 12px; margin: 20px 0;">Failed to load images: ${error.message}</p>`;
        handleApiError(error.message, 'loadProjectImageGallery');
      }
    }

    /**
     * Select project image from gallery
     */
    function selectProjectImageFromGallery(imageUrl, imageName) {
      document.getElementById('projectCoverImage').value = imageUrl;
      updateProjectImagePreview();
      showUploadStatus('projectImage', `Selected: ${imageName} <i class="fa fa-check"></i>`, 'success');
    }

    /**
     * Update project image preview
     */
    function updateProjectImagePreview() {
      // Check if there's a newly selected file in window.projectImageFile (for new uploads)
      if (window.projectImageFile) {
        const objectUrl = URL.createObjectURL(window.projectImageFile);
        const imagePreview = document.getElementById('projectImagePreview');
        const imagePlaceholder = document.getElementById('projectImagePlaceholder');
        
        imagePreview.src = objectUrl;
        imagePreview.style.display = 'block';
        imagePlaceholder.style.display = 'none';
        return;
      }
      
      // Otherwise, check if there's an existing image URL in the hidden field
      const imageUrl = document.getElementById('projectCoverImage').value;
      const imagePreview = document.getElementById('projectImagePreview');
      const imagePlaceholder = document.getElementById('projectImagePlaceholder');
      
      if (imageUrl && imageUrl.trim() !== '') {
        imagePreview.src = imageUrl;
        imagePreview.style.display = 'block';
        imagePlaceholder.style.display = 'none';
        imagePreview.onerror = function() {
          imagePreview.style.display = 'none';
          imagePlaceholder.style.display = 'block';
          imagePlaceholder.textContent = 'Failed to load image';
          imagePlaceholder.style.color = '#dc3545';
        };
      } else {
        imagePreview.style.display = 'none';
        imagePlaceholder.style.display = 'block';
        imagePlaceholder.textContent = 'Preview will appear here';
        imagePlaceholder.style.color = '#999';
      }
    }

    /**
     * ===== SERVICE IMAGE UPLOAD =====
     * Handles service featured image upload with drag-drop, progress, gallery, and preview
     */
    function initServiceImageUpload() {
      const dropZone = document.getElementById('serviceImageDropZone');
      const fileInput = document.getElementById('serviceImageFileInput');
      const imageInput = document.getElementById('serviceFeaturedImage');

      if (!dropZone || !fileInput) return; // Elements may not exist yet

      // Click to select file
      dropZone.addEventListener('click', () => fileInput.click());

      // Drag and drop
      dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.background = '#ff6600';
        dropZone.style.color = 'white';
      });

      dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.background = '#fffaf5';
        dropZone.style.color = 'inherit';
      });

      dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropZone.style.background = '#fffaf5';
        dropZone.style.color = 'inherit';

        const files = e.dataTransfer.files;
        if (files.length > 0) {
          handleServiceImageFileSelect(files[0]);
        }
      });

      // File input change
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          handleServiceImageFileSelect(e.target.files[0]);
        }
      });

      // Load gallery and update preview on input change
      loadServiceImageGallery();
      imageInput.addEventListener('input', updateServiceImagePreview);
      imageInput.addEventListener('change', updateServiceImagePreview);
    }

    /**
     * Handle service image file selection, validation, and upload
     */
    async function handleServiceImageFileSelect(file) {
      const validTypes = ['image/png', 'image/jpeg', 'image/gif'];
      const maxSize = 5 * 1024 * 1024; // 5MB

      // Validate file type
      if (!validTypes.includes(file.type)) {
        showUploadStatus('serviceImage', 'Invalid file type. Please upload PNG, JPG, or GIF.');
        return;
      }

      // Validate file size
      if (file.size > maxSize) {
        showUploadStatus('serviceImage', 'File size exceeds 5MB limit.');
        return;
      }

      // Show upload progress
      const progressContainer = document.getElementById('serviceImageUploadProgress');
      const progressBar = document.getElementById('serviceImageProgressBar');
      const progressText = document.getElementById('serviceImageProgressText');
      progressContainer.style.display = 'block';
      progressBar.style.width = '0%';
      progressText.textContent = 'Processing...';

      try {
        // Create object URL for preview
        const objectUrl = URL.createObjectURL(file);
        
        // Store file for later use with form submission
        window.serviceImageFile = file;
        
        // Show preview
        const img = document.getElementById('serviceImagePreview');
        const placeholder = document.getElementById('serviceImagePlaceholder');
        img.src = objectUrl;
        img.style.display = 'block';
        placeholder.style.display = 'none';
        
        // Show success message
        progressContainer.style.display = 'none';
        showUploadStatus('serviceImage', 'Image loaded successfully! <i class="fa fa-check"></i>', 'success');
      } catch (error) {
        progressContainer.style.display = 'none';
        showUploadStatus('serviceImage', `Error: ${error.message}`);
        handleApiError(error.message, 'handleServiceImageFileSelect');
      }
    }

    /**
     * Load and display service image gallery
     */
    async function loadServiceImageGallery() {
      const gallery = document.getElementById('serviceImageGallery');
      if (!gallery) return;

      try {
        // Get all services and extract their images
        const servicesResponse = await DashboardApp.API.get('/api/services/');
        const services = servicesResponse.results || servicesResponse;
        
        // Flatten all featured images from services
        const allImages = [];
        services.forEach(service => {
          if (service.featured_image) {
            allImages.push({
              image: service.featured_image,
              caption: service.title + (service.featured_image_alt ? ` (${service.featured_image_alt})` : ''),
              service_title: service.title
            });
          }
        });
        
        if (!allImages || allImages.length === 0) {
          gallery.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; font-size: 12px; margin: 20px 0;">No service images available. Add some services first.</p>';
          return;
        }

        gallery.innerHTML = allImages.map(img => `
          <div style="position: relative; cursor: pointer; border-radius: 6px; overflow: hidden; border: 2px solid transparent; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#ff6600'" onmouseout="this.style.borderColor='transparent'" onclick="selectServiceImageFromGallery('${img.image}', '${DashboardApp.sanitize(img.caption)}')">
            <img src="${img.image}" alt="${DashboardApp.sanitize(img.caption)}" style="width: 100%; height: 80px; object-fit: cover;" />
            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 102, 0, 0.6); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
              <i class="fa fa-check" style="color: white; font-size: 20px;"></i>
            </div>
            <div style="position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0, 0, 0, 0.7); color: white; padding: 5px; font-size: 10px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap;">${DashboardApp.sanitize(img.caption)}</div>
          </div>
        `).join('');
      } catch (error) {
        gallery.innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: #dc3545; font-size: 12px; margin: 20px 0;">Failed to load images: ${error.message}</p>`;
        handleApiError(error.message, 'loadServiceImageGallery');
      }
    }

    /**
     * Select service image from gallery
     */
    function selectServiceImageFromGallery(imageUrl, imageName) {
      document.getElementById('serviceFeaturedImage').value = imageUrl;
      updateServiceImagePreview();
      showUploadStatus('serviceImage', `Selected: ${imageName} <i class="fa fa-check"></i>`, 'success');
    }

    /**
     * Update service image preview
     */
    function updateServiceImagePreview() {
      // Check if there's a newly selected file in window.serviceImageFile (for new uploads)
      if (window.serviceImageFile) {
        const objectUrl = URL.createObjectURL(window.serviceImageFile);
        const imagePreview = document.getElementById('serviceImagePreview');
        const imagePlaceholder = document.getElementById('serviceImagePlaceholder');
        
        imagePreview.src = objectUrl;
        imagePreview.style.display = 'block';
        imagePlaceholder.style.display = 'none';
        return;
      }
      
      // Otherwise, check if there's an existing image URL in the hidden field
      const imageUrl = document.getElementById('serviceFeaturedImage').value;
      const imagePreview = document.getElementById('serviceImagePreview');
      const imagePlaceholder = document.getElementById('serviceImagePlaceholder');
      
      if (imageUrl && imageUrl.trim() !== '') {
        imagePreview.src = imageUrl;
        imagePreview.style.display = 'block';
        imagePlaceholder.style.display = 'none';
        imagePreview.onerror = function() {
          imagePreview.style.display = 'none';
          imagePlaceholder.style.display = 'block';
          imagePlaceholder.textContent = 'Failed to load image';
          imagePlaceholder.style.color = '#dc3545';
        };
      } else {
        imagePreview.style.display = 'none';
        imagePlaceholder.style.display = 'block';
        imagePlaceholder.textContent = 'Preview will appear here';
        imagePlaceholder.style.color = '#999';
      }
    }

    // ===== PROJECTS API =====
    async function loadProjects() {
      try {
        const response = await DashboardApp.API.get('/api/projects/');
        const projects = response.results || response;
        displayProjectsTable(projects);
      } catch (e) {
        handleApiError(e.message, 'loadProjects');
        showTableError('projectsTableBody', 'projects', e.message);
      }
    }

    function displayProjectsTable(projects) {
      const tbody = document.getElementById('projectsTableBody');
      if (!projects || projects.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="no-data"><i class="fa fa-inbox"></i><p>No projects found.</p></td></tr>';
        return;
      }
      tbody.innerHTML = projects.map(p => `
        <tr>
          <td><strong>${p.title}</strong></td>
          <td>${p.category_name || 'N/A'}</td>
          <td><span class="status-badge status-${p.status}">${p.status}</span></td>
          <td>${p.is_featured ? 'Yes' : 'No'}</td>
          <td>
            <div class="table-actions">
              <button type="button" class="btn btn-edit btn-sm" onclick="openEditProjectModal(${p.id})" title="Edit project"><i class="fa fa-edit"></i> Edit</button>
              <button type="button" class="btn btn-delete btn-sm" onclick="deleteProjectConfirm(${p.id})" title="Delete project"><i class="fa fa-trash"></i> Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // Initialize image upload storage
    window.projectImageFile = null;
    window.serviceImageFile = null;

    let currentProjectsData = [];
    let isEditingProject = false;

    function openAddProjectModal() {
      isEditingProject = false;
      window.projectImageFile = null;
      document.getElementById('projectId').value = '';
      document.getElementById('projectForm').reset();
      document.getElementById('projectModalTitle').textContent = 'Add Project';
      document.getElementById('projectSubmitText').textContent = 'Save Project';
      DashboardApp.Editor.clear('projectDescEditor');
      updateProjectImagePreview();
      document.getElementById('projectModal').classList.add('active');
      hideProjectMessages();
    }

    async function openEditProjectModal(id) {
      try {
        const project = await DashboardApp.API.get(`/api/projects/${id}/`);
        isEditingProject = true;
        document.getElementById('projectId').value = project.id;
        document.getElementById('projectTitle').value = project.title;
        document.getElementById('projectCategory').value = project.category || '';
        document.getElementById('projectStatus').value = project.status;
        document.getElementById('projectFeatured').value = project.is_featured ? 'true' : 'false';
        document.getElementById('projectShortDesc').value = project.short_description || '';
        document.getElementById('projectStartDate').value = project.start_date || '';
        document.getElementById('projectEndDate').value = project.end_date || '';
        document.getElementById('projectCoverImage').value = project.cover_image || '';
        DashboardApp.Editor.setContent('projectDescEditor', project.long_description || '');
        updateProjectImagePreview();
        document.getElementById('projectModalTitle').textContent = 'Edit Project';
        document.getElementById('projectSubmitText').textContent = 'Update Project';
        document.getElementById('projectModal').classList.add('active');
        hideProjectMessages();
      } catch (error) { 
        DashboardApp.Toast.show(error.message, 'error');
      }
    }

    function closeProjectModal() {
      document.getElementById('projectModal').classList.remove('active');
      document.getElementById('projectForm').reset();
      window.projectImageFile = null;
      updateProjectImagePreview();
    }

    function showProjectSuccess(msg) {
      const el = document.getElementById('projectSuccessMessage');
      document.getElementById('projectSuccessText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function showProjectError(msg) {
      const el = document.getElementById('projectErrorMessage');
      document.getElementById('projectErrorText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function hideProjectMessages() {
      document.getElementById('projectSuccessMessage').classList.remove('active');
      document.getElementById('projectErrorMessage').classList.remove('active');
    }

    document.getElementById('projectForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideProjectMessages();
      const projectId = document.getElementById('projectId').value;
      const longDesc = DashboardApp.Editor.getContent('projectDescEditor');
      const method = isEditingProject ? 'PUT' : 'POST';
      const endpoint = isEditingProject ? `/api/projects/${projectId}/` : `/api/projects/`;
      
      // Create FormData to handle file upload
      const formData = new FormData();
      formData.append('title', document.getElementById('projectTitle').value);
      formData.append('short_description', document.getElementById('projectShortDesc').value);
      formData.append('long_description', longDesc);
      formData.append('category', document.getElementById('projectCategory').value || null);
      formData.append('status', document.getElementById('projectStatus').value);
      formData.append('is_featured', document.getElementById('projectFeatured').value === 'true');
      formData.append('start_date', document.getElementById('projectStartDate').value || null);
      formData.append('end_date', document.getElementById('projectEndDate').value || null);
      
      // Add image file if selected
      if (window.projectImageFile) {
        formData.append('cover_image', window.projectImageFile);
      }
      
      try {
        if (method === 'POST') {
          await DashboardApp.API.postFormData(endpoint, formData);
        } else {
          await DashboardApp.API.postFormData(endpoint, formData);
        }
        DashboardApp.Toast.show(`Project ${isEditingProject ? 'updated' : 'saved'} successfully!`, 'success');
        window.projectImageFile = null;
        setTimeout(() => { closeProjectModal(); loadProjects(); }, 1500);
      } catch (error) { 
        DashboardApp.Toast.show(error.message, 'error');
      }
    });

    function deleteProjectConfirm(id) {
      DashboardApp.Modal.create('confirmDeleteProject', {
        title: 'Delete Project',
        content: 'Are you sure you want to delete this project? This action cannot be undone.',
        buttons: [
          { text: 'Cancel', type: 'default', onClick: () => {} },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/projects/${id}/`);
                DashboardApp.Toast.show('Project deleted successfully', 'success');
                loadProjects();
              } catch (error) {
                DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
              }
            }
          }
        ]
      });
      DashboardApp.Modal.open('confirmDeleteProject');
    }

    async function deleteProject(id) {
      // Deprecated - use deleteProjectConfirm instead
      await deleteProjectConfirm(id);
    }

    // --- PROJECT CATEGORIES ---
    async function loadProjectCategories() {
      try {
        const response = await DashboardApp.API.get('/api/project-categories/');
        const cats = response.results || response;
        currentProjectsData = cats;
        displayProjectCategoriesTable(cats);
        populateProjectCategorySelect(cats);
      } catch (e) { 
        console.error('Error loading project categories:', e);
        document.getElementById('projectCategoriesTableBody').innerHTML = `<tr><td colspan="4" class="no-data"><i class="fa fa-exclamation-circle"></i><p>${e.message}</p></td></tr>`; 
      }
    }

    function displayProjectCategoriesTable(cats) {
      const tbody = document.getElementById('projectCategoriesTableBody');
      if (!cats || cats.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="no-data"><i class="fa fa-inbox"></i><p>No categories found.</p></td></tr>';
        return;
      }
      tbody.innerHTML = cats.map(c => `
        <tr>
          <td><strong>${c.name}</strong></td>
          <td>${c.description || ''}</td>
          <td><span class="status-badge status-${c.is_active ? 'published' : 'archived'}">${c.is_active ? 'Active' : 'Inactive'}</span></td>
          <td>
            <div class="table-actions">
              <button type="button" class="btn btn-edit btn-sm" onclick="openEditProjectCategoryModal(${c.id})" title="Edit category"><i class="fa fa-edit"></i> Edit</button>
              <button type="button" class="btn btn-delete btn-sm" onclick="deleteProjectCategoryConfirm(${c.id})" title="Delete category"><i class="fa fa-trash"></i> Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function populateProjectCategorySelect(cats) {
      const select = document.getElementById('projectCategory');
      select.innerHTML = '<option value="">-- Select Category --</option>' + cats.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    }

    let isEditingProjectCat = false;

    function openAddProjectCategoryModal() {
      isEditingProjectCat = false;
      document.getElementById('projectCatId').value = '';
      document.getElementById('projectCategoryForm').reset();
      document.getElementById('projectCatModalTitle').textContent = 'Add Project Category';
      document.getElementById('projectCatSubmitText').textContent = 'Save Category';
      document.getElementById('projectCategoryModal').classList.add('active');
      hideProjectCatMessages();
    }

    async function openEditProjectCategoryModal(id) {
      try {
        const cat = await DashboardApp.API.get(`/api/project-categories/${id}/`);
        isEditingProjectCat = true;
        document.getElementById('projectCatId').value = cat.id;
        document.getElementById('projectCatName').value = cat.name;
        document.getElementById('projectCatDesc').value = cat.description || '';
        document.getElementById('projectCatActive').value = cat.is_active ? 'true' : 'false';
        document.getElementById('projectCatModalTitle').textContent = 'Edit Project Category';
        document.getElementById('projectCatSubmitText').textContent = 'Update Category';
        document.getElementById('projectCategoryModal').classList.add('active');
        hideProjectCatMessages();
      } catch (e) { DashboardApp.Toast.show(e.message, 'error'); }
    }

    function closeProjectCategoryModal() {
      document.getElementById('projectCategoryModal').classList.remove('active');
      document.getElementById('projectCategoryForm').reset();
    }

    function showProjectCatSuccess(msg) {
      const el = document.getElementById('projectCatSuccessMessage');
      document.getElementById('projectCatSuccessText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function showProjectCatError(msg) {
      const el = document.getElementById('projectCatErrorMessage');
      document.getElementById('projectCatErrorText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function hideProjectCatMessages() {
      document.getElementById('projectCatSuccessMessage').classList.remove('active');
      document.getElementById('projectCatErrorMessage').classList.remove('active');
    }

    document.getElementById('projectCategoryForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideProjectCatMessages();
      const catId = document.getElementById('projectCatId').value;
      const endpoint = isEditingProjectCat ? `/api/project-categories/${catId}/` : `/api/project-categories/`;
      const data = {
        name: document.getElementById('projectCatName').value,
        description: document.getElementById('projectCatDesc').value,
        is_active: document.getElementById('projectCatActive').value === 'true'
      };
      try {
        const headers = { 'X-CSRFToken': getCsrfToken() };
        let result;
        if (isEditingProjectCat) {
          result = await DashboardApp.API.put(endpoint, data, headers);
        } else {
          result = await DashboardApp.API.post(endpoint, data, headers);
        }
        DashboardApp.Toast.show(`Category ${isEditingProjectCat ? 'updated' : 'saved'} successfully!`, 'success');
        setTimeout(() => { closeProjectCategoryModal(); loadProjectCategories(); }, 1500);
      } catch (e) { DashboardApp.Toast.show(e.message, 'error'); }
    });

    function deleteProjectCategoryConfirm(id) {
      DashboardApp.Modal.create('confirmDeleteProjectCategory', {
        title: 'Delete Project Category',
        content: 'Are you sure you want to delete this category?',
        buttons: [
          { text: 'Cancel', type: 'default', onClick: () => {} },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/project-categories/${id}/`);
                DashboardApp.Toast.show('Category deleted successfully', 'success');
                loadProjectCategories();
              } catch (error) {
                DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
              }
            }
          }
        ]
      });
      DashboardApp.Modal.open('confirmDeleteProjectCategory');
    }

    async function deleteProjectCategory(id) {
      // Deprecated - use deleteProjectCategoryConfirm instead
      await deleteProjectCategoryConfirm(id);
    }

    // --- SERVICES ---
    async function loadServices() {
      try {
        const response = await DashboardApp.API.get('/api/services/');
        const services = response.results || response;
        displayServicesTable(services);
      } catch (e) {
        handleApiError(e.message, 'loadServices');
        showTableError('servicesTableBody', 'services', e.message);
      }
    }

    function displayServicesTable(services) {
      const tbody = document.getElementById('servicesTableBody');
      if (!services || services.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="no-data"><i class="fa fa-inbox"></i><p>No services found.</p></td></tr>';
        return;
      }
      tbody.innerHTML = services.map(s => `
        <tr>
          <td><strong>${s.title}</strong></td>
          <td>${s.category_name || 'N/A'}</td>
          <td><span class="status-badge status-${s.status}">${s.status}</span></td>
          <td>${s.is_featured ? 'Yes' : 'No'}</td>
          <td>
            <div class="table-actions">
              <button type="button" class="btn btn-edit btn-sm" onclick="openEditServiceModal(${s.id})" title="Edit service"><i class="fa fa-edit"></i> Edit</button>
              <button type="button" class="btn btn-delete btn-sm" onclick="deleteServiceConfirm(${s.id})" title="Delete service"><i class="fa fa-trash"></i> Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    let isEditingService = false;

    function openAddServiceModal() {
      isEditingService = false;
      window.serviceImageFile = null;
      document.getElementById('serviceId').value = '';
      document.getElementById('serviceForm').reset();
      document.getElementById('serviceModalTitle').textContent = 'Add Service';
      document.getElementById('serviceSubmitText').textContent = 'Save Service';
      DashboardApp.Editor.clear('serviceContentEditor');
      updateServiceImagePreview();
      document.getElementById('serviceModal').classList.add('active');
      hideServiceMessages();
    }

    async function openEditServiceModal(id) {
      try {
        const service = await DashboardApp.API.get(`/api/services/${id}/`);
        isEditingService = true;
        document.getElementById('serviceId').value = service.id;
        document.getElementById('serviceTitle').value = service.title;
        document.getElementById('serviceCategory').value = service.category || '';
        document.getElementById('serviceStatus').value = service.status;
        document.getElementById('serviceFeatured').value = service.is_featured ? 'true' : 'false';
        document.getElementById('serviceExcerpt').value = service.excerpt || '';
        document.getElementById('serviceFeaturedImage').value = service.featured_image || '';
        DashboardApp.Editor.setContent('serviceContentEditor', service.content || '');
        updateServiceImagePreview();
        document.getElementById('serviceModalTitle').textContent = 'Edit Service';
        document.getElementById('serviceSubmitText').textContent = 'Update Service';
        document.getElementById('serviceModal').classList.add('active');
        hideServiceMessages();
      } catch (error) { 
        DashboardApp.Toast.show(error.message, 'error');
      }
    }

    function closeServiceModal() {
      document.getElementById('serviceModal').classList.remove('active');
      document.getElementById('serviceForm').reset();
      window.serviceImageFile = null;
      updateServiceImagePreview();
    }

    function showServiceSuccess(msg) {
      const el = document.getElementById('serviceSuccessMessage');
      document.getElementById('serviceSuccessText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function showServiceError(msg) {
      const el = document.getElementById('serviceErrorMessage');
      document.getElementById('serviceErrorText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function hideServiceMessages() {
      document.getElementById('serviceSuccessMessage').classList.remove('active');
      document.getElementById('serviceErrorMessage').classList.remove('active');
    }

    document.getElementById('serviceForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideServiceMessages();
      const serviceId = document.getElementById('serviceId').value;
      const content = DashboardApp.Editor.getContent('serviceContentEditor');
      const method = isEditingService ? 'PUT' : 'POST';
      const endpoint = isEditingService ? `/api/services/${serviceId}/` : `/api/services/`;
      
      // Create FormData to handle file upload
      const formData = new FormData();
      formData.append('title', document.getElementById('serviceTitle').value);
      formData.append('excerpt', document.getElementById('serviceExcerpt').value);
      formData.append('content', content);
      formData.append('category', document.getElementById('serviceCategory').value || null);
      formData.append('status', document.getElementById('serviceStatus').value);
      formData.append('is_featured', document.getElementById('serviceFeatured').value === 'true');
      
      // Add image file if selected
      if (window.serviceImageFile) {
        formData.append('featured_image', window.serviceImageFile);
      }
      
      try {
        if (method === 'POST') {
          await DashboardApp.API.postFormData(endpoint, formData);
        } else {
          await DashboardApp.API.postFormData(endpoint, formData);
        }
        DashboardApp.Toast.show(`Service ${isEditingService ? 'updated' : 'saved'} successfully!`, 'success');
        window.serviceImageFile = null;
        setTimeout(() => { closeServiceModal(); loadServices(); }, 1500);
      } catch (error) { 
        DashboardApp.Toast.show(error.message, 'error');
      }
    });

    function deleteServiceConfirm(id) {
      DashboardApp.Modal.create('confirmDeleteService', {
        title: 'Delete Service',
        content: 'Are you sure you want to delete this service?',
        buttons: [
          { text: 'Cancel', type: 'default', onClick: () => {} },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/services/${id}/`);
                DashboardApp.Toast.show('Service deleted successfully', 'success');
                loadServices();
              } catch (error) {
                DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
              }
            }
          }
        ]
      });
      DashboardApp.Modal.open('confirmDeleteService');
    }

    async function deleteService(id) {
      // Deprecated - use deleteServiceConfirm instead
      await deleteServiceConfirm(id);
    }

    // --- SERVICE CATEGORIES ---
    async function loadServiceCategories() {
      try {
        const response = await DashboardApp.API.get('/api/service-categories/');
        const cats = response.results || response;
        displayServiceCategoriesTable(cats);
        populateServiceCategorySelect(cats);
      } catch (error) {
        handleApiError(error.message, 'loadServiceCategories');
        document.getElementById('serviceCategoriesTableBody').innerHTML = `<tr><td colspan="5" class="no-data"><i class="fa fa-exclamation-circle"></i><p>${error.message}</p></td></tr>`; 
      }
    }

    function displayServiceCategoriesTable(cats) {
      const tbody = document.getElementById('serviceCategoriesTableBody');
      if (!cats || cats.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="no-data"><i class="fa fa-inbox"></i><p>No categories found.</p></td></tr>';
        return;
      }
      tbody.innerHTML = cats.map(c => `
        <tr>
          <td><strong>${c.name}</strong></td>
          <td>${c.description || ''}</td>
          <td>${c.icon ? `<i class="fa ${c.icon}"></i>` : ''}</td>
          <td><span class="status-badge status-${c.is_active ? 'published' : 'archived'}">${c.is_active ? 'Active' : 'Inactive'}</span></td>
          <td>
            <div class="table-actions">
              <button type="button" class="btn btn-edit btn-sm" onclick="openEditServiceCategoryModal(${c.id})" title="Edit category"><i class="fa fa-edit"></i> Edit</button>
              <button type="button" class="btn btn-delete btn-sm" onclick="deleteServiceCategoryConfirm(${c.id})" title="Delete category"><i class="fa fa-trash"></i> Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function populateServiceCategorySelect(cats) {
      const select = document.getElementById('serviceCategory');
      select.innerHTML = '<option value="">-- Select Category --</option>' + cats.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    }

    let isEditingServiceCat = false;

    function openAddServiceCategoryModal() {
      isEditingServiceCat = false;
      document.getElementById('serviceCatId').value = '';
      document.getElementById('serviceCategoryForm').reset();
      document.getElementById('serviceCatModalTitle').textContent = 'Add Service Category';
      document.getElementById('serviceCatSubmitText').textContent = 'Save Category';
      document.getElementById('serviceCategoryModal').classList.add('active');
      hideServiceCatMessages();
    }

    async function openEditServiceCategoryModal(id) {
      try {
        const cat = await DashboardApp.API.get(`/api/service-categories/${id}/`);
        isEditingServiceCat = true;
        document.getElementById('serviceCatId').value = cat.id;
        document.getElementById('serviceCatName').value = cat.name;
        document.getElementById('serviceCatDesc').value = cat.description || '';
        document.getElementById('serviceCatIcon').value = cat.icon || '';
        document.getElementById('serviceCatActive').value = cat.is_active ? 'true' : 'false';
        document.getElementById('serviceCatModalTitle').textContent = 'Edit Service Category';
        document.getElementById('serviceCatSubmitText').textContent = 'Update Category';
        document.getElementById('serviceCategoryModal').classList.add('active');
        hideServiceCatMessages();
      } catch (e) { DashboardApp.Toast.show(e.message, 'error'); }
    }

    function closeServiceCategoryModal() {
      document.getElementById('serviceCategoryModal').classList.remove('active');
      document.getElementById('serviceCategoryForm').reset();
    }

    function showServiceCatSuccess(msg) {
      const el = document.getElementById('serviceCatSuccessMessage');
      document.getElementById('serviceCatSuccessText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function showServiceCatError(msg) {
      const el = document.getElementById('serviceCatErrorMessage');
      document.getElementById('serviceCatErrorText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function hideServiceCatMessages() {
      document.getElementById('serviceCatSuccessMessage').classList.remove('active');
      document.getElementById('serviceCatErrorMessage').classList.remove('active');
    }

    document.getElementById('serviceCategoryForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideServiceCatMessages();
      const catId = document.getElementById('serviceCatId').value;
      const endpoint = isEditingServiceCat ? `/api/service-categories/${catId}/` : `/api/service-categories/`;
      const data = {
        name: document.getElementById('serviceCatName').value,
        description: document.getElementById('serviceCatDesc').value,
        icon: document.getElementById('serviceCatIcon').value,
        is_active: document.getElementById('serviceCatActive').value === 'true'
      };
      try {
        const headers = { 'X-CSRFToken': getCsrfToken() };
        let result;
        if (isEditingServiceCat) {
          result = await DashboardApp.API.put(endpoint, data, headers);
        } else {
          result = await DashboardApp.API.post(endpoint, data, headers);
        }
        DashboardApp.Toast.show(`Category ${isEditingServiceCat ? 'updated' : 'saved'} successfully!`, 'success');
        setTimeout(() => { closeServiceCategoryModal(); loadServiceCategories(); }, 1500);
      } catch (e) { DashboardApp.Toast.show(e.message, 'error'); }
    });

    function deleteServiceCategoryConfirm(id) {
      DashboardApp.Modal.create('confirmDeleteServiceCategory', {
        title: 'Delete Service Category',
        content: 'Are you sure you want to delete this category?',
        buttons: [
          { text: 'Cancel', type: 'default', onClick: () => {} },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/service-categories/${id}/`);
                DashboardApp.Toast.show('Category deleted successfully', 'success');
                loadServiceCategories();
              } catch (error) {
                DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
              }
            }
          }
        ]
      });
      DashboardApp.Modal.open('confirmDeleteServiceCategory');
    }

    async function deleteServiceCategory(id) {
      // Deprecated - use deleteServiceCategoryConfirm instead
      await deleteServiceCategoryConfirm(id);
    }

    // --- ARTICLES (EDIT/DELETE INLINE) ---
    let isEditingArticle = false;

    async function loadArticlesForTable() {
      try {
        const response = await DashboardApp.API.get('/api/blog-posts/');
        const articles = response.results || response;
        allArticles = articles;  // Store for filtering
        filterArticles();  // Apply filters and display
      } catch (e) {
        handleApiError(e.message, 'loadArticlesForTable');
        showTableError('articlesTableBody', 'articles', e.message);
      }
    }

    /**
     * Populate blog category dropdowns with available categories
     */
    async function populateBlogCategorySelects() {
      try {
        const categories = await DashboardApp.API.get('/api/blog-categories/');
        
        // Update all category selects
        const selects = ['category', 'articleCategory', 'editCategory'];
        selects.forEach(selectId => {
          const select = document.getElementById(selectId);
          if (select) {
            const currentValue = select.value;
            select.innerHTML = '<option value="">-- Select or Create Category --</option>';
            categories.forEach(cat => {
              const option = document.createElement('option');
              option.value = cat.id;
              option.textContent = cat.name;
              select.appendChild(option);
            });
            select.value = currentValue;
          }
        });
      } catch (error) {
        console.error('[CATEGORY] Failed to load blog categories:', error);
      }
    }

    /**
     * Update icon preview when icon class changes
     */
    function updateIconPreview() {
      const iconInput = document.getElementById('categoryIcon');
      const iconPreview = document.getElementById('iconPreview');
      if (iconInput && iconPreview) {
        const iconClass = iconInput.value.trim() || 'fa-bookmark';
        iconPreview.className = 'fa ' + iconClass;
      }
    }

    // Global variables for category editing
    let isEditingCategory = false;
    let editingCategory = null;

    /**
     * Open create category modal for blog categories
     */
    function openAddBlogCategoryModal() {
      // Reset editing state
      isEditingCategory = false;
      editingCategory = null;
      
      // Clear all previous messages
      hideCategoryMessages();
      document.getElementById('createCategorySuccessText').textContent = '';
      document.getElementById('createCategoryErrorText').textContent = '';
      
      // Reset form and set defaults
      document.getElementById('categoryType').value = 'blog';
      document.getElementById('createCategoryTitle').textContent = 'Create New Blog Category';
      document.getElementById('categoryIcon').value = 'fa-bookmark';
      document.getElementById('createCategoryForm').reset();
      
      // Update icon preview
      updateIconPreview();
      
      // Open modal
      document.getElementById('createCategoryModal').classList.add('active');
    }

    /**
     * Open create category modal from article modal
     */
    function openAddBlogCategoryModalFromArticle() {
      openAddBlogCategoryModal();
    }

    /**
     * Close category creation modal
     */
    function closeCreateCategoryModal() {
      document.getElementById('createCategoryModal').classList.remove('active');
    }

    function showCategorySuccess(msg) {
      const el = document.getElementById('createCategorySuccessMessage');
      document.getElementById('createCategorySuccessText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 4000);
    }

    function showCategoryError(msg) {
      const el = document.getElementById('createCategoryErrorMessage');
      document.getElementById('createCategoryErrorText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 4000);
    }

    function hideCategoryMessages() {
      document.getElementById('createCategorySuccessMessage').classList.remove('active');
      document.getElementById('createCategoryErrorMessage').classList.remove('active');
    }

    /**
     * Handle category form submission
     */
    document.getElementById('createCategoryForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideCategoryMessages();

      const categoryType = document.getElementById('categoryType').value;
      const categoryName = document.getElementById('categoryName').value.trim();
      const categoryDescription = document.getElementById('categoryDescription').value.trim();
      const categoryIcon = document.getElementById('categoryIcon').value.trim() || 'fa-bookmark';
      const categoryActive = document.getElementById('categoryActive').value === 'true';

      if (!categoryName) {
        DashboardApp.Toast.show('Please enter a category name', 'warning');
        return;
      }

      // Determine endpoint based on category type
      const endpoint = categoryType === 'blog' ? '/api/blog-categories/' : 
                      categoryType === 'project' ? '/api/project-categories/' : 
                      '/api/service-categories/';

      const data = {
        name: categoryName,
        description: categoryDescription,
        icon: categoryIcon,
        is_active: categoryActive
      };

      try {
        let newCategory;
        if (isEditingCategory) {
          await DashboardApp.API.put(endpoint, data);
          newCategory = { ...editingCategory, ...data };
          DashboardApp.Toast.show(`Category updated successfully!`, 'success');
        } else {
          newCategory = await DashboardApp.API.post(endpoint, data);
          DashboardApp.Toast.show(`"${categoryName}" created successfully!`, 'success');
        }

        console.log(`[CATEGORY] ${categoryType} category created:`, newCategory);

        // Refresh the appropriate dropdown
        if (categoryType === 'blog') {
          await populateBlogCategorySelects();
          // Auto-select in active form
          const activeSelect = document.querySelector('.modal.active select[id*="category"]') || 
                              document.getElementById('articleCategory') || 
                              document.getElementById('category');
          if (activeSelect && newCategory.id) {
            activeSelect.value = newCategory.id;
          }
        } else if (categoryType === 'project') {
          await populateProjectCategorySelects();
          const select = document.getElementById('projectCategory');
          if (select && newCategory.id) {
            select.value = newCategory.id;
          }
        } else if (categoryType === 'service') {
          await populateServiceCategorySelects();
          const select = document.getElementById('serviceCategory');
          if (select && newCategory.id) {
            select.value = newCategory.id;
          }
        }

        setTimeout(() => closeCreateCategoryModal(), 1500);
      } catch (error) {
        DashboardApp.Toast.show(`Failed: ${error.message}`, 'error');
        handleApiError(error.message, 'createCategory');
      }
    });

    /**
     * Open create category modal for project categories
     */
    function openAddProjectCategoryModalFromForm() {
      document.getElementById('categoryType').value = 'project';
      document.getElementById('createCategoryTitle').textContent = 'Create New Project Category';
      document.getElementById('categoryIcon').value = 'fa-briefcase';
      document.getElementById('createCategoryModal').classList.add('active');
      document.getElementById('createCategoryForm').reset();
      hideCategoryMessages();
    }

    /**
     * Open create category modal for service categories
     */
    function openAddServiceCategoryModalFromForm() {
      document.getElementById('categoryType').value = 'service';
      document.getElementById('createCategoryTitle').textContent = 'Create New Service Category';
      document.getElementById('categoryIcon').value = 'fa-cog';
      document.getElementById('createCategoryForm').reset();
      updateIconPreview();
      document.getElementById('createCategoryModal').classList.add('active');
      hideCategoryMessages();
    }

    function displayArticlesTableWithActions(articles) {
      const tbody = document.getElementById('articlesTableBody');
      if (!articles || articles.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="no-data"><i class="fa fa-inbox"></i><p>No articles found.</p></td></tr>';
        return;
      }
      tbody.innerHTML = articles.map(a => `
        <tr>
          <td><strong>${a.title}</strong></td>
          <td>${a.author || '-'}</td>
          <td><span class="status-badge status-${a.status}">${a.status}</span></td>
          <td>${a.view_count || 0}</td>
          <td>${new Date(a.created_at).toLocaleDateString()}</td>
          <td>
            <div class="table-actions">
              <button type="button" class="btn btn-sm btn-edit" onclick="openEditArticleModal(${a.id})" title="Edit article"><i class="fa fa-edit"></i> Edit</button>
              <button type="button" class="btn btn-sm btn-delete" onclick="deleteArticleConfirm(${a.id})" title="Delete article"><i class="fa fa-trash"></i> Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function openEditArticleModal(id) {
      DashboardApp.API.get(`/api/blog-posts/${id}/`)
        .then(article => {
          isEditingArticle = true;
          document.getElementById('articleId').value = article.id;
          document.getElementById('articleTitle').value = article.title;
          document.getElementById('articleAuthor').value = article.author || '';
          document.getElementById('articleExcerpt').value = article.excerpt || '';
          document.getElementById('articleCategory').value = article.category || '';
          document.getElementById('articleStatus').value = article.status;
          
          // Image fields
          document.getElementById('articleFeaturedImage').value = article.featured_image || '';
          document.getElementById('articleFeaturedImageAlt').value = article.featured_image_alt || '';
          document.getElementById('articleThumbnail').value = article.thumbnail || '';
          
          // Update image previews
          updateArticleImagePreviews();
          
          DashboardApp.Editor.setContent('articleContentEditor', article.content || '');
          document.getElementById('articleModalTitle').textContent = 'Edit Article';
          document.getElementById('articleSubmitText').textContent = 'Update Article';
          document.getElementById('articleModal').classList.add('active');
          hideArticleMessages();
        })
        .catch(error => {
          DashboardApp.Toast.show('Error loading article: ' + error.message, 'error');
          handleApiError(error.message, 'openEditArticleModal');
        });
    }
    
    // Function to update image previews
    function updateArticleImagePreviews() {
      const featuredImageUrl = document.getElementById('articleFeaturedImage').value;
      const thumbnailUrl = document.getElementById('articleThumbnail').value;
      const featuredPreview = document.getElementById('articleFeaturedImagePreview');
      const featuredPlaceholder = document.getElementById('articleFeaturedImagePlaceholder');
      const thumbnailPreview = document.getElementById('articleThumbnailPreview');
      const thumbnailPlaceholder = document.getElementById('articleThumbnailPlaceholder');
      
      // Featured image preview
      if (featuredImageUrl) {
        featuredPreview.src = featuredImageUrl;
        featuredPreview.style.display = 'block';
        featuredPlaceholder.style.display = 'none';
      } else {
        featuredPreview.style.display = 'none';
        featuredPlaceholder.style.display = 'block';
      }
      
      // Thumbnail preview
      if (thumbnailUrl) {
        thumbnailPreview.src = thumbnailUrl;
        thumbnailPreview.style.display = 'block';
        thumbnailPlaceholder.style.display = 'none';
      } else {
        thumbnailPreview.style.display = 'none';
        thumbnailPlaceholder.style.display = 'block';
      }
    }
    
    // Add event listeners for image URL changes
    document.getElementById('articleFeaturedImage').addEventListener('input', updateArticleImagePreviews);
    document.getElementById('articleThumbnail').addEventListener('input', updateArticleImagePreviews);

    function closeArticleModal() {
      document.getElementById('articleModal').classList.remove('active');
      document.getElementById('articleForm').reset();
      // Reset image previews
      document.getElementById('articleFeaturedImagePreview').style.display = 'none';
      document.getElementById('articleFeaturedImagePlaceholder').style.display = 'block';
      document.getElementById('articleThumbnailPreview').style.display = 'none';
      document.getElementById('articleThumbnailPlaceholder').style.display = 'block';
      isEditingArticle = false;
    }

    function showArticleSuccess(msg) {
      const el = document.getElementById('articleSuccessMessage');
      document.getElementById('articleSuccessText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function showArticleError(msg) {
      const el = document.getElementById('articleErrorMessage');
      document.getElementById('articleErrorText').textContent = msg;
      el.classList.add('active');
      setTimeout(() => el.classList.remove('active'), 5000);
    }

    function hideArticleMessages() {
      document.getElementById('articleSuccessMessage').classList.remove('active');
      document.getElementById('articleErrorMessage').classList.remove('active');
    }

    document.getElementById('articleForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      hideArticleMessages();
      const articleId = document.getElementById('articleId').value;
      const content = DashboardApp.Editor.getContent('articleContentEditor');
      const method = isEditingArticle ? 'PUT' : 'POST';
      const endpoint = isEditingArticle ? `/api/blog-posts/${articleId}/` : `/api/blog-posts/`;
      const categoryId = document.getElementById('articleCategory').value;

      if (!categoryId) {
        DashboardApp.Toast.show('Please select or create a category', 'warning');
        return;
      }

      const data = {
        title: document.getElementById('articleTitle').value,
        author: document.getElementById('articleAuthor').value,
        excerpt: document.getElementById('articleExcerpt').value,
        content: content,
        category: parseInt(categoryId),
        status: document.getElementById('articleStatus').value,
        featured_image: document.getElementById('articleFeaturedImage').value || null,
        featured_image_alt: document.getElementById('articleFeaturedImageAlt').value || '',
        thumbnail: document.getElementById('articleThumbnail').value || null
      };
      try {
        if (method === 'POST') {
          await DashboardApp.API.post(endpoint, data);
        } else {
          await DashboardApp.API.put(endpoint, data);
        }
        DashboardApp.Toast.show(`Article ${isEditingArticle ? 'updated' : 'saved'} successfully!`, 'success');
        setTimeout(() => { closeArticleModal(); loadArticlesForTable(); }, 1500);
      } catch (error) { 
        DashboardApp.Toast.show(error.message, 'error');
      }
    });

    function deleteArticleConfirm(id) {
      DashboardApp.Modal.create('confirmDeleteArticle', {
        title: 'Delete Article',
        content: 'Are you sure you want to delete this article? This action cannot be undone.',
        buttons: [
          { text: 'Cancel', type: 'default', onClick: () => {} },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/blog-posts/${id}/`);
                DashboardApp.Toast.show('Article deleted successfully', 'success');
                loadArticlesForTable();
              } catch (error) {
                DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
              }
            }
          }
        ]
      });
      DashboardApp.Modal.open('confirmDeleteArticle');
    }

    async function deleteArticleFunc(id) {
      // Deprecated - use deleteArticleConfirm instead
      await deleteArticleConfirm(id);
    }

    // Store all articles for filtering
    let allArticles = [];

    function filterArticles() {
      const searchInput = document.getElementById('searchArticles') ? document.getElementById('searchArticles').value.toLowerCase() : '';
      const statusFilter = document.getElementById('filterStatus') ? document.getElementById('filterStatus').value : '';
      const sortBy = document.getElementById('sortArticles') ? document.getElementById('sortArticles').value : 'newest';

      // Filter articles
      let filtered = allArticles.filter(a => {
        const matchesSearch = !searchInput || 
          a.title.toLowerCase().includes(searchInput) || 
          (a.author && a.author.toLowerCase().includes(searchInput));
        const matchesStatus = !statusFilter || statusFilter === '' || a.status === statusFilter;
        return matchesSearch && matchesStatus;
      });

      // Sort articles
      switch(sortBy) {
        case 'oldest':
          filtered.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
          break;
        case 'title-asc':
          filtered.sort((a, b) => a.title.localeCompare(b.title));
          break;
        case 'title-desc':
          filtered.sort((a, b) => b.title.localeCompare(a.title));
          break;
        case 'views':
          filtered.sort((a, b) => (b.view_count || 0) - (a.view_count || 0));
          break;
        case 'newest':
        default:
          filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      }

      // Update results counter
      const resultCount = filtered.length;
      const countElement = document.getElementById('articleCount');
      if (countElement) {
        countElement.textContent = resultCount;
      }

      // Display filtered results
      displayArticlesTableWithActions(filtered);
    }

    function resetFilters() {
      const searchInput = document.getElementById('searchArticles');
      const statusFilter = document.getElementById('filterStatus');
      const sortBy = document.getElementById('sortArticles');
      
      if (searchInput) searchInput.value = '';
      if (statusFilter) statusFilter.value = '';
      if (sortBy) sortBy.value = 'newest';
      
      filterArticles();
    }

    // --- SITE CONFIGURATION (SINGLETON) ---

    async function loadConfiguration() {
      try {
        const config = await DashboardApp.API.get('/api/site-config/');
        populateConfigurationForm(config);
        DashboardApp.Toast.show('Configuration loaded', 'info', 2000);
      } catch (e) {
        console.error('Error loading configuration:', e);
        DashboardApp.Toast.show('Error loading configuration: ' + e.message, 'error');
      }
    }

    function populateConfigurationForm(config) {
      // Helper function to safely set element value
      const setValue = (id, value) => {
        const el = document.getElementById(id);
        if (el) {
          if (el.type === 'checkbox') {
            el.checked = value || false;
          } else {
            el.value = value || '';
          }
        }
      };

      // Basic Information
      setValue('configCompanyName', config.company_name);
      setValue('configEmailMain', config.email);
      setValue('configPhoneMain', config.phone);
      setValue('configWebsiteMain', config.website);
      setValue('configAddressMain', config.address);
      setValue('configAboutMain', config.about_excerpt);

      // Social Links
      setValue('configFacebook', config.facebook_url);
      setValue('configInstagram', config.instagram_url);
      setValue('configYoutube', config.youtube_url);
      setValue('configLinkedin', config.linkedin_url);
      setValue('configTwitter', config.x_url);
      setValue('configCustomLinkUrl', config.custom_link_url);
      setValue('configCustomLinkText', config.custom_link_text);

      // Analytics & Tracking
      setValue('configEnableAnalytics', config.enable_analytics);
      setValue('configEnableTracking', config.enable_tracking);
      setValue('configGoogleAnalyticsId', config.google_analytics_id);
      setValue('configGoogleTagManagerId', config.google_tag_manager_id);
      setValue('configFacebookPixelId', config.facebook_pixel_id);
      setValue('configHotjarId', config.hotjar_id);
      setValue('configClarityId', config.clarity_id);
      setValue('configRecaptchaSiteKey', config.recaptcha_site_key);
      setValue('configRecaptchaSecretKey', config.recaptcha_secret_key);
      setValue('configCustomTrackingCode', config.custom_tracking_code);

      // Logo
      if (config.logo) {
        displayLogoPreview(config.logo);
      }
      setValue('configLogoAlt', config.logo_alt_text || 'Site Logo');
    }

    function displayLogoPreview(logoUrl) {
      const preview = document.getElementById('logoPreview');
      if (logoUrl) {
        preview.innerHTML = `<img src="${logoUrl}" style="max-width: 100%; max-height: 100%; object-fit: contain;" />`;
      }
    }

    async function saveConfiguration() {
      try {
        const formData = new FormData();
        
        // Helper function to get element value safely
        const getValue = (id) => {
          const el = document.getElementById(id);
          return el ? el.value : '';
        };

        const getChecked = (id) => {
          const el = document.getElementById(id);
          return el ? el.checked : false;
        };

        // Basic Information
        formData.append('company_name', getValue('configCompanyName'));
        formData.append('email', getValue('configEmailMain'));
        formData.append('phone', getValue('configPhoneMain'));
        formData.append('website', getValue('configWebsiteMain') || '');
        formData.append('address', getValue('configAddressMain'));
        formData.append('about_excerpt', getValue('configAboutMain') || '');

        // Social Links
        formData.append('facebook_url', getValue('configFacebook') || '');
        formData.append('instagram_url', getValue('configInstagram') || '');
        formData.append('youtube_url', getValue('configYoutube') || '');
        formData.append('linkedin_url', getValue('configLinkedin') || '');
        formData.append('x_url', getValue('configTwitter') || '');
        formData.append('custom_link_url', getValue('configCustomLinkUrl') || '');
        formData.append('custom_link_text', getValue('configCustomLinkText') || '');

        // Analytics & Tracking
        formData.append('enable_analytics', getChecked('configEnableAnalytics'));
        formData.append('enable_tracking', getChecked('configEnableTracking'));
        formData.append('google_analytics_id', getValue('configGoogleAnalyticsId') || '');
        formData.append('google_tag_manager_id', getValue('configGoogleTagManagerId') || '');
        formData.append('facebook_pixel_id', getValue('configFacebookPixelId') || '');
        formData.append('hotjar_id', getValue('configHotjarId') || '');
        formData.append('clarity_id', getValue('configClarityId') || '');
        formData.append('recaptcha_site_key', getValue('configRecaptchaSiteKey') || '');
        formData.append('recaptcha_secret_key', getValue('configRecaptchaSecretKey') || '');
        formData.append('custom_tracking_code', getValue('configCustomTrackingCode') || '');

        // Logo
        const logoFileInput = document.getElementById('configLogo');
        if (logoFileInput && logoFileInput.files[0]) {
          formData.append('logo', logoFileInput.files[0]);
        }
        formData.append('logo_alt_text', getValue('configLogoAlt') || 'Site Logo');

        // Send request
        const headers = { 'X-CSRFToken': getCsrfToken() };
        const updatedConfig = await DashboardApp.API.postFormData(`/api/site-config/`, formData, headers);
        DashboardApp.Toast.show('Configuration saved successfully!', 'success');
        populateConfigurationForm(updatedConfig);
      } catch (e) {
        console.error('Error saving configuration:', e);
        DashboardApp.Toast.show('Error: ' + e.message, 'error');
      }
    }

    // Tab Navigation
    function switchToTab(tabName) {
      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(el => {
        el.classList.remove('active');
      });

      // Remove active class from all buttons
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
      });

      // Show selected tab
      const tabElement = document.getElementById(tabName);
      if (tabElement) {
        tabElement.classList.add('active');
      }

      // Activate button
      const button = document.querySelector(`[data-tab="${tabName}"]`);
      if (button) {
        button.classList.add('active');
      }

      // Load data when tabs are clicked
      if (tabName === 'team-members') loadTeamMembersTable().catch(e => console.error('Error loading team members:', e));
      if (tabName === 'projects') loadProjects().catch(e => console.error('Error loading projects:', e));
      if (tabName === 'project-categories') loadProjectCategories().catch(e => console.error('Error loading project categories:', e));
      if (tabName === 'services') loadServices().catch(e => console.error('Error loading services:', e));
      if (tabName === 'service-categories') loadServiceCategories().catch(e => console.error('Error loading service categories:', e));
      if (tabName === 'articles-list') loadArticlesForTable().catch(e => console.error('Error loading articles:', e));
      if (tabName === 'leads') loadLeadsTable().catch(e => console.error('Error loading leads:', e));
      if (tabName === 'clients') loadClientsTable().catch(e => console.error('Error loading clients:', e));
      if (tabName === 'careers') loadCareersTable().catch(e => console.error('Error loading careers:', e));
      if (tabName === 'notices') loadNoticesTable().catch(e => console.error('Error loading notices:', e));
      if (tabName === 'job-applications') loadJobApplicationsTable().catch(e => console.error('Error loading job applications:', e));
      if (tabName === 'configurations') loadConfiguration().catch(e => console.error('Error loading configuration:', e));
    }

    document.querySelectorAll('.tab-button').forEach(button => {
      button.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');
        switchToTab(tabName);
      });
    });

    // Article Filter Event Listeners
    const articlesSearchInput = document.getElementById('articlesSearch');
    const articleStatusFilter = document.getElementById('articleStatusFilter');
    const articleSortBy = document.getElementById('articleSortBy');
    const resetFiltersBtn = document.getElementById('resetArticleFilters');

    if (articlesSearchInput) {
      articlesSearchInput.addEventListener('input', filterArticles);
    }
    if (articleStatusFilter) {
      articleStatusFilter.addEventListener('change', filterArticles);
    }
    if (articleSortBy) {
      articleSortBy.addEventListener('change', filterArticles);
    }
    if (resetFiltersBtn) {
      resetFiltersBtn.addEventListener('click', resetFilters);
    }

    // Team Member Modal Functions
    function openAddTeamModal() {
      isEditMode = false;
      document.getElementById('modalTitle').textContent = 'Add Team Member';
      document.getElementById('submitBtnText').textContent = 'Add Member';
      document.getElementById('editMemberId').value = '';
      document.getElementById('teamMemberForm').reset();
      document.getElementById('memberPhoto').required = true; // Make photo required for new members
      document.getElementById('teamMemberModal').classList.add('active');
      hideMessages();
    }

    function openEditTeamModal(id) {
      isEditMode = true;
      const member = currentTeamMembers.find(m => m.id === id);

      if (!member) {
        showError('Team member not found');
        return;
      }

      document.getElementById('modalTitle').textContent = 'Edit Team Member';
      document.getElementById('submitBtnText').textContent = 'Update Member';
      document.getElementById('editMemberId').value = member.id;
      document.getElementById('memberName').value = member.name;
      document.getElementById('memberPosition').value = member.position;
      document.getElementById('memberBio').value = member.bio;
      document.getElementById('memberLinkedin').value = member.linkedin_url || '';
      document.getElementById('memberFacebook').value = member.facebook_url || '';
      document.getElementById('memberInstagram').value = member.instagram_url || '';
      // For file input, we can't set a value for security reasons
      // The photo field will show current photo but allow new upload
      document.getElementById('memberPhoto').required = false; // Make photo optional for edits
      document.getElementById('memberActive').value = member.is_active ? 'true' : 'false';

      document.getElementById('teamMemberModal').classList.add('active');
      hideMessages();
    }

    function closeTeamModal() {
      document.getElementById('teamMemberModal').classList.remove('active');
      document.getElementById('teamMemberForm').reset();
      document.getElementById('editMemberId').value = '';
      isEditMode = false;
      hideMessages();
    }

    function showSuccess(message) {
      const successMsg = document.getElementById('successMessage');
      document.getElementById('successText').textContent = message;
      successMsg.classList.add('active');
      setTimeout(() => successMsg.classList.remove('active'), 5000);
    }

    function showError(message) {
      const errorMsg = document.getElementById('errorMessage');
      document.getElementById('errorText').textContent = message;
      errorMsg.classList.add('active');
      setTimeout(() => errorMsg.classList.remove('active'), 5000);
    }

    function hideMessages() {
      document.getElementById('successMessage').classList.remove('active');
      document.getElementById('errorMessage').classList.remove('active');
    }

    // Load Team Members into Table
    async function loadTeamMembersTable() {
      try {
        const response = await DashboardApp.API.get('/api/team-members/');
        const teamMembers = response.results || response;
        currentTeamMembers = teamMembers;
        displayTeamMembersTable(teamMembers);
      } catch (error) {
        handleApiError(error.message, 'loadTeamMembersTable');
        showTableError('teamTableBody', 'team members', error.message);
      }
    }

    function displayTeamMembersTable(members) {
      const tbody = document.getElementById('teamTableBody');

      if (!members || members.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="no-data"><i class="fa fa-users"></i><p>No team members found. Add your first team member!</p></td></tr>';
        return;
      }

      tbody.innerHTML = members.map(member => `
        <tr>
          <td>
            <img src="${member.photo}" alt="${member.name}" class="team-photo" onerror="this.src='https://via.placeholder.com/50'" />
          </td>
          <td><strong>${member.name}</strong></td>
          <td>${member.position}</td>
          <td class="bio-cell" title="${member.bio}">${member.bio}</td>
          <td>
            <span class="status-badge status-${member.is_active ? 'published' : 'archived'}">
              ${member.is_active ? 'Active' : 'Inactive'}
            </span>
          </td>
          <td>
            <button onclick="openEditTeamModal(${member.id})" class="btn btn-sm btn-primary" title="Edit">
              <i class="fa fa-edit"></i>
            </button>
            <button onclick="deleteTeamMemberConfirm(${member.id})" class="btn btn-sm btn-danger" title="Delete">
              <i class="fa fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
    }

    // Toggle dropdown menu
    function toggleDropdown(event, id) {
      event.stopPropagation();
      const dropdown = document.getElementById(`dropdown-${id}`);

      // Close all other dropdowns
      document.querySelectorAll('.dropdown-content').forEach(d => {
        if (d.id !== `dropdown-${id}`) {
          d.classList.remove('show');
        }
      });

      dropdown.classList.toggle('show');
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.matches('.dropdown-toggle')) {
        document.querySelectorAll('.dropdown-content').forEach(dropdown => {
          dropdown.classList.remove('show');
        });
      }

      // Close modals when clicking outside modal-content
      if (event.target.classList.contains('modal') && event.target.classList.contains('active')) {
        event.target.classList.remove('active');
      }
    });

    // Add/Edit Team Member
    document.getElementById('teamMemberForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      hideMessages();

      const formDataObj = new FormData();
      formDataObj.append('name', document.getElementById('memberName').value);
      formDataObj.append('position', document.getElementById('memberPosition').value);
      formDataObj.append('bio', document.getElementById('memberBio').value);
      formDataObj.append('linkedin_url', document.getElementById('memberLinkedin').value || '');
      formDataObj.append('facebook_url', document.getElementById('memberFacebook').value || '');
      formDataObj.append('instagram_url', document.getElementById('memberInstagram').value || '');
      formDataObj.append('is_active', document.getElementById('memberActive').value);

      // Handle photo upload
      const photoFile = document.getElementById('memberPhoto').files[0];
      if (photoFile) {
        formDataObj.append('photo', photoFile);
      }

      try {
        const memberId = document.getElementById('editMemberId').value;
        let result;

        if (isEditMode && memberId) {
          // For updates, use PATCH with FormData
          result = await DashboardApp.API.call(`/api/team-members/${memberId}/`, {
            method: 'PATCH',
            body: formDataObj,
            isFormData: true,
            headers: { 'X-CSRFToken': getCsrfToken() }
          });
        } else {
          // For new team members, use POST with FormData
          result = await DashboardApp.API.call(`/api/team-members/`, {
            method: 'POST',
            body: formDataObj,
            isFormData: true,
            headers: { 'X-CSRFToken': getCsrfToken() }
          });
        }

        showSuccess(` Team member ${isEditMode ? 'updated' : 'added'} successfully!`);

        setTimeout(() => {
          closeTeamModal();
          loadTeamMembersTable();
        }, 1500);
      } catch (error) {
        console.error('Error saving team member:', error);
        showError(error.message || `Failed to ${isEditMode ? 'update' : 'add'} team member. Please try again.`);
      }
    });

    // Delete Team Member
    function deleteTeamMemberConfirm(id) {
      const member = currentTeamMembers.find(m => m.id === id);
      const memberName = member ? member.name : 'this team member';
      DashboardApp.Modal.create('confirmDeleteMember', {
        title: 'Delete Team Member',
        content: `Are you sure you want to delete ${memberName}?`,
        buttons: [
          { text: 'Cancel', type: 'default', onClick: () => {} },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/team-members/${id}/`);
                DashboardApp.Toast.show('Team member deleted successfully', 'success');
                loadTeamMembersTable();
              } catch (error) {
                DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
              }
            }
          }
        ]
      });
      DashboardApp.Modal.open('confirmDeleteMember');
    }

    async function deleteTeamMember(id) {
      // Deprecated - use deleteTeamMemberConfirm instead
      await deleteTeamMemberConfirm(id);
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('teamMemberModal');
      if (event.target === modal) {
        closeTeamModal();
      }
    }

    // Load articles from backend
    async function loadArticles() {
      try {
        const response = await DashboardApp.API.get('/api/blog-posts/');
        const articles = response.results || response;
        updateStats(articles);
        populateArticlesTable(articles);
        populateSelectArticles(articles);
      } catch (error) {
        handleApiError(error.message, 'loadArticles');
        const tableBody = document.getElementById('articlesTableBody');
        if (tableBody) {
          showTableError('articlesTableBody', 'articles', error.message);
        }
      }
    }

    function updateStats(articles) {
      const total = articles.length;
      const published = articles.filter(a => a.status === 'published').length;
      const drafts = articles.filter(a => a.status === 'draft').length;
      const views = articles.reduce((sum, a) => sum + (a.views || 0), 0);

      const totalEl = document.getElementById('totalArticles');
      const pubEl = document.getElementById('publishedArticles');
      const draftEl = document.getElementById('draftArticles');
      const viewEl = document.getElementById('totalViews');

      if (totalEl) totalEl.textContent = total;
      if (pubEl) pubEl.textContent = published;
      if (draftEl) draftEl.textContent = drafts;
      if (viewEl) viewEl.textContent = views;
    }

    function populateArticlesTable(articles) {
      const tbody = document.getElementById('articlesTableBody');
      if (!tbody) return;  // Element doesn't exist in public view

      if (articles.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="no-data"><i class="fa fa-inbox"></i><p>No articles found.</p></td></tr>';
        return;
      }

      tbody.innerHTML = articles.map(article => `
        <tr>
          <td><strong>${article.title}</strong></td>
          <td>${article.author || 'N/A'}</td>
          <td><span class="status-badge status-${article.status}">${article.status}</span></td>
          <td>${article.views}</td>
          <td>${article.created_at}</td>
          <td>
            <div class="table-actions">
              <button type="button" class="btn btn-view btn-sm" onclick="viewArticle(${article.id})" title="View article">
                <i class="fa fa-eye"></i> View
              </button>
              <button type="button" class="btn btn-edit btn-sm" onclick="editArticle(${article.id})" title="Edit article">
                <i class="fa fa-edit"></i> Edit
              </button>
              <button type="button" class="btn btn-delete btn-sm" onclick="deleteArticle(${article.id})" title="Delete article">
                <i class="fa fa-trash"></i> Delete
              </button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function populateSelectArticles(articles) {
      const select = document.getElementById('selectArticle');
      if (!select) return;  // Element doesn't exist on this page
      
      const options = articles.map(article =>
        `<option value="${article.id}">${article.title}</option>`
      ).join('');
      select.innerHTML = '<option value="">-- Choose an article --</option>' + options;
    }

    // Edit Article - Removed (now using inline modal-based editing in articles list)

    function openConfig(type) {
      console.log('[CONFIG] Opening configuration for:', type);
      // Configuration editor is now handled inline in the dashboard
      const tabName = type.toLowerCase().replace(/\s+/g, '-') + '-tab';
      switchToTab(tabName);
    }

    // Hide preloader when page loads
    function hidePreloader() {
      const preloader = document.querySelector('.preloader');
      const bgPreloader = document.querySelector('.bg-preloader');
      if (preloader) preloader.style.display = 'none';
      if (bgPreloader) bgPreloader.style.display = 'none';
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Load initial data
      Promise.all([
        loadArticles().catch(e => console.error('Failed to load articles:', e)),
        loadProjects().catch(e => console.error('Failed to load projects:', e)),
        loadProjectCategories().catch(e => console.error('Failed to load project categories:', e)),
        loadServices().catch(e => console.error('Failed to load services:', e)),
        loadServiceCategories().catch(e => console.error('Failed to load service categories:', e)),
        loadTeamMembersTable().catch(e => console.error('Failed to load team members:', e)),
        loadConfiguration().catch(e => console.error('Failed to load configuration:', e))
      ]).then(() => {
        hidePreloader();
      }).catch(() => {
        hidePreloader();
      });
    });

    // Also hide preloader when window fully loads
    window.addEventListener('load', hidePreloader);

    document.getElementById('addArticleForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      document.getElementById('content').value = DashboardApp.Editor.getContent('contentEditor');
      const categoryId = document.getElementById('category').value;
      
      if (!categoryId) {
        DashboardApp.Toast.show('Please select or create a category', 'warning');
        return;
      }

      const data = {
        title: document.getElementById('title').value,
        author: document.getElementById('author').value,
        excerpt: document.getElementById('excerpt').value,
        content: document.getElementById('content').value,
        category: parseInt(categoryId),
        status: document.getElementById('status').value
      };
      try {
        await DashboardApp.API.post('/api/blog-posts/', data);
        document.getElementById('addArticleForm').reset();
        DashboardApp.Editor.clear('contentEditor');
        await loadArticles();
        switchToTab('articles-list');
        DashboardApp.Toast.show('Article created successfully', 'success');
      } catch (error) {
        DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
      }
    });

    const editArticleForm = document.getElementById('editArticleForm');
    if (editArticleForm) {
      editArticleForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        const articleId = document.getElementById('editArticleId').value;
        const categoryId = document.getElementById('editCategory').value;
      
      if (!categoryId) {
        DashboardApp.Toast.show('Please select or create a category', 'warning');
        return;
      }

      document.getElementById('editContent').value = DashboardApp.Editor.getContent('editContentEditor');
      const data = {
        title: document.getElementById('editTitle').value,
        author: document.getElementById('editAuthor').value,
        excerpt: document.getElementById('editExcerpt').value,
        content: document.getElementById('editContent').value,
        category: parseInt(categoryId),
        status: document.getElementById('editStatus').value
      };
      try {
        await DashboardApp.API.put(`/api/blog-posts/${articleId}/`, data);
        await loadArticles();
        switchToTab('articles-list');
        DashboardApp.Toast.show('Article updated successfully', 'success');
      } catch (error) {
        DashboardApp.Toast.show(`Error: ${error.message}`, 'error');
      }
      });
    }

    // Note: Logout functionality is handled by the logout() function above (line ~3544)
    // The logout button uses onclick="logout()" which shows a confirmation modal
    // DO NOT add event listeners here as they will conflict with the onclick handler

    // ============================================
    // ABOUT PAGE MANAGEMENT
    // ============================================
    let aboutList = [];

    // Load all about content entries
    async function loadAboutList() {
      try {
        const response = await DashboardApp.API.get('/api/about/');
        console.log('[About] Raw API response:', response);
        
        // Handle different response structures
        let data = null;
        if (response && response.data) {
          data = response.data;
        } else if (response) {
          data = response;
        }
        
        // Handle paginated response structure
        if (data && data.results && Array.isArray(data.results)) {
          aboutList = data.results;
        } else if (Array.isArray(data)) {
          aboutList = data;
        } else if (data && typeof data === 'object') {
          // Single object response, wrap in array
          aboutList = [data];
        } else {
          aboutList = [];
        }
        
        console.log('[About] Processed about list:', aboutList);
        displayAboutTable();
      } catch (error) {
        console.error('[About] Error loading about list:', error);
        console.error('[About] Error details:', error.response || error);
        DashboardApp.Toast.show('Error loading about list', 'error');
        document.getElementById('aboutTableBody').innerHTML = '<tr><td colspan="4" class="no-data" style="text-align: center; color: #999;">Error loading data</td></tr>';
      }
    }

    function displayAboutTable() {
      const tbody = document.getElementById('aboutTableBody');
      
      if (!aboutList || aboutList.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="no-data" style="text-align: center; color: #999;">No about content yet. Click "Add About Content" to create one.</td></tr>';
        return;
      }

      tbody.innerHTML = aboutList.map(about => `
        <tr>
          <td>
            <strong>${about.title || 'Untitled'}</strong>
            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
              ${about.content ? (about.content.substring(0, 100) + (about.content.length > 100 ? '...' : '')) : 'No content'}
            </div>
          </td>
          <td>
            <span class="badge ${about.is_published ? 'badge-success' : 'badge-secondary'}">
              ${about.is_published ? 'Published' : 'Draft'}
            </span>
          </td>
          <td>${about.updated_at ? new Date(about.updated_at).toLocaleDateString() : 'N/A'}</td>
          <td>
            <button onclick="openEditAboutModal(${about.id})" class="btn btn-sm btn-primary" title="Edit">
              <i class="fa fa-edit"></i>
            </button>
            <button onclick="deleteAbout(${about.id})" class="btn btn-sm btn-danger" title="Delete">
              <i class="fa fa-trash"></i>
            </button>
          </td>
        </tr>
      `).join('');
    }

    function openAddAboutModal() {
      // Reset form
      document.getElementById('aboutForm').reset();
      document.getElementById('aboutId').value = '';
      document.getElementById('aboutModalTitle').textContent = 'Add About Content';
      document.getElementById('aboutSubmitText').textContent = 'Save';
      
      // Reset image previews
      resetAboutImagePreviews();
      
      // Hide messages
      document.getElementById('aboutSuccessMessage').style.display = 'none';
      document.getElementById('aboutErrorMessage').style.display = 'none';
      
      // Open modal
      document.getElementById('aboutModal').classList.add('active');
    }
    
    // Function to update image preview from file input
    function updateImagePreview(fileInput, previewId, placeholderId) {
      const preview = document.getElementById(previewId);
      const placeholder = document.getElementById(placeholderId);
      const file = fileInput.files[0];
      
      if (file && preview && placeholder) {
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
          placeholder.style.display = 'none';
        };
        reader.readAsDataURL(file);
      } else if (preview && placeholder) {
        preview.style.display = 'none';
        placeholder.style.display = 'block';
      }
    }
    
    // Function to update all image previews
    function updateAboutImagePreviews() {
      const images = [
        { inputId: 'aboutImage', previewId: 'aboutImagePreview', placeholderId: 'aboutImagePlaceholder' },
        { inputId: 'missionImage', previewId: 'missionImagePreview', placeholderId: 'missionImagePlaceholder' },
        { inputId: 'visionImage', previewId: 'visionImagePreview', placeholderId: 'visionImagePlaceholder' },
        { inputId: 'goalsImage', previewId: 'goalsImagePreview', placeholderId: 'goalsImagePlaceholder' },
        { inputId: 'achievementsImage', previewId: 'achievementsImagePreview', placeholderId: 'achievementsImagePlaceholder' }
      ];
      
      images.forEach(img => {
        const fileInput = document.getElementById(img.inputId);
        if (fileInput && fileInput.files && fileInput.files[0]) {
          updateImagePreview(fileInput, img.previewId, img.placeholderId);
        } else {
          // If no file selected, check if there's an existing image URL (for edit mode)
          const preview = document.getElementById(img.previewId);
          const placeholder = document.getElementById(img.placeholderId);
          if (preview && preview.src && preview.src !== window.location.href) {
            // Keep existing preview if it's a valid image URL
            preview.style.display = 'block';
            if (placeholder) placeholder.style.display = 'none';
          } else {
            if (preview) preview.style.display = 'none';
            if (placeholder) placeholder.style.display = 'block';
          }
        }
      });
    }
    
    // Function to reset all image previews
    function resetAboutImagePreviews() {
      const previews = [
        'aboutImagePreview', 'missionImagePreview', 'visionImagePreview',
        'goalsImagePreview', 'achievementsImagePreview'
      ];
      const placeholders = [
        'aboutImagePlaceholder', 'missionImagePlaceholder', 'visionImagePlaceholder',
        'goalsImagePlaceholder', 'achievementsImagePlaceholder'
      ];
      
      previews.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
      });
      
      placeholders.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'block';
      });
    }
    
    // Add event listeners for file input changes
    document.addEventListener('DOMContentLoaded', function() {
      const imageInputs = [
        { id: 'aboutImage', previewId: 'aboutImagePreview', placeholderId: 'aboutImagePlaceholder' },
        { id: 'missionImage', previewId: 'missionImagePreview', placeholderId: 'missionImagePlaceholder' },
        { id: 'visionImage', previewId: 'visionImagePreview', placeholderId: 'visionImagePlaceholder' },
        { id: 'goalsImage', previewId: 'goalsImagePreview', placeholderId: 'goalsImagePlaceholder' },
        { id: 'achievementsImage', previewId: 'achievementsImagePreview', placeholderId: 'achievementsImagePlaceholder' }
      ];
      
      imageInputs.forEach(img => {
        const input = document.getElementById(img.id);
        if (input) {
          input.addEventListener('change', function() {
            updateImagePreview(input, img.previewId, img.placeholderId);
          });
        }
      });
    });

    function openEditAboutModal(aboutId) {
      // Set modal title
      document.getElementById('aboutModalTitle').textContent = 'Edit About Content';
      document.getElementById('aboutSubmitText').textContent = 'Update';
      
      // Hide messages
      document.getElementById('aboutSuccessMessage').style.display = 'none';
      document.getElementById('aboutErrorMessage').style.display = 'none';
      
      // Load current data into form
      DashboardApp.API.get(`/api/about/${aboutId}/`).then(response => {
        const about = response.data || response;
        document.getElementById('aboutId').value = about.id || '';
        document.getElementById('aboutTitle').value = about.title || '';
        document.getElementById('aboutContent').value = about.content || '';
        document.getElementById('missionTitle').value = about.mission_title || '';
        document.getElementById('missionContent').value = about.mission_content || '';
        document.getElementById('visionTitle').value = about.vision_title || '';
        document.getElementById('visionContent').value = about.vision_content || '';
        document.getElementById('goalsTitle').value = about.goals_title || '';
        document.getElementById('goalsContent').value = about.goals_content || '';
        document.getElementById('achievementsTitle').value = about.achievements_title || '';
        document.getElementById('achievementsContent').value = about.achievements_content || '';
        document.getElementById('aboutPublished').checked = about.is_published || false;
        
        // Show existing images in previews (if they exist)
        if (about.image) {
          const preview = document.getElementById('aboutImagePreview');
          const placeholder = document.getElementById('aboutImagePlaceholder');
          if (preview && placeholder) {
            preview.src = about.image;
            preview.style.display = 'block';
            placeholder.style.display = 'none';
          }
        }
        if (about.mission_image) {
          const preview = document.getElementById('missionImagePreview');
          const placeholder = document.getElementById('missionImagePlaceholder');
          if (preview && placeholder) {
            preview.src = about.mission_image;
            preview.style.display = 'block';
            placeholder.style.display = 'none';
          }
        }
        if (about.vision_image) {
          const preview = document.getElementById('visionImagePreview');
          const placeholder = document.getElementById('visionImagePlaceholder');
          if (preview && placeholder) {
            preview.src = about.vision_image;
            preview.style.display = 'block';
            placeholder.style.display = 'none';
          }
        }
        if (about.goals_image) {
          const preview = document.getElementById('goalsImagePreview');
          const placeholder = document.getElementById('goalsImagePlaceholder');
          if (preview && placeholder) {
            preview.src = about.goals_image;
            preview.style.display = 'block';
            placeholder.style.display = 'none';
          }
        }
        if (about.achievements_image) {
          const preview = document.getElementById('achievementsImagePreview');
          const placeholder = document.getElementById('achievementsImagePlaceholder');
          if (preview && placeholder) {
            preview.src = about.achievements_image;
            preview.style.display = 'block';
            placeholder.style.display = 'none';
          }
        }
        
        // Open modal
        document.getElementById('aboutModal').classList.add('active');
      }).catch(error => {
        console.error('[About] Error loading about data:', error);
        DashboardApp.Toast.show('Error loading about data', 'error');
      });
    }

    function closeAboutModal() {
      document.getElementById('aboutModal').classList.remove('active');
      document.getElementById('aboutForm').reset();
      resetAboutImagePreviews();
    }

    // Handle form submission
    document.getElementById('aboutForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const aboutId = document.getElementById('aboutId').value;
      const title = document.getElementById('aboutTitle').value.trim();
      const content = document.getElementById('aboutContent').value.trim();
      
      if (!title) {
        DashboardApp.Toast.show('Please enter a title', 'warning');
        return;
      }
      
      if (!content) {
        DashboardApp.Toast.show('Please enter content', 'warning');
        return;
      }

      // Create FormData for file uploads
      const formData = new FormData();
      formData.append('title', title);
      formData.append('content', content);
      formData.append('mission_title', document.getElementById('missionTitle').value.trim());
      formData.append('mission_content', document.getElementById('missionContent').value.trim());
      formData.append('vision_title', document.getElementById('visionTitle').value.trim());
      formData.append('vision_content', document.getElementById('visionContent').value.trim());
      formData.append('goals_title', document.getElementById('goalsTitle').value.trim());
      formData.append('goals_content', document.getElementById('goalsContent').value.trim());
      formData.append('achievements_title', document.getElementById('achievementsTitle').value.trim());
      formData.append('achievements_content', document.getElementById('achievementsContent').value.trim());
      formData.append('is_published', document.getElementById('aboutPublished').checked);
      
      // Add image files if selected
      const aboutImageFile = document.getElementById('aboutImage').files[0];
      if (aboutImageFile) formData.append('image', aboutImageFile);
      
      const missionImageFile = document.getElementById('missionImage').files[0];
      if (missionImageFile) formData.append('mission_image', missionImageFile);
      
      const visionImageFile = document.getElementById('visionImage').files[0];
      if (visionImageFile) formData.append('vision_image', visionImageFile);
      
      const goalsImageFile = document.getElementById('goalsImage').files[0];
      if (goalsImageFile) formData.append('goals_image', goalsImageFile);
      
      const achievementsImageFile = document.getElementById('achievementsImage').files[0];
      if (achievementsImageFile) formData.append('achievements_image', achievementsImageFile);

      // Hide messages
      document.getElementById('aboutSuccessMessage').style.display = 'none';
      document.getElementById('aboutErrorMessage').style.display = 'none';

      try {
        // Use FormData for file uploads
        const endpoint = aboutId ? `/api/about/${aboutId}/` : '/api/about/';
        const method = aboutId ? 'PUT' : 'POST';
        
        // Get CSRF token
        const csrfToken = getCsrfToken();
        
        const apiBaseUrl = (DashboardApp && DashboardApp.config && DashboardApp.config.apiBaseUrl) || '';
        const response = await fetch(apiBaseUrl + endpoint, {
          method: method,
          headers: {
            'X-CSRFToken': csrfToken
          },
          body: formData,
          credentials: 'include'
        });
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({ detail: 'Error saving about content' }));
          throw new Error(errorData.detail || 'Error saving about content');
        }
        
        document.getElementById('aboutSuccessText').textContent = aboutId ? 'About content updated successfully!' : 'About content created successfully!';
        document.getElementById('aboutSuccessMessage').style.display = 'block';
        
        DashboardApp.Toast.show(aboutId ? 'About content updated successfully' : 'About content created successfully', 'success');
        
        // Reload list and close modal after a short delay
        setTimeout(() => {
          loadAboutList();
          closeAboutModal();
        }, 1000);
      } catch (error) {
        console.error('[About] Error saving about content:', error);
        document.getElementById('aboutErrorText').textContent = error.response?.data?.detail || 'Error saving about content';
        document.getElementById('aboutErrorMessage').style.display = 'block';
        DashboardApp.Toast.show('Error saving about content', 'error');
      }
    });

    function viewAboutDetails(aboutId) {
      const about = aboutList.find(a => a.id === aboutId);
      if (!about) return;

      let detailsHtml = '<div style="max-height: 600px; overflow-y: auto; padding: 10px;">';
      
      // Main About
      if (about.title || about.content) {
        detailsHtml += '<div style="margin-bottom: 25px;">';
        if (about.title) detailsHtml += `<h3 style="margin-bottom: 10px;">${about.title}</h3>`;
        if (about.content) detailsHtml += `<p style="line-height: 1.6;">${about.content}</p>`;
        if (about.image) detailsHtml += `<img src="${about.image}" alt="${about.title}" style="max-width: 100%; height: auto; margin: 10px 0; border-radius: 8px;">`;
        detailsHtml += '</div>';
      }

      // Mission
      if (about.mission_title || about.mission_content) {
        detailsHtml += '<div style="margin-bottom: 25px; padding: 15px; background: #e3f2fd; border-radius: 8px;">';
        if (about.mission_title) detailsHtml += `<h4 style="color: #007bff; margin-bottom: 10px;">${about.mission_title}</h4>`;
        if (about.mission_content) detailsHtml += `<p style="line-height: 1.6;">${about.mission_content}</p>`;
        if (about.mission_image) detailsHtml += `<img src="${about.mission_image}" alt="${about.mission_title}" style="max-width: 100%; height: auto; margin: 10px 0; border-radius: 8px;">`;
        detailsHtml += '</div>';
      }

      // Vision
      if (about.vision_title || about.vision_content) {
        detailsHtml += '<div style="margin-bottom: 25px; padding: 15px; background: #f3e5f5; border-radius: 8px;">';
        if (about.vision_title) detailsHtml += `<h4 style="color: #6f42c1; margin-bottom: 10px;">${about.vision_title}</h4>`;
        if (about.vision_content) detailsHtml += `<p style="line-height: 1.6;">${about.vision_content}</p>`;
        if (about.vision_image) detailsHtml += `<img src="${about.vision_image}" alt="${about.vision_title}" style="max-width: 100%; height: auto; margin: 10px 0; border-radius: 8px;">`;
        detailsHtml += '</div>';
      }

      // Goals
      if (about.goals_title || about.goals_content) {
        detailsHtml += '<div style="margin-bottom: 25px; padding: 15px; background: #fff3cd; border-radius: 8px;">';
        if (about.goals_title) detailsHtml += `<h4 style="color: #856404; margin-bottom: 10px;">${about.goals_title}</h4>`;
        if (about.goals_content) detailsHtml += `<p style="line-height: 1.6;">${about.goals_content}</p>`;
        if (about.goals_image) detailsHtml += `<img src="${about.goals_image}" alt="${about.goals_title}" style="max-width: 100%; height: auto; margin: 10px 0; border-radius: 8px;">`;
        detailsHtml += '</div>';
      }

      // Achievements
      if (about.achievements_title || about.achievements_content) {
        detailsHtml += '<div style="margin-bottom: 25px; padding: 15px; background: #d4edda; border-radius: 8px;">';
        if (about.achievements_title) detailsHtml += `<h4 style="color: #155724; margin-bottom: 10px;">${about.achievements_title}</h4>`;
        if (about.achievements_content) detailsHtml += `<p style="line-height: 1.6;">${about.achievements_content}</p>`;
        if (about.achievements_image) detailsHtml += `<img src="${about.achievements_image}" alt="${about.achievements_title}" style="max-width: 100%; height: auto; margin: 10px 0; border-radius: 8px;">`;
        detailsHtml += '</div>';
      }

      detailsHtml += '</div>';

      DashboardApp.Modal.create('aboutDetailsModal', {
        title: `About: ${about.title || 'Details'}`,
        content: detailsHtml,
        buttons: [
          {
            text: 'Close',
            type: 'default',
            onClick: () => {}
          },
          {
            text: 'Edit',
            type: 'primary',
            onClick: () => {
              DashboardApp.Modal.close('aboutDetailsModal');
              openEditAboutModal(aboutId);
            }
          }
        ]
      });

      DashboardApp.Modal.open('aboutDetailsModal');
    }

    async function deleteAbout(aboutId) {
      const about = aboutList.find(a => a.id === aboutId);
      if (!about) return;

      DashboardApp.Modal.create('confirmDeleteAbout', {
        title: 'Confirm Delete',
        content: `<p>Are you sure you want to delete "<strong>${about.title || 'this about content'}</strong>"?</p><p style="color: #dc3545;">This action cannot be undone.</p>`,
        buttons: [
          {
            text: 'Cancel',
            type: 'default',
            onClick: () => {}
          },
          {
            text: 'Delete',
            type: 'danger',
            onClick: async () => {
              try {
                await DashboardApp.API.delete(`/api/about/${aboutId}/`);
                DashboardApp.Toast.show('About content deleted successfully', 'success');
                DashboardApp.Modal.close('confirmDeleteAbout');
                loadAboutList();
              } catch (error) {
                console.error('[About] Error deleting about content:', error);
                DashboardApp.Toast.show('Error deleting about content', 'error');
              }
            }
          }
        ]
      });

      DashboardApp.Modal.open('confirmDeleteAbout');
    }

    // Initialize about content when About tab is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Load about list when the about tab is clicked
      const aboutTabButton = document.querySelector('[data-tab="about"]');
      if (aboutTabButton) {
        aboutTabButton.addEventListener('click', function() {
          loadAboutList();
        });
      }
    });
  </script>
  <script>
    const quillOptions = {
      theme: 'snow',
      placeholder: 'Write your article here...',
      modules: {
        toolbar: [
          [{
            header: [1, 2, 3, false]
          }],
          ['bold', 'italic', 'underline', 'strike'],
          [{
            list: 'ordered'
          }, {
            list: 'bullet'
          }],
          ['blockquote', 'code-block'],
          ['link', 'image'],
          ['clean']
        ]
      }
    };

    // ===== REFACTORED DASHBOARD FUNCTIONS =====
    // All complex functionality now uses DashboardApp module for security, modality, and maintainability

    async function populateProjectCategorySelects() {
      try {
        const response = await DashboardApp.API.get('/api/project-categories/');
        const categories = response.results || response;
        const select = document.getElementById('projectCategory');
        if (select) {
          select.innerHTML = '<option value="">-- Select Category --</option>' +
            categories.map(c => `<option value="${c.id}">${DashboardApp.sanitize(c.name)}</option>`).join('');
        }
      } catch (error) {
        console.error('Error loading project categories:', error);
      }
    }

    async function populateServiceCategorySelects() {
      try {
        const response = await DashboardApp.API.get('/api/service-categories/');
        const categories = response.results || response;
        const select = document.getElementById('serviceCategory');
        if (select) {
          select.innerHTML = '<option value="">-- Select Category --</option>' +
            categories.map(c => `<option value="${c.id}">${DashboardApp.sanitize(c.name)}</option>`).join('');
        }
      } catch (error) {
        console.error('Error loading service categories:', error);
      }
    }

    async function populateBlogCategorySelects() {
      try {
        const response = await DashboardApp.API.get('/api/blog-categories/');
        const categories = response.results || response;
        const selects = ['articleCategory', 'category'];
        selects.forEach(selectId => {
          const select = document.getElementById(selectId);
          if (select) {
            const currentValue = select.value;
            select.innerHTML = '<option value="">-- Select Category --</option>' +
              categories.map(c => `<option value="${c.id}">${DashboardApp.sanitize(c.name)}</option>`).join('');
            select.value = currentValue;
          }
        });
      } catch (error) {
        console.error('Error loading blog categories:', error);
      }
    }

    // Initialize all data on page load
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Load initial dashboard data
        loadTeamMembersTable();
        loadProjects();
        loadProjectCategories();
        loadServices();
        loadServiceCategories();
        loadArticlesForTable();
        loadConfiguration();
        loadAnalytics();
        
        // Populate category dropdowns
        populateProjectCategorySelects();
        populateServiceCategorySelects();
        populateBlogCategorySelects();

        DashboardApp.Toast.show('Dashboard ready', 'success', 2000);
      } catch (error) {
        console.error('[Dashboard] Initialization error:', error);
        DashboardApp.Toast.show('Error initializing dashboard', 'error');
      }
    });

    // Analytics Functions
    async function loadAnalytics() {
      try {
        const artResp = await DashboardApp.API.get('/api/blog-posts/');
        const projResp = await DashboardApp.API.get('/api/projects/');
        const servResp = await DashboardApp.API.get('/api/services/');
        const teamResp = await DashboardApp.API.get('/api/team-members/');
        
        const articles = artResp.results || artResp;
        const projects = projResp.results || projResp;
        const services = servResp.results || servResp;
        const team = teamResp.results || teamResp;

        // Update overview cards
        document.getElementById('analyticsArticles').textContent = articles.length;
        document.getElementById('analyticsProjects').textContent = projects.length;
        document.getElementById('analyticsServices').textContent = services.length;
        document.getElementById('analyticsTeam').textContent = team.length;

        // Update chart legend data
        const published = articles.filter(a => a.status === 'published').length;
        const draft = articles.filter(a => a.status === 'draft').length;
        
        document.getElementById('publishedCount').textContent = published;
        document.getElementById('draftCount').textContent = draft;
        document.getElementById('chartArticles').textContent = articles.length;
        document.getElementById('chartProjects').textContent = projects.length;
        document.getElementById('chartServices').textContent = services.length;

        // Create charts if Chart.js is available
        if (typeof Chart !== 'undefined') {
          createArticleStatusChart(published, draft);
          createContentDistributionChart(articles.length, projects.length, services.length);
        }

        // Load recent activity
        loadRecentActivity(articles, projects, services, team);

      } catch (error) {
        console.error('Error loading analytics:', error);
        DashboardApp.Toast.show('Error loading analytics data', 'error');
        document.getElementById('recentActivityList').innerHTML = 
          '<p style="color: #999; text-align: center; padding: 20px;">Error loading analytics data.</p>';
      }
    }

    function createArticleStatusChart(published, draft) {
      const ctx = document.getElementById('articleStatusChart');
      if (!ctx) return;

      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Published', 'Draft'],
          datasets: [{
            data: [published, draft],
            backgroundColor: ['#4CAF50', '#FFC107'],
            borderColor: '#fff',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function createContentDistributionChart(articles, projects, services) {
      const ctx = document.getElementById('contentDistributionChart');
      if (!ctx) return;

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Articles', 'Projects', 'Services'],
          datasets: [{
            label: 'Count',
            data: [articles, projects, services],
            backgroundColor: ['#2196F3', '#FF9800', '#9C27B0'],
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }

    function loadRecentActivity(articles, projects, services, team) {
      const activities = [];

      // Collect recent articles
      articles.slice(0, 3).forEach(article => {
        activities.push({
          type: 'article',
          title: article.title || 'Untitled Article',
          date: article.created_at || new Date().toISOString(),
          icon: 'fa-file-text'
        });
      });

      // Collect recent projects
      projects.slice(0, 3).forEach(project => {
        activities.push({
          type: 'project',
          title: project.title || 'Untitled Project',
          date: project.created_at || new Date().toISOString(),
          icon: 'fa-building'
        });
      });

      // Sort by date (most recent first)
      activities.sort((a, b) => new Date(b.date) - new Date(a.date));

      const container = document.getElementById('recentActivityList');
      
      if (activities.length === 0) {
        container.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">No recent activity.</p>';
        return;
      }

      container.innerHTML = activities.slice(0, 5).map(activity => `
        <div style="display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #eee;">
          <div style="flex-shrink: 0; margin-right: 15px;">
            <i class="fa ${activity.icon}" style="font-size: 18px; color: #ff6600;"></i>
          </div>
          <div style="flex-grow: 1;">
            <div style="font-weight: 500; color: #333;">${DashboardApp.sanitize(activity.title)}</div>
            <div style="font-size: 12px; color: #999; margin-top: 5px;">
              ${new Date(activity.date).toLocaleDateString()} ${new Date(activity.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
            </div>
          </div>
        </div>
      `).join('');
    }

    // Load Leads into Table
    async function loadLeadsTable() {
      try {
        const response = await DashboardApp.API.get('/api/leads/');
        const leads = response.results || response;

        const tbody = document.getElementById('leadsTableBody');
        if (!tbody) return;

        if (leads.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" class="no-data"><i class="fa fa-envelope-o"></i><p>No leads found.</p></td></tr>';
          return;
        }

        tbody.innerHTML = leads.map(lead => {
          const date = new Date(lead.created_at).toLocaleDateString();
          const statusColor = lead.status === 'new' ? '#ff6600' : lead.status === 'qualified' ? '#4CAF50' : '#999';
          return `
            <tr>
              <td>${DashboardApp.sanitize(lead.name)}</td>
              <td><a href="mailto:${lead.email}">${DashboardApp.sanitize(lead.email)}</a></td>
              <td>${lead.phone || 'N/A'}</td>
              <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${DashboardApp.sanitize(lead.message.substring(0, 50))}...</td>
              <td><span style="color: ${statusColor}; font-weight: 500; text-transform: capitalize;">${lead.status}</span></td>
              <td>${DashboardApp.sanitize(lead.source || 'contact-form')}</td>
              <td>${date}</td>
              <td>
                <button type="button" class="btn-action btn-sm" onclick="markLeadRead(${lead.id})" title="Mark as read">
                  <i class="fa fa-eye"></i>
                </button>
                <button type="button" class="btn-action btn-sm" onclick="openEditLeadModal(${lead.id})" title="View details">
                  <i class="fa fa-edit"></i>
                </button>
                <button type="button" class="btn-danger btn-sm" onclick="deleteLead(${lead.id})" title="Delete lead">
                  <i class="fa fa-trash"></i>
                </button>
              </td>
            </tr>
          `;
        }).join('');
      } catch (error) {
        const tbody = document.getElementById('leadsTableBody');
        if (tbody) {
          tbody.innerHTML = `<tr><td colspan="8" class="error-message" style="text-align: center; padding: 20px;">
            <i class="fa fa-warning"></i> Error loading leads: ${DashboardApp.sanitize(error.message)}
          </td></tr>`;
        }
      }
    }

    // Mark Lead as Read
    async function markLeadRead(leadId) {
      try {
        await DashboardApp.API.put(`/api/leads/${leadId}/`, { is_read: true });
        DashboardApp.Toast.show('Lead marked as read', 'success');
        loadLeadsTable();
      } catch (error) {
        DashboardApp.Toast.show('Error marking lead as read: ' + error.message, 'error');
      }
    }

    // Delete Lead
    async function deleteLead(leadId) {
      if (!confirm('Are you sure you want to delete this lead?')) return;
      try {
        await DashboardApp.API.delete(`/api/leads/${leadId}/`);
        DashboardApp.Toast.show('Lead deleted successfully', 'success');
        loadLeadsTable();
      } catch (error) {
        DashboardApp.Toast.show('Error deleting lead: ' + error.message, 'error');
      }
    }

    // Load Clients into Table
    async function loadClientsTable() {
      try {
        const response = await DashboardApp.API.get('/api/clients/');
        const clients = response.results || response;

        const tbody = document.getElementById('clientsTableBody');
        if (!tbody) return;

        if (clients.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7" class="no-data"><i class="fa fa-briefcase"></i><p>No clients found. Add your first client!</p></td></tr>';
          return;
        }

        tbody.innerHTML = clients.map(client => `
          <tr>
            <td>${client.logo ? `<img src="${client.logo}" alt="${DashboardApp.sanitize(client.name)}" style="max-width: 50px; max-height: 50px;">` : 'N/A'}</td>
            <td>${DashboardApp.sanitize(client.name)}</td>
            <td>${client.phone ? `<a href="tel:${client.phone}">${client.phone}</a>` : 'N/A'}</td>
            <td>${client.website ? `<a href="${client.website}" target="_blank" rel="noopener">Visit</a>` : 'N/A'}</td>
            <td><span style="color: ${client.is_active ? '#4CAF50' : '#999'}; font-weight: 500;">${client.is_active ? 'Active' : 'Inactive'}</span></td>
            <td>${client.order || 0}</td>
            <td>
              <button type="button" class="btn-action btn-sm" onclick="openEditClientModal(${client.id})" title="Edit client">
                <i class="fa fa-edit"></i>
              </button>
              <button type="button" class="btn-danger btn-sm" onclick="deleteClient(${client.id})" title="Delete client">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        const tbody = document.getElementById('clientsTableBody');
        if (tbody) {
          tbody.innerHTML = `<tr><td colspan="7" class="error-message" style="text-align: center; padding: 20px;">
            <i class="fa fa-warning"></i> Error loading clients: ${DashboardApp.sanitize(error.message)}
          </td></tr>`;
        }
      }
    }

    // Open Add Client Modal
    function openAddClientModal() {
      document.getElementById('clientName').value = '';
      document.getElementById('clientPhone').value = '';
      document.getElementById('clientAddress').value = '';
      document.getElementById('clientWebsite').value = '';
      document.getElementById('clientAbout').value = '';
      document.getElementById('clientOrder').value = '0';
      document.getElementById('clientIsActive').checked = true;
      document.getElementById('editClientId').value = '';
      document.getElementById('clientModalTitle').textContent = 'Add New Client';
      document.getElementById('clientSubmitText').textContent = 'Add Client';
      document.getElementById('clientModal').classList.add('active');
    }

    // Open Edit Client Modal
    async function openEditClientModal(clientId) {
      try {
        const client = await DashboardApp.API.get(`/api/clients/${clientId}/`);
        document.getElementById('clientName').value = client.name || '';
        document.getElementById('clientPhone').value = client.phone || '';
        document.getElementById('clientAddress').value = client.address || '';
        document.getElementById('clientWebsite').value = client.website || '';
        document.getElementById('clientAbout').value = client.about || '';
        document.getElementById('clientOrder').value = client.order || 0;
        document.getElementById('clientIsActive').checked = client.is_active || false;
        document.getElementById('editClientId').value = client.id;
        document.getElementById('clientModalTitle').textContent = 'Edit Client';
        document.getElementById('clientSubmitText').textContent = 'Update Client';
        document.getElementById('clientModal').classList.add('active');
      } catch (error) {
        DashboardApp.Toast.show('Error loading client: ' + error.message, 'error');
      }
    }

    // Close Client Modal
    function closeClientModal() {
      document.getElementById('clientModal').classList.remove('active');
    }

    // Save Client
    async function saveClient() {
      const clientId = document.getElementById('editClientId').value;
      const clientData = {
        name: document.getElementById('clientName').value,
        phone: document.getElementById('clientPhone').value,
        address: document.getElementById('clientAddress').value,
        website: document.getElementById('clientWebsite').value,
        about: document.getElementById('clientAbout').value,
        order: parseInt(document.getElementById('clientOrder').value) || 0,
        is_active: document.getElementById('clientIsActive').checked
      };

      try {
        if (clientId) {
          await DashboardApp.API.put(`/api/clients/${clientId}/`, clientData);
          DashboardApp.Toast.show('Client updated successfully', 'success');
        } else {
          await DashboardApp.API.post('/api/clients/', clientData);
          DashboardApp.Toast.show('Client added successfully', 'success');
        }
        closeClientModal();
        loadClientsTable();
      } catch (error) {
        DashboardApp.Toast.show('Error saving client: ' + error.message, 'error');
      }
    }

    // Delete Client
    async function deleteClient(clientId) {
      if (!confirm('Are you sure you want to delete this client?')) return;
      try {
        await DashboardApp.API.delete(`/api/clients/${clientId}/`);
        DashboardApp.Toast.show('Client deleted successfully', 'success');
        loadClientsTable();
      } catch (error) {
        DashboardApp.Toast.show('Error deleting client: ' + error.message, 'error');
      }
    }

    // ============================================================================
    // CAREER MANAGEMENT FUNCTIONS
    // ============================================================================

    // Load Careers Table
    async function loadCareersTable() {
      try {
        const careers = await DashboardApp.API.get('/api/careers/');
        const tbody = document.getElementById('careersTableBody');

        if (!careers || careers.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="no-data">
                <i class="fa fa-graduation-cap"></i>
                <p>No careers found. Add your first job posting!</p>
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = careers.map(career => `
          <tr>
            <td>${career.title}</td>
            <td>${career.location}</td>
            <td><span class="badge badge-info">${career.job_type.replace('_', ' ')}</span></td>
            <td><span class="badge badge-${career.status === 'active' ? 'success' : career.status === 'closed' ? 'danger' : 'warning'}">${career.status}</span></td>
            <td>${career.application_deadline || 'N/A'}</td>
            <td>${career.is_featured ? '<i class="fa fa-star" style="color: #ff6600;"></i>' : '-'}</td>
            <td>
              <button type="button" class="btn btn-sm btn-primary" onclick="editCareer(${career.id})" title="Edit career">
                <i class="fa fa-edit"></i> Edit
              </button>
              <button type="button" class="btn btn-sm btn-danger" onclick="deleteCareer(${career.id})" title="Delete career">
                <i class="fa fa-trash"></i> Delete
              </button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        DashboardApp.Toast.show('Error loading careers: ' + error.message, 'error');
      }
    }

    // Open Add Career Modal
    function openAddCareerModal() {
      document.getElementById('careerForm').reset();
      document.getElementById('careerId').value = '';
      document.getElementById('careerModalTitle').textContent = 'Add Career';
      document.getElementById('careerSubmitText').textContent = 'Save Career';
      document.getElementById('careerModal').classList.add('active');

      // Set default date to today
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('careerDeadline').value = '';
    }

    // Edit Career
    async function editCareer(careerId) {
      try {
        const career = await DashboardApp.API.get(`/api/careers/${careerId}/`);

        document.getElementById('careerId').value = career.id;
        document.getElementById('careerTitle').value = career.title || '';
        document.getElementById('careerLocation').value = career.location || '';
        document.getElementById('careerJobType').value = career.job_type || 'full_time';
        document.getElementById('careerStatus').value = career.status || 'draft';
        document.getElementById('careerDepartment').value = career.department || '';
        document.getElementById('careerExperience').value = career.experience_required || '';
        document.getElementById('careerSalary').value = career.salary_range || '';
        document.getElementById('careerDeadline').value = career.application_deadline || '';
        document.getElementById('careerShortDesc').value = career.short_description || '';
        document.getElementById('careerRequirements').value = career.requirements || '';
        document.getElementById('careerResponsibilities').value = career.responsibilities || '';
        document.getElementById('careerQualifications').value = career.qualifications || '';
        document.getElementById('careerBenefits').value = career.benefits || '';
        document.getElementById('careerAppEmail').value = career.application_email || '';
        document.getElementById('careerAppUrl').value = career.application_url || '';
        document.getElementById('careerFeatured').checked = career.is_featured || false;

        document.getElementById('careerModalTitle').textContent = 'Edit Career';
        document.getElementById('careerSubmitText').textContent = 'Update Career';
        document.getElementById('careerModal').classList.add('active');
      } catch (error) {
        DashboardApp.Toast.show('Error loading career: ' + error.message, 'error');
      }
    }

    // Close Career Modal
    function closeCareerModal() {
      document.getElementById('careerModal').classList.remove('active');
    }

    // Save Career
    async function saveCareer() {
      const careerId = document.getElementById('careerId').value;
      const careerData = {
        title: document.getElementById('careerTitle').value,
        location: document.getElementById('careerLocation').value,
        job_type: document.getElementById('careerJobType').value,
        status: document.getElementById('careerStatus').value,
        department: document.getElementById('careerDepartment').value,
        experience_required: document.getElementById('careerExperience').value,
        salary_range: document.getElementById('careerSalary').value,
        application_deadline: document.getElementById('careerDeadline').value || null,
        short_description: document.getElementById('careerShortDesc').value,
        requirements: document.getElementById('careerRequirements').value,
        responsibilities: document.getElementById('careerResponsibilities').value,
        qualifications: document.getElementById('careerQualifications').value,
        benefits: document.getElementById('careerBenefits').value,
        application_email: document.getElementById('careerAppEmail').value,
        application_url: document.getElementById('careerAppUrl').value,
        is_featured: document.getElementById('careerFeatured').checked
      };

      try {
        if (careerId) {
          await DashboardApp.API.put(`/api/careers/${careerId}/`, careerData);
          DashboardApp.Toast.show('Career updated successfully', 'success');
        } else {
          await DashboardApp.API.post('/api/careers/', careerData);
          DashboardApp.Toast.show('Career added successfully', 'success');
        }
        closeCareerModal();
        loadCareersTable();
      } catch (error) {
        DashboardApp.Toast.show('Error saving career: ' + error.message, 'error');
      }
    }

    // Delete Career
    async function deleteCareer(careerId) {
      if (!confirm('Are you sure you want to delete this career posting?')) return;
      try {
        await DashboardApp.API.delete(`/api/careers/${careerId}/`);
        DashboardApp.Toast.show('Career deleted successfully', 'success');
        loadCareersTable();
      } catch (error) {
        DashboardApp.Toast.show('Error deleting career: ' + error.message, 'error');
      }
    }

    // ============================================================================
    // NOTICE MANAGEMENT FUNCTIONS
    // ============================================================================

    // Load Notices Table
    async function loadNoticesTable() {
      try {
        const response = await DashboardApp.API.get('/api/notices/');
        const notices = response.results || response;
        const tbody = document.getElementById('noticesTableBody');

        if (!notices || notices.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="no-data">
                <i class="fa fa-bullhorn"></i>
                <p>No notices found. Add your first notice!</p>
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = notices.map(notice => `
          <tr>
            <td>${notice.title}</td>
            <td><span class="badge badge-${notice.status === 'published' ? 'success' : notice.status === 'archived' ? 'secondary' : 'warning'}">${notice.status}</span></td>
            <td><span class="badge badge-${notice.priority === 'urgent' ? 'danger' : notice.priority === 'high' ? 'warning' : 'info'}">${notice.priority}</span></td>
            <td>${notice.notice_date}</td>
            <td>${notice.expiry_date || 'N/A'}</td>
            <td>${notice.is_sticky ? '<i class="fa fa-thumb-tack" style="color: #ff6600;"></i>' : '-'}</td>
            <td>
              <button type="button" class="btn btn-sm btn-primary" onclick="editNotice(${notice.id})" title="Edit notice">
                <i class="fa fa-edit"></i> Edit
              </button>
              <button type="button" class="btn btn-sm btn-danger" onclick="deleteNotice(${notice.id})" title="Delete notice">
                <i class="fa fa-trash"></i> Delete
              </button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        DashboardApp.Toast.show('Error loading notices: ' + error.message, 'error');
      }
    }

    // Open Add Notice Modal
    function openAddNoticeModal() {
      document.getElementById('noticeForm').reset();
      document.getElementById('noticeId').value = '';
      document.getElementById('noticeModalTitle').textContent = 'Add Notice';
      document.getElementById('noticeSubmitText').textContent = 'Save Notice';
      document.getElementById('noticeModal').classList.add('active');

      // Set default date to today
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('noticeDate').value = today;
    }

    // Edit Notice
    async function editNotice(noticeId) {
      try {
        const notice = await DashboardApp.API.get(`/api/notices/${noticeId}/`);

        document.getElementById('noticeId').value = notice.id;
        document.getElementById('noticeTitle').value = notice.title || '';
        document.getElementById('noticeStatus').value = notice.status || 'draft';
        document.getElementById('noticePriority').value = notice.priority || 'normal';
        document.getElementById('noticeExcerpt').value = notice.excerpt || '';
        document.getElementById('noticeContent').value = notice.content || '';
        document.getElementById('noticeDate').value = notice.notice_date || '';
        document.getElementById('noticeExpiryDate').value = notice.expiry_date || '';
        document.getElementById('noticeFeatured').checked = notice.is_featured || false;
        document.getElementById('noticeSticky').checked = notice.is_sticky || false;

        document.getElementById('noticeModalTitle').textContent = 'Edit Notice';
        document.getElementById('noticeSubmitText').textContent = 'Update Notice';
        document.getElementById('noticeModal').classList.add('active');
      } catch (error) {
        DashboardApp.Toast.show('Error loading notice: ' + error.message, 'error');
      }
    }

    // Close Notice Modal
    function closeNoticeModal() {
      document.getElementById('noticeModal').classList.remove('active');
    }

    // Save Notice
    async function saveNotice() {
      const noticeId = document.getElementById('noticeId').value;
      const noticeData = {
        title: document.getElementById('noticeTitle').value,
        status: document.getElementById('noticeStatus').value,
        priority: document.getElementById('noticePriority').value,
        excerpt: document.getElementById('noticeExcerpt').value,
        content: document.getElementById('noticeContent').value,
        notice_date: document.getElementById('noticeDate').value,
        expiry_date: document.getElementById('noticeExpiryDate').value || null,
        is_featured: document.getElementById('noticeFeatured').checked,
        is_sticky: document.getElementById('noticeSticky').checked
      };

      try {
        if (noticeId) {
          await DashboardApp.API.put(`/api/notices/${noticeId}/`, noticeData);
          DashboardApp.Toast.show('Notice updated successfully', 'success');
        } else {
          await DashboardApp.API.post('/api/notices/', noticeData);
          DashboardApp.Toast.show('Notice added successfully', 'success');
        }
        closeNoticeModal();
        loadNoticesTable();
      } catch (error) {
        DashboardApp.Toast.show('Error saving notice: ' + error.message, 'error');
      }
    }

    // Delete Notice
    async function deleteNotice(noticeId) {
      if (!confirm('Are you sure you want to delete this notice?')) return;
      try {
        await DashboardApp.API.delete(`/api/notices/${noticeId}/`);
        DashboardApp.Toast.show('Notice deleted successfully', 'success');
        loadNoticesTable();
      } catch (error) {
        DashboardApp.Toast.show('Error deleting notice: ' + error.message, 'error');
      }
    }

    // ========================================
    // JOB APPLICATIONS MANAGEMENT
    // ========================================

    let currentApplicationId = null;
    let allApplications = [];

    // Load Job Applications Table
    async function loadJobApplicationsTable() {
      const tbody = document.getElementById('applicationsTableBody');

      try {
        const response = await DashboardApp.API.get('/api/job-applications/');
        const applications = response.results || response;
        allApplications = applications;

        if (!applications || applications.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="no-data">
                <i class="fa fa-file-text"></i>
                <p>No applications found.</p>
              </td>
            </tr>
          `;
          return;
        }

        tbody.innerHTML = applications.map(app => {
          const statusColors = {
            pending: '#ffc107',
            reviewing: '#17a2b8',
            shortlisted: '#28a745',
            rejected: '#dc3545',
            accepted: '#28a745'
          };
          const statusLabels = {
            pending: 'Pending Review',
            reviewing: 'Under Review',
            shortlisted: 'Shortlisted',
            rejected: 'Rejected',
            accepted: 'Accepted'
          };

          return `
            <tr>
              <td><strong>${DashboardApp.sanitize(app.full_name)}</strong></td>
              <td>${DashboardApp.sanitize(app.email)}</td>
              <td>${DashboardApp.sanitize(app.phone)}</td>
              <td>${DashboardApp.sanitize(app.career_title || 'N/A')}</td>
              <td>
                <span style="display: inline-block; padding: 5px 12px; background: ${statusColors[app.status]}; color: #fff; border-radius: 20px; font-size: 12px; font-weight: 600;">
                  ${statusLabels[app.status]}
                </span>
              </td>
              <td>${new Date(app.created_at).toLocaleDateString()}</td>
              <td>
                <button type="button" class="action-btn" onclick="viewApplicationDetail(${app.id})" title="View Details">
                  <i class="fa fa-eye"></i>
                </button>
              </td>
            </tr>
          `;
        }).join('');

        // Load career filter options
        await loadCareerFilterOptions();
      } catch (error) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" class="no-data">
              <i class="fa fa-exclamation-circle"></i>
              <p>Error loading applications: ${error.message}</p>
            </td>
          </tr>
        `;
        DashboardApp.Toast.show('Error loading applications: ' + error.message, 'error');
      }
    }

    // Load Career Filter Options
    async function loadCareerFilterOptions() {
      try {
        const response = await DashboardApp.API.get('/api/careers/');
        const careers = response.results || response;
        const filterSelect = document.getElementById('applicationCareerFilter');

        if (careers && careers.length > 0) {
          const currentValue = filterSelect.value;
          filterSelect.innerHTML = '<option value="">All Career Posts</option>' +
            careers.map(career =>
              `<option value="${career.id}">${DashboardApp.sanitize(career.title)}</option>`
            ).join('');
          if (currentValue) filterSelect.value = currentValue;
        }
      } catch (error) {
        console.error('Error loading career filter options:', error);
      }
    }

    // Filter Applications by Career
    async function filterApplicationsByCareer() {
      const careerId = document.getElementById('applicationCareerFilter').value;
      const status = document.getElementById('applicationStatusFilter').value;

      try {
        let url = '/api/job-applications/';
        const params = [];
        if (careerId) params.push(`career=${careerId}`);
        if (status) params.push(`status=${status}`);
        if (params.length > 0) url += '?' + params.join('&');

        const response = await DashboardApp.API.get(url);
        const applications = response.results || response;
        allApplications = applications;

        const tbody = document.getElementById('applicationsTableBody');

        if (!applications || applications.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="7" class="no-data">
                <i class="fa fa-filter"></i>
                <p>No applications found matching the selected filters.</p>
              </td>
            </tr>
          `;
          return;
        }

        const statusColors = {
          pending: '#ffc107',
          reviewing: '#17a2b8',
          shortlisted: '#28a745',
          rejected: '#dc3545',
          accepted: '#28a745'
        };
        const statusLabels = {
          pending: 'Pending Review',
          reviewing: 'Under Review',
          shortlisted: 'Shortlisted',
          rejected: 'Rejected',
          accepted: 'Accepted'
        };

        tbody.innerHTML = applications.map(app => `
          <tr>
            <td><strong>${DashboardApp.sanitize(app.full_name)}</strong></td>
            <td>${DashboardApp.sanitize(app.email)}</td>
            <td>${DashboardApp.sanitize(app.phone)}</td>
            <td>${DashboardApp.sanitize(app.career_title || 'N/A')}</td>
            <td>
              <span style="display: inline-block; padding: 5px 12px; background: ${statusColors[app.status]}; color: #fff; border-radius: 20px; font-size: 12px; font-weight: 600;">
                ${statusLabels[app.status]}
              </span>
            </td>
            <td>${new Date(app.created_at).toLocaleDateString()}</td>
            <td>
              <button type="button" class="action-btn" onclick="viewApplicationDetail(${app.id})" title="View Details">
                <i class="fa fa-eye"></i>
              </button>
            </td>
          </tr>
        `).join('');
      } catch (error) {
        DashboardApp.Toast.show('Error filtering applications: ' + error.message, 'error');
      }
    }

    // Filter Applications by Status
    async function filterApplicationsByStatus() {
      await filterApplicationsByCareer(); // Use same function as it handles both filters
    }

    // View Application Detail
    async function viewApplicationDetail(applicationId) {
      currentApplicationId = applicationId;

      try {
        const application = await DashboardApp.API.get(`/api/job-applications/${applicationId}/`);

        // Populate modal content
        const content = document.getElementById('applicationDetailContent');
        content.innerHTML = `
          <div style="display: grid; gap: 25px;">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #ff6600 0%, #ff8533 100%); padding: 25px; border-radius: 8px; color: white;">
              <h3 style="margin: 0 0 10px 0; color: white;">${DashboardApp.sanitize(application.full_name)}</h3>
              <p style="margin: 0; opacity: 0.9;">Applied for: <strong>${DashboardApp.sanitize(application.career_title)}</strong></p>
              <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 13px;">
                <i class="fa fa-calendar"></i> ${new Date(application.created_at).toLocaleString()}
              </p>
            </div>

            <!-- Contact Information -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
              <h4 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                <i class="fa fa-user"></i> Contact Information
              </h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div>
                  <strong style="color: #666; font-size: 13px;">Email:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.email)}</p>
                </div>
                <div>
                  <strong style="color: #666; font-size: 13px;">Phone:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.phone)}</p>
                </div>
                ${application.address ? `
                <div style="grid-column: 1 / -1;">
                  <strong style="color: #666; font-size: 13px;">Address:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.address)}</p>
                </div>
                ` : ''}
              </div>
            </div>

            <!-- Professional Background -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
              <h4 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                <i class="fa fa-briefcase"></i> Professional Background
              </h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                ${application.current_position ? `
                <div>
                  <strong style="color: #666; font-size: 13px;">Current Position:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.current_position)}</p>
                </div>
                ` : ''}
                ${application.current_company ? `
                <div>
                  <strong style="color: #666; font-size: 13px;">Current Company:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.current_company)}</p>
                </div>
                ` : ''}
                ${application.total_experience ? `
                <div>
                  <strong style="color: #666; font-size: 13px;">Total Experience:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.total_experience)}</p>
                </div>
                ` : ''}
                ${application.education ? `
                <div style="grid-column: 1 / -1;">
                  <strong style="color: #666; font-size: 13px;">Education:</strong>
                  <p style="margin: 5px 0 0 0; white-space: pre-wrap;">${DashboardApp.sanitize(application.education)}</p>
                </div>
                ` : ''}
              </div>
            </div>

            <!-- Cover Letter -->
            ${application.cover_letter ? `
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
              <h4 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                <i class="fa fa-file-text-o"></i> Cover Letter
              </h4>
              <div style="padding: 15px; background: white; border-radius: 4px; border: 1px solid #dee2e6;">
                ${application.cover_letter}
              </div>
            </div>
            ` : ''}

            <!-- Application Materials -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
              <h4 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                <i class="fa fa-paperclip"></i> Application Materials
              </h4>
              <div style="display: grid; gap: 15px;">
                ${application.resume ? `
                <div>
                  <strong style="color: #666; font-size: 13px;">Resume:</strong>
                  <div style="margin-top: 8px;">
                    <a href="${application.resume}" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 15px; background: #ff6600; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; font-weight: 600;">
                      <i class="fa fa-download"></i> Download Resume
                    </a>
                  </div>
                </div>
                ` : ''}
                ${application.portfolio_url ? `
                <div>
                  <strong style="color: #666; font-size: 13px;">Portfolio/LinkedIn:</strong>
                  <p style="margin: 5px 0 0 0;">
                    <a href="${DashboardApp.sanitize(application.portfolio_url)}" target="_blank" style="color: #ff6600; text-decoration: none;">
                      ${DashboardApp.sanitize(application.portfolio_url)} <i class="fa fa-external-link"></i>
                    </a>
                  </p>
                </div>
                ` : ''}
              </div>
            </div>

            <!-- Additional Information -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
              <h4 style="margin: 0 0 15px 0; color: #333; border-bottom: 2px solid #ff6600; padding-bottom: 10px;">
                <i class="fa fa-info-circle"></i> Additional Information
              </h4>
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                ${application.expected_salary ? `
                <div>
                  <strong style="color: #666; font-size: 13px;">Expected Salary:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.expected_salary)}</p>
                </div>
                ` : ''}
                ${application.availability ? `
                <div>
                  <strong style="color: #666; font-size: 13px;">Availability:</strong>
                  <p style="margin: 5px 0 0 0;">${DashboardApp.sanitize(application.availability)}</p>
                </div>
                ` : ''}
              </div>
            </div>

            <!-- Admin Notes -->
            ${application.admin_notes ? `
            <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107;">
              <h4 style="margin: 0 0 15px 0; color: #856404;">
                <i class="fa fa-sticky-note"></i> Admin Notes
              </h4>
              <p style="margin: 0; white-space: pre-wrap; color: #856404;">${DashboardApp.sanitize(application.admin_notes)}</p>
            </div>
            ` : ''}
          </div>
        `;

        // Set status and admin notes in form
        document.getElementById('applicationStatus').value = application.status;
        document.getElementById('adminNotes').value = application.admin_notes || '';

        // Show modal
        document.getElementById('applicationDetailModal').classList.add('active');
      } catch (error) {
        DashboardApp.Toast.show('Error loading application details: ' + error.message, 'error');
      }
    }

    // Close Application Detail Modal
    function closeApplicationDetailModal() {
      document.getElementById('applicationDetailModal').classList.remove('active');
      currentApplicationId = null;
    }

    // Update Application Status
    async function updateApplicationStatus() {
      if (!currentApplicationId) return;

      const status = document.getElementById('applicationStatus').value;
      const adminNotes = document.getElementById('adminNotes').value;

      try {
        await DashboardApp.API.patch(`/api/job-applications/${currentApplicationId}/update-status/`, {
          status: status,
          admin_notes: adminNotes
        });

        DashboardApp.Toast.show('Application status updated successfully', 'success');
        closeApplicationDetailModal();
        loadJobApplicationsTable();
      } catch (error) {
        DashboardApp.Toast.show('Error updating application status: ' + error.message, 'error');
      }
    }
  </script>
</body>

</html>